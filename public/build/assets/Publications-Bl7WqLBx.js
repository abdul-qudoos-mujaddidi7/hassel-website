import{al as de,i as w,N as M,r as y,G as ue,q as G,c as H,y as W,h as m,z as I,j as T,w as d,g as i,d as p,u as h,f as L,o as ce,b as J,l as x,t as v,a0 as pe,F as ge}from"./_plugin-vue_export-helper-P6s7mfAX.js";import{H as fe}from"./Header-Dc2gjrUc.js";import{l as $,u as Y,a as me}from"./admin-C1tUPR0Q.js";import{T as R,a as he}from"./TranslationField-DYZ6aUjw.js";/* empty css                                                               *//* empty css              */let K=de("PublicationsRepository",{state(){return{isEditMode:y(!1),router:ue(),search:y(""),loadingTable:y(!0),loading:y(!0),totalItems:y(0),selectedItems:y([]),itemsPerPage:y(5),createDialog:y(!1),publications:M([]),publicationsSearch:y(""),currentPublication:M({}),statusOptions:M([{value:"draft",label:"Draft"},{value:"published",label:"Published"},{value:"archived",label:"Archived"}]),fileTypeOptions:M([{value:"pdf",label:"PDF Document"},{value:"doc",label:"Word Document"},{value:"docx",label:"Word Document (DOCX)"},{value:"xls",label:"Excel Spreadsheet"},{value:"xlsx",label:"Excel Spreadsheet (XLSX)"},{value:"ppt",label:"PowerPoint Presentation"},{value:"pptx",label:"PowerPoint Presentation (PPTX)"},{value:"txt",label:"Text File"},{value:"other",label:"Other"}])}},actions:{setEditMode(s){this.isEditMode=s},getTodaysDate(){const s=new Date,t=s.getFullYear(),o=String(s.getMonth()+1).padStart(2,"0"),l=String(s.getDate()).padStart(2,"0");return`${t}-${o}-${l}`},async fetchPublications({page:s=1,itemsPerPage:t=5,status:o="",fileType:l=""}){this.loading=!0;try{const V=new URLSearchParams({page:s,perPage:t,search:this.publicationsSearch});o&&V.append("status",o),l&&V.append("file_type",l);const P=await w.get(`publications?${V}`);P.data.success?(this.publications=P.data.data||[],this.totalItems=P.data.meta?.total||0):(this.publications=[],this.totalItems=0,$.error(P.data.message||"Failed to fetch data",{position:"top-right",autoClose:3e3})),this.loading=!1}catch(V){this.publications=[],this.totalItems=0,this.loading=!1;const P=V.response?.data?.message||"Failed to fetch publications";$.error(P,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async fetchPublication(s){this.loading=!0;try{const t=await w.get(`publications/${s}`,{params:{include_translations:1}});this.currentPublication=t.data.data,this.loading=!1}catch{this.loading=!1,$.error("Failed to fetch publication",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async createPublication(s){try{const t=await w.post("publications",s);this.createDialog=!1,$.success("Publication created successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchPublications({page:1,itemsPerPage:this.itemsPerPage})}catch(t){const o=t.response?.data?.message||"Failed to create publication. Please try again.";$.error(o,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async updatePublication(s,t){try{const o=await w.put(`publications/${s}`,t);this.createDialog=!1,this.isEditMode=!1,$.success("Publication updated successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchPublications({page:1,itemsPerPage:this.itemsPerPage})}catch(o){const l=o.response?.data?.message||"Failed to update publication. Please try again.";$.error(l,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async deletePublication(s){try{await w.delete(`publications/${s}`),$.success("Publication deleted successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchPublications({page:1,itemsPerPage:this.itemsPerPage})}catch(t){const o=t.response?.data?.message||"Failed to delete publication. Please try again.";$.error(o,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async bulkDeletePublications(s){try{const t=s.map(o=>w.delete(`publications/${o}`));await Promise.all(t),$.success(`${s.length} publications deleted successfully!`,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchPublications({page:1,itemsPerPage:this.itemsPerPage})}catch{$.error("Failed to delete selected publications. Please try again.",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async getPublishedPublications({page:s=1,itemsPerPage:t=10}){try{const o=new URLSearchParams({page:s,perPage:t,search:this.publicationsSearch});return(await w.get(`publications/published?${o}`)).data}catch{return{success:!1,data:[],meta:{total:0}}}},async getPublicationsByFileType(s,{page:t=1,itemsPerPage:o=10}){try{const l=new URLSearchParams({page:t,perPage:o});return(await w.get(`publications/by-file-type/${s}?${l}`)).data}catch{return{success:!1,data:[],meta:{total:0}}}},async getPublicationStatistics(){try{return(await w.get("publications/statistics")).data.data}catch{return{}}},getStatusLabel(s){const t=this.statusOptions.find(o=>o.value===s);return t?t.label:s},getFileTypeLabel(s){const t=this.fileTypeOptions.find(o=>o.value===s);return t?t.label:s},formatDate(s){return s?new Date(s).toLocaleDateString():""},getFileExtension(s){return s?s.split(".").pop().toLowerCase():""},resetCurrentPublication(){this.currentPublication={id:null,title:"",slug:"",description:"",file_path:"",file_type:"",status:"draft",published_at:null}}}});const be={class:"flex w-100"},_e={class:"flex w-100"},ve={class:"flex w-100"},ye={class:"w-100 mb-4"},Pe={class:"w-100"},xe={__name:"CreatePublicationTranslatable",setup(s){const{t}=Y(),o=K(),l=H(()=>o.isEditMode?t("update"):t("create")),V=H(()=>o.isEditMode?t("update"):t("submit")),P=["title","description"],u=M({id:null,title:"",slug:"",description:"",file_path:"",file_type:"",status:"draft",published_at:null}),O=y(null),U=y(!1);W(()=>o.currentPublication,async e=>{if(e&&Object.keys(e).length>0){u.id=e.id,u.title=e.title||"",u.slug=e.slug||"",u.description=e.description||"",u.file_path=e.file_path||"",u.file_type=e.file_type||"",u.status=e.status||"draft",u.published_at=e.published_at?new Date(e.published_at).toISOString().slice(0,16):null;let c={},f={};e.farsi_translations&&(c=typeof e.farsi_translations=="string"?JSON.parse(e.farsi_translations):e.farsi_translations),e.pashto_translations&&(f=typeof e.pashto_translations=="string"?JSON.parse(e.pashto_translations):e.pashto_translations),e.translations&&Array.isArray(e.translations)&&e.translations.forEach(_=>{const D=_.field_name,F=_.content;_.language==="farsi"||_.language==="fa"?c[D]=F:(_.language==="pashto"||_.language==="ps")&&(f[D]=F)}),u.translationData={...e,farsi_translations:c,pashto_translations:f},await new Promise(_=>setTimeout(_,100))}},{deep:!0,immediate:!0}),W(()=>u.status,e=>{e==="published"&&!u.published_at&&(u.published_at=new Date().toISOString().slice(0,16))});const N={required:e=>!!e||t("field_required"),maxLength:e=>!e||e.length<=1e3||t("max_length_1000")},S=()=>{u.title&&!u.slug&&(u.slug=u.title.toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))},X=e=>{const c=e.target.files[0]},z=()=>".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt",q=async e=>{U.value=!0;try{if(e?.type!=="complete")return;const c=new FormData;Object.keys(e.data).forEach(f=>{if(f!=="file"&&f!=="featured_image"&&f!=="translationData")if(f==="translations"){const _=JSON.stringify(e.data[f]||{});c.append(f,_)}else e.data[f]!==null&&e.data[f]!==void 0&&c.append(f,e.data[f])}),o.isEditMode&&u.id&&c.set("id",u.id),O.value&&O.value.length>0&&c.append("file",O.value[0]),u.published_at?c.set("published_at",new Date(u.published_at).toISOString()):u.status==="published"&&c.set("published_at",new Date().toISOString());for(let f of c.entries());o.isEditMode?await o.updatePublication(u.id,c):await o.createPublication(c)}catch{}finally{U.value=!1}};return(e,c)=>{const f=m("v-text-field"),_=m("v-select"),D=m("v-file-input"),F=m("v-textarea");return T(),I(he,{modelValue:h(o).createDialog,"onUpdate:modelValue":c[1]||(c[1]=n=>h(o).createDialog=n),"form-title":l.value,"button-text":V.value,"translatable-fields":P,"form-data":u,rules:N,saving:U.value,"is-edit-mode":h(o).isEditMode,onSave:q},{"base-fields":d(({formData:n,rules:C})=>[p("div",be,[i(f,{modelValue:n.title,"onUpdate:modelValue":g=>n.title=g,variant:"outlined",label:e.$t("title"),density:"compact",class:"pb-4 pr-2 w-75",rules:[C.required],onInput:S},null,8,["modelValue","onUpdate:modelValue","label","rules"]),i(_,{modelValue:n.status,"onUpdate:modelValue":g=>n.status=g,items:h(o).statusOptions,variant:"outlined",density:"compact","item-value":"value","item-title":"label","return-object":!1,label:e.$t("status"),class:"pb-4 pl-2 w-25",rules:[C.required]},null,8,["modelValue","onUpdate:modelValue","items","label","rules"])]),p("div",_e,[i(f,{modelValue:n.slug,"onUpdate:modelValue":g=>n.slug=g,variant:"outlined",label:e.$t("slug"),density:"compact",class:"pb-4 pr-2 w-50",hint:e.$t("hint_url_friendly"),"persistent-hint":""},null,8,["modelValue","onUpdate:modelValue","label","hint"]),i(_,{modelValue:n.file_type,"onUpdate:modelValue":g=>n.file_type=g,items:h(o).fileTypeOptions,variant:"outlined",density:"compact","item-value":"value","item-title":"label","return-object":!1,label:e.$t("file_type"),class:"pb-4 pl-2 w-50"},null,8,["modelValue","onUpdate:modelValue","items","label"])]),p("div",ve,[i(f,{modelValue:n.file_path,"onUpdate:modelValue":g=>n.file_path=g,variant:"outlined",label:e.$t("file_path"),density:"compact",class:"pb-4 pr-2 w-75",hint:e.$t("hint_file_path"),"persistent-hint":""},null,8,["modelValue","onUpdate:modelValue","label","hint"]),n.status==="published"?(T(),I(f,{key:0,modelValue:n.published_at,"onUpdate:modelValue":g=>n.published_at=g,variant:"outlined",label:e.$t("published_date"),density:"compact",type:"datetime-local",class:"pb-4 pl-2 w-25"},null,8,["modelValue","onUpdate:modelValue","label"])):L("",!0)]),p("div",ye,[i(D,{modelValue:O.value,"onUpdate:modelValue":c[0]||(c[0]=g=>O.value=g),label:e.$t("upload_file"),variant:"outlined",density:"compact",accept:z(),onChange:X,"show-size":"",counter:""},null,8,["modelValue","label","accept"]),c[2]||(c[2]=p("div",{class:"text-caption text-grey mt-1"}," Supported formats: PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX, TXT ",-1))]),p("div",Pe,[i(F,{modelValue:n.description,"onUpdate:modelValue":g=>n.description=g,variant:"outlined",label:e.$t("description"),density:"compact",class:"pb-4",rules:[C.required],rows:"6",hint:e.$t("hint_publication_description"),"persistent-hint":""},null,8,["modelValue","onUpdate:modelValue","label","rules","hint"])])]),"farsi-fields":d(({translations:n,clearTranslation:C,hasTranslation:g})=>[i(R,{modelValue:n.title,"onUpdate:modelValue":a=>n.title=a,"field-name":"title","field-label":e.$t("title"),language:"farsi","language-label":e.$t("farsi"),"has-translation":g("title"),onClear:C},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"]),i(R,{modelValue:n.description,"onUpdate:modelValue":a=>n.description=a,"field-name":"description","field-label":e.$t("description"),language:"farsi","language-label":e.$t("farsi"),"field-type":"textarea",rows:6,"has-translation":g("description"),onClear:C},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"])]),"pashto-fields":d(({translations:n,clearTranslation:C,hasTranslation:g})=>[i(R,{modelValue:n.title,"onUpdate:modelValue":a=>n.title=a,"field-name":"title","field-label":e.$t("title"),language:"pashto","language-label":e.$t("pashto"),"has-translation":g("title"),onClear:C},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"]),i(R,{modelValue:n.description,"onUpdate:modelValue":a=>n.description=a,"field-name":"description","field-label":e.$t("description"),language:"pashto","language-label":e.$t("pashto"),"field-type":"textarea",rows:6,"has-translation":g("description"),onClear:C},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"])]),_:1},8,["modelValue","form-title","button-text","form-data","saving","is-edit-mode"])}}},Ve=G(xe,[["__scopeId","data-v-1ab2f015"]]),Ce=["dir"],$e={class:"btn-search pt-12 pb-6"},Se={class:"text-field w-25"},we={class:"btn flex"},Oe={class:"table-section"},Te={class:"py-2 pl-4"},De={class:"d-flex align-center"},Fe={class:"font-weight-medium"},ke={class:"text-caption text-grey"},Ue={class:"py-2 pl-4"},Ee={class:"py-2 pl-4"},Me={class:"py-2 pl-4"},Ie={class:"d-flex flex-column gap-1"},Ae={class:"py-2 pl-4"},Be={key:0,class:"d-flex align-center"},Re={class:"text-caption"},Le={key:1,class:"text-grey"},He={class:"py-2 pl-4"},Ne={__name:"Publications",setup(s){const{t,locale:o}=Y();me();const l=K(),V=H(()=>["fa","ps"].includes(o.value)?"rtl":"ltr"),P=y(""),u=y("");let O;const U=()=>{clearTimeout(O),O=setTimeout(()=>{l.fetchPublications({page:1,itemsPerPage:l.itemsPerPage,status:P.value,fileType:u.value})},500)},N=a=>{l.fetchPublications({page:a.page,itemsPerPage:a.itemsPerPage,status:P.value,fileType:u.value})},S=y([]),X=()=>{S.value.length>0&&(l.bulkDeletePublications(S.value),S.value=[])},z=()=>{l.resetCurrentPublication(),l.isEditMode=!1,l.createDialog=!0},q=async a=>{l.isEditMode=!0,await l.fetchPublication(a.id),l.createDialog=!0},e=async a=>{await l.deletePublication(a.id)},c=a=>{a.file_path&&window.open(a.file_path,"_blank")},f=a=>({pdf:"mdi-file-pdf-box",doc:"mdi-file-word-box",docx:"mdi-file-word-box",xls:"mdi-file-excel-box",xlsx:"mdi-file-excel-box",ppt:"mdi-file-powerpoint-box",pptx:"mdi-file-powerpoint-box",txt:"mdi-file-document-outline",other:"mdi-file-outline"})[a]||"mdi-file-outline",_=a=>({pdf:"red",doc:"blue",docx:"blue",xls:"green",xlsx:"green",ppt:"orange",pptx:"orange",txt:"grey",other:"grey"})[a]||"grey",D=a=>({pdf:"red",doc:"blue",docx:"blue",xls:"green",xlsx:"green",ppt:"orange",pptx:"orange",txt:"grey",other:"grey"})[a]||"primary",F=a=>{switch(a){case"published":return"success";case"draft":return"warning";case"archived":return"grey";default:return"primary"}},n=a=>a===100?"success":a>=50?"warning":"error",C=a=>a.split("/").pop(),g=H(()=>[{title:"",key:"checkbox",align:"start",sortable:!1},{title:t("title"),key:"title",align:"start",sortable:!0},{title:t("file_type"),key:"file_type",align:"center",sortable:!0},{title:t("status"),key:"status",align:"center",sortable:!0},{title:t("file_path"),key:"file_path",align:"center",sortable:!1},{title:t("published_date"),key:"published_at",align:"center",sortable:!0},{title:t("action"),key:"action",align:"center",sortable:!1}]);return ce(()=>{l.fetchPublications({page:1,itemsPerPage:l.itemsPerPage,status:P.value,fileType:u.value})}),W(()=>o.value,()=>{l.fetchPublications({page:1,itemsPerPage:l.itemsPerPage,status:P.value,fileType:u.value})}),(a,b)=>{const Q=m("v-divider"),Z=m("v-text-field"),A=m("v-btn"),E=m("v-icon"),B=m("v-chip"),ee=m("v-checkbox"),j=m("v-list-item-title"),te=m("v-list-item"),ae=m("v-list"),le=m("v-menu"),se=m("v-data-table-server"),oe=m("v-col"),ie=m("v-row"),re=m("v-main"),ne=m("v-app");return T(),J(ge,null,[h(l).createDialog?(T(),I(Ve,{key:0})):L("",!0),p("div",{dir:V.value},[i(fe,{pageTitle:a.$t("publications_management")},null,8,["pageTitle"]),i(Q,{thickness:1,class:"border-opacity-100"}),p("div",$e,[p("div",Se,[i(Z,{color:"primary",density:"compact",variant:"outlined",label:a.$t("search"),"append-inner-icon":"mdi-magnify","hide-details":"",modelValue:h(l).publicationsSearch,"onUpdate:modelValue":b[0]||(b[0]=r=>h(l).publicationsSearch=r),onInput:U},null,8,["label","modelValue"])]),p("div",we,[i(A,{class:"action-btn-success px-6"},{default:d(()=>[x(v(h(t)("filter")),1)]),_:1}),b[3]||(b[3]=x(" Â  ",-1)),i(A,{onClick:z,class:"action-btn-success px-6",text:a.$t("create")},null,8,["text"])])]),p("div",Oe,[i(ne,null,{default:d(()=>[i(re,{class:"main"},{default:d(()=>[i(ie,null,{default:d(()=>[i(oe,null,{default:d(()=>[i(se,{dir:V.value,theme:"cursor-pointer","items-per-page":h(l).itemsPerPage,"onUpdate:itemsPerPage":b[2]||(b[2]=r=>h(l).itemsPerPage=r),headers:g.value,"items-length":h(l).totalItems,items:h(l).publications,loading:h(l).loading,"onUpdate:options":N,hover:"",class:"w-100 mx-auto"},{"item.title":d(({item:r})=>[p("td",Te,[p("div",De,[i(E,{icon:f(r.file_type),size:"24",class:"mr-3",color:_(r.file_type)},null,8,["icon","color"]),p("div",null,[p("div",Fe,v(r.title),1),p("div",ke,v(r.description?.substring(0,50))+"...",1)])])])]),"item.file_type":d(({item:r})=>[p("td",Ue,[i(B,{color:D(r.file_type),size:"small",variant:"flat"},{default:d(()=>[x(v(h(l).getFileTypeLabel(r.file_type)),1)]),_:2},1032,["color"])])]),"item.status":d(({item:r})=>[p("td",Ee,[i(B,{color:F(r.status),size:"small",variant:"flat"},{default:d(()=>[x(v(h(l).getStatusLabel(r.status)),1)]),_:2},1032,["color"])])]),"item.translations":d(({item:r})=>[p("td",Me,[p("div",Ie,[i(B,{color:n(r.farsi_coverage||0),size:"x-small",variant:"flat"},{default:d(()=>[x(v(a.$t("dari"))+": "+v(r.farsi_coverage||0)+"% ",1)]),_:2},1032,["color"]),i(B,{color:n(r.pashto_coverage||0),size:"x-small",variant:"flat"},{default:d(()=>[x(v(a.$t("pashto"))+": "+v(r.pashto_coverage||0)+"% ",1)]),_:2},1032,["color"])])])]),"item.file_path":d(({item:r})=>[p("td",Ae,[r.file_path?(T(),J("div",Be,[i(E,{icon:"mdi-file",size:"16",class:"mr-2"}),p("span",Re,v(C(r.file_path)),1)])):(T(),J("span",Le,v(a.$t("no_file")),1))])]),"item.published_at":d(({item:r})=>[p("td",He,[p("span",null,v(h(l).formatDate(r.published_at)),1)])]),"item.checkbox":d(({item:r})=>[i(ee,{value:r.id,modelValue:S.value,"onUpdate:modelValue":b[1]||(b[1]=k=>S.value=k),class:"w-6 d-flex"},null,8,["value","modelValue"])]),"item.action":d(({item:r})=>[i(le,null,{activator:d(({props:k})=>[i(A,pe({icon:"mdi-dots-vertical"},k,{variant:"text"}),null,16)]),default:d(()=>[i(ae,null,{default:d(()=>[i(te,null,{default:d(()=>[i(j,{onClick:k=>q(r),class:"cursor-pointer d-flex gap-3 justify-left pb-3"},{default:d(()=>[i(E,{color:"tealColor"},{default:d(()=>[...b[4]||(b[4]=[x("mdi-square-edit-outline",-1)])]),_:1}),x(" "+v(a.$t("edit")),1)]),_:1},8,["onClick"]),r.file_path?(T(),I(j,{key:0,onClick:k=>c(r),class:"cursor-pointer d-flex gap-3 pb-3"},{default:d(()=>[i(E,{color:"blue"},{default:d(()=>[...b[5]||(b[5]=[x("mdi-download",-1)])]),_:1}),x(" "+v(a.$t("download")),1)]),_:1},8,["onClick"])):L("",!0),i(j,{class:"cursor-pointer d-flex gap-3",onClick:k=>e(r)},{default:d(()=>[i(E,{color:"error"},{default:d(()=>[...b[6]||(b[6]=[x("mdi-delete-outline",-1)])]),_:1}),x(" "+v(a.$t("delete")),1)]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["dir","items-per-page","headers","items-length","items","loading"]),S.value.length>0?(T(),I(A,{key:0,class:"header-button",onClick:X,color:"#B71C1C",flat:"",inset:"",text:h(t)("delete_selected",{count:S.value.length})},null,8,["text"])):L("",!0)]),_:1})]),_:1})]),_:1})]),_:1})])],8,Ce)],64)}}},Ge=G(Ne,[["__scopeId","data-v-f5527867"]]);export{Ge as default};
