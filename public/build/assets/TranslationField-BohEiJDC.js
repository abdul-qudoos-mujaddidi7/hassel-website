import{M as nt,c as T,s as R,r as F,o as ot,z as j,h as f,b as B,k as S,g as r,w as c,d as b,t as A,m as _,F as it,e as rt,u as y,A as U,an as $,l as q,f as dt,B as ct}from"./_plugin-vue_export-helper-Bve7U4QZ.js";import{u as I}from"./admin-DEzJhurF.js";function ut(t=[]){const{t:v}=I(),a=nt({farsi:{},pashto:{}}),d=()=>{t.forEach(e=>{a.farsi[e]="",a.pashto[e]=""})},V=(e={})=>{console.log("=== LOAD TRANSLATIONS DEBUG ==="),console.log("API Data received:",e),console.log("Farsi translations:",e.farsi_translations),console.log("Pashto translations:",e.pashto_translations),console.log("Translatable fields:",t);const s=o=>!o||Object.values(o).every(g=>!g||g==="");s(a.farsi)&&s(a.pashto)&&d(),e.farsi_translations?(console.log("Loading Farsi translations..."),Object.keys(e.farsi_translations).forEach(o=>{a.farsi[o]!==void 0&&(a.farsi[o]=e.farsi_translations[o]||"",console.log(`Set farsi.${o}:`,e.farsi_translations[o]))})):console.log("No Farsi translations found in API data"),e.pashto_translations?(console.log("Loading Pashto translations..."),Object.keys(e.pashto_translations).forEach(o=>{a.pashto[o]!==void 0&&(a.pashto[o]=e.pashto_translations[o]||"",console.log(`Set pashto.${o}:`,e.pashto_translations[o]))})):console.log("No Pashto translations found in API data"),console.log("Final translations state:",a),console.log("================================")},C=(e,s)=>{a[e]&&a[e][s]!==void 0&&(a[e][s]="")},m=e=>{a[e]&&Object.keys(a[e]).forEach(s=>{a[e][s]=""})},h=e=>{if(!a[e])return 0;const s=t.length,o=Object.values(a[e]).filter(g=>g&&g.trim()!=="").length;return s>0?Math.round(o/s*100):0},u=T(()=>({farsi:h("farsi"),pashto:h("pashto")})),p=(e,s)=>a[e]&&a[e][s]&&a[e][s].trim()!=="",x=e=>e===100?"success":e>=50?"warning":"error",k=()=>{const e={farsi:{},pashto:{}};return Object.keys(a.farsi).forEach(s=>{a.farsi[s]&&a.farsi[s].trim()!==""&&(e.farsi[s]=a.farsi[s])}),Object.keys(a.pashto).forEach(s=>{a.pashto[s]&&a.pashto[s].trim()!==""&&(e.pashto[s]=a.pashto[s])}),e},w={farsi:v("dari"),pashto:v("pashto")},L=T(()=>[{key:"base",title:v("english"),icon:"mdi-translate"},{key:"farsi",title:v("dari"),icon:"mdi-flag",coverage:u.value.farsi},{key:"pashto",title:v("pashto"),icon:"mdi-flag",coverage:u.value.pashto}]);return{translations:a,initializeTranslations:d,loadTranslations:V,clearTranslation:C,clearLanguageTranslations:m,getTranslationCoverage:h,getTranslationCoverages:u,hasTranslation:p,getCoverageBadgeColor:x,prepareTranslationsForApi:k,languageLabels:w,translationTabs:L}}const ft=["dir"],mt={class:"font-weight-bold pl-4"},vt={class:"translation-tab"},pt={class:"translation-tab"},gt={class:"d-flex flex-row-reverse mb-6 mx-6"},ht={__name:"TranslatableForm",props:{modelValue:{type:Boolean,default:!1},formTitle:{type:String,required:!0},buttonText:{type:String,default:"Save"},buttonClass:{type:String,default:"action-btn action-btn-success px-4"},width:{type:String,default:"60rem"},transition:{type:String,default:"dialog-top-transition"},dialogClass:{type:String,default:"rtl-dialog"},translatableFields:{type:Array,required:!0},formData:{type:Object,required:!0},rules:{type:Object,default:()=>({})},saving:{type:Boolean,default:!1},dir:{type:String,default:"rtl"},isEditMode:{type:Boolean,default:!1}},emits:["update:modelValue","save","load-translations"],setup(t,{expose:v,emit:a}){const d=t,V=a,{t:C}=I(),{translations:m,initializeTranslations:h,loadTranslations:u,clearTranslation:p,clearLanguageTranslations:x,hasTranslation:k,prepareTranslationsForApi:w,translationTabs:L}=ut(d.translatableFields),e=F(null),s=F("base"),o=F(!1),g=F(!1),P=F(!1),M=T({get:()=>d.modelValue,set:l=>V("update:modelValue",l)}),z=()=>{const l=["title"];o.value=l.every(n=>d.formData[n]&&d.formData[n].toString().trim()!=="")},D=()=>{const l=Object.values(m.farsi).some(n=>n&&n.toString().trim()!=="");g.value=l},G=()=>{const l=Object.values(m.pashto).some(n=>n&&n.toString().trim()!=="");P.value=l};ot(()=>{!d.isEditMode&&!d.formData?.translationData&&h()}),j(()=>d.formData,(l,n)=>{if(console.log("=== TRANSLATABLE FORM WATCHER ==="),console.log("Form data changed:",l),console.log("Has translations:",!!l?.translations),console.log("Has translationData:",!!l?.translationData),console.log("TranslationData content:",l?.translationData),l?.translationData&&n?.translationData&&l.translationData.id===n.translationData.id){console.log("Skipping reload - same translation data");return}l&&l.translations?(console.log("Loading from old translations format"),u(l.translations)):l&&l.translationData&&(console.log("Loading from new JSON translation format"),console.log("Translation data:",l.translationData),u(l.translationData)),z()},{deep:!0,immediate:!0}),j(()=>m.farsi,()=>{D()},{deep:!0}),j(()=>m.pashto,()=>{G()},{deep:!0});const J=()=>W()&&d.isEditMode?"Update All Content":"Save All Content",W=()=>o.value&&(g.value||P.value),K=async()=>{const{valid:l}=await e.value.validate();if(!l)return;const n={...d.formData,translations:w()};V("save",{data:n,type:"complete"})};return v({formRef:e,clearTranslation:p,clearLanguageTranslations:x,loadTranslations:u}),(l,n)=>{const O=f("v-icon"),H=f("v-btn"),Q=f("v-card-title"),X=f("v-divider"),Y=f("v-tab"),Z=f("v-tabs"),E=f("v-window-item"),tt=f("v-window"),et=f("v-form"),at=f("v-card-text"),st=f("v-card"),lt=f("v-dialog");return S(),B("div",{dir:t.dir},[r(lt,{transition:t.transition,width:t.width,modelValue:M.value,"onUpdate:modelValue":n[2]||(n[2]=N=>M.value=N),class:q(t.dialogClass)},{default:c(({isActive:N})=>[r(st,{class:"px-3"},{default:c(()=>[r(Q,{class:"px-2 pt-4 d-flex justify-space-between"},{default:c(()=>[b("h2",mt,A(t.formTitle),1),r(H,{variant:"text",onClick:i=>N.value=!1},{default:c(()=>[r(O,null,{default:c(()=>[...n[3]||(n[3]=[_("mdi-close",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1024),r(X,{class:"border-opacity-100 mx-6"}),r(at,null,{default:c(()=>[r(et,{ref_key:"formRef",ref:e,class:"pt-4"},{default:c(()=>[r(Z,{modelValue:s.value,"onUpdate:modelValue":n[0]||(n[0]=i=>s.value=i),color:"primary",class:"mb-4","align-tabs":"start"},{default:c(()=>[(S(!0),B(it,null,rt(y(L),i=>(S(),U(Y,{key:i.key,value:i.key,class:"text-capitalize"},{default:c(()=>[r(O,{icon:i.icon,class:"me-2"},null,8,["icon"]),_(" "+A(i.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),r(tt,{modelValue:s.value,"onUpdate:modelValue":n[1]||(n[1]=i=>s.value=i)},{default:c(()=>[r(E,{value:"base"},{default:c(()=>[$(l.$slots,"base-fields",{formData:t.formData,rules:t.rules},void 0,!0)]),_:3}),r(E,{value:"farsi"},{default:c(()=>[b("div",vt,[$(l.$slots,"farsi-fields",{translations:y(m).farsi,clearTranslation:i=>y(p)("farsi",i),hasTranslation:i=>y(k)("farsi",i)},void 0,!0)])]),_:3}),r(E,{value:"pashto"},{default:c(()=>[b("div",pt,[$(l.$slots,"pashto-fields",{translations:y(m).pashto,clearTranslation:i=>y(p)("pashto",i),hasTranslation:i=>y(k)("pashto",i)},void 0,!0)])]),_:3})]),_:3},8,["modelValue"])]),_:3},512)]),_:3}),b("div",gt,[r(H,{class:q(t.buttonClass),loading:t.saving,disabled:t.saving,onClick:K},{default:c(()=>[r(O,null,{default:c(()=>[...n[4]||(n[4]=[_("mdi-content-save",-1)])]),_:1}),_(" "+A(J()),1)]),_:1},8,["class","loading","disabled"])])]),_:2},1024)]),_:3},8,["transition","width","modelValue","class"])],8,ft)}}},At=R(ht,[["__scopeId","data-v-bfec9c3a"]]),yt={class:"translation-field mb-4"},bt={class:"d-flex justify-space-between align-center mb-2"},Tt={class:"text-subtitle-2 font-weight-medium"},St={key:0,class:"text-caption text-grey mt-1"},Vt={__name:"TranslationField",props:{fieldName:{type:String,required:!0},fieldLabel:{type:String,required:!0},language:{type:String,required:!0},languageLabel:{type:String,required:!0},modelValue:{type:[String,Number,Array],default:""},fieldType:{type:String,default:"text",validator:t=>["text","textarea","select","multiselect","date","number"].includes(t)},variant:{type:String,default:"outlined"},density:{type:String,default:"compact"},placeholder:{type:String,default:""},rules:{type:Array,default:()=>[]},rows:{type:[String,Number],default:3},type:{type:String,default:"text"},items:{type:Array,default:()=>[]},itemTitle:{type:String,default:"title"},itemValue:{type:String,default:"value"},multiple:{type:Boolean,default:!1},chips:{type:Boolean,default:!1},closableChips:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},hint:{type:String,default:""},persistentHint:{type:Boolean,default:!1},fieldClass:{type:String,default:""}},emits:["update:modelValue","clear"],setup(t,{emit:v}){const a=t,d=v,{t:V}=I(),C=T(()=>{switch(a.fieldType){case"textarea":return"v-textarea";case"select":case"multiselect":return"v-select";case"date":return"v-text-field";case"number":return"v-text-field";default:return"v-text-field"}}),m=T({get:()=>a.modelValue,set:u=>d("update:modelValue",u)});T(()=>Array.isArray(a.modelValue)?a.modelValue.length>0:a.modelValue&&a.modelValue.toString().trim()!=="");const h=u=>{d("update:modelValue",u)};return(u,p)=>(S(),B("div",yt,[b("div",bt,[b("label",Tt,A(t.fieldLabel),1)]),(S(),U(ct(C.value),{modelValue:m.value,"onUpdate:modelValue":[p[0]||(p[0]=x=>m.value=x),h],variant:t.variant,density:t.density,label:t.placeholder,rules:t.rules,rows:t.rows,type:t.type,items:t.items,"item-title":t.itemTitle,"item-value":t.itemValue,multiple:t.multiple,chips:t.chips,"closable-chips":t.closableChips,disabled:t.disabled,readonly:t.readonly,hint:t.hint,"persistent-hint":t.persistentHint,class:q(t.fieldClass)},null,8,["modelValue","variant","density","label","rules","rows","type","items","item-title","item-value","multiple","chips","closable-chips","disabled","readonly","hint","persistent-hint","class"])),t.hint&&!t.persistentHint?(S(),B("div",St,A(t.hint),1)):dt("",!0)]))}},Ct=R(Vt,[["__scopeId","data-v-ae2bb894"]]);export{Ct as T,At as a};
