import{ak as ue,j as C,M as T,r as h,am as de,s as G,c as R,z as Y,h as f,A as F,k as w,w as n,g as i,d as p,u as m,f as L,o as ce,b as W,m as v,t as P,$ as pe,F as ge}from"./_plugin-vue_export-helper-Bve7U4QZ.js";import{H as fe}from"./Header-EurA_yJ3.js";import{l as x,u as J,a as me}from"./admin-DEzJhurF.js";import{T as B,a as be}from"./TranslationField-BohEiJDC.js";/* empty css                                                               *//* empty css              */let K=ue("PublicationsRepository",{state(){return{isEditMode:h(!1),router:de(),search:h(""),loadingTable:h(!0),loading:h(!0),totalItems:h(0),selectedItems:h([]),itemsPerPage:h(5),createDialog:h(!1),publications:T([]),publicationsSearch:h(""),currentPublication:T({}),statusOptions:T([{value:"draft",label:"Draft"},{value:"published",label:"Published"},{value:"archived",label:"Archived"}]),fileTypeOptions:T([{value:"pdf",label:"PDF Document"},{value:"doc",label:"Word Document"},{value:"docx",label:"Word Document (DOCX)"},{value:"xls",label:"Excel Spreadsheet"},{value:"xlsx",label:"Excel Spreadsheet (XLSX)"},{value:"ppt",label:"PowerPoint Presentation"},{value:"pptx",label:"PowerPoint Presentation (PPTX)"},{value:"txt",label:"Text File"},{value:"other",label:"Other"}])}},actions:{setEditMode(o){this.isEditMode=o},getTodaysDate(){const o=new Date,a=o.getFullYear(),l=String(o.getMonth()+1).padStart(2,"0"),s=String(o.getDate()).padStart(2,"0");return`${a}-${l}-${s}`},async fetchPublications({page:o=1,itemsPerPage:a=5,status:l="",fileType:s=""}){this.loading=!0;try{const _=new URLSearchParams({page:o,perPage:a,search:this.publicationsSearch});l&&_.append("status",l),s&&_.append("file_type",s);const b=await C.get(`publications?${_}`);console.log("API Response:",b.data),b.data.success?(this.publications=b.data.data||[],this.totalItems=b.data.meta?.total||0):(this.publications=[],this.totalItems=0,x.error(b.data.message||"Failed to fetch data",{position:"top-right",autoClose:3e3})),this.loading=!1}catch(_){console.error("API Error:",_),console.error("Error Response:",_.response?.data),this.publications=[],this.totalItems=0,this.loading=!1;const b=_.response?.data?.message||"Failed to fetch publications";x.error(b,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async fetchPublication(o){this.loading=!0;try{const a=await C.get(`publications/${o}`,{params:{include_translations:1}});this.currentPublication=a.data.data,this.loading=!1}catch(a){console.error(a),this.loading=!1,x.error("Failed to fetch publication",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async createPublication(o){try{const a=await C.post("publications",o);this.createDialog=!1,x.success("Publication created successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchPublications({page:1,itemsPerPage:this.itemsPerPage})}catch(a){console.error(a);const l=a.response?.data?.message||"Failed to create publication. Please try again.";x.error(l,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async updatePublication(o,a){try{const l=await C.put(`publications/${o}`,a);this.createDialog=!1,this.isEditMode=!1,x.success("Publication updated successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchPublications({page:1,itemsPerPage:this.itemsPerPage})}catch(l){console.error(l);const s=l.response?.data?.message||"Failed to update publication. Please try again.";x.error(s,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async deletePublication(o){try{await C.delete(`publications/${o}`),x.success("Publication deleted successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchPublications({page:1,itemsPerPage:this.itemsPerPage})}catch(a){console.error(a);const l=a.response?.data?.message||"Failed to delete publication. Please try again.";x.error(l,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async bulkDeletePublications(o){try{const a=o.map(l=>C.delete(`publications/${l}`));await Promise.all(a),x.success(`${o.length} publications deleted successfully!`,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchPublications({page:1,itemsPerPage:this.itemsPerPage})}catch(a){console.error(a),x.error("Failed to delete selected publications. Please try again.",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async getPublishedPublications({page:o=1,itemsPerPage:a=10}){try{const l=new URLSearchParams({page:o,perPage:a,search:this.publicationsSearch});return(await C.get(`publications/published?${l}`)).data}catch(l){return console.error(l),{success:!1,data:[],meta:{total:0}}}},async getPublicationsByFileType(o,{page:a=1,itemsPerPage:l=10}){try{const s=new URLSearchParams({page:a,perPage:l});return(await C.get(`publications/by-file-type/${o}?${s}`)).data}catch(s){return console.error(s),{success:!1,data:[],meta:{total:0}}}},async getPublicationStatistics(){try{return(await C.get("publications/statistics")).data.data}catch(o){return console.error(o),{}}},getStatusLabel(o){const a=this.statusOptions.find(l=>l.value===o);return a?a.label:o},getFileTypeLabel(o){const a=this.fileTypeOptions.find(l=>l.value===o);return a?a.label:o},formatDate(o){return o?new Date(o).toLocaleDateString():""},getFileExtension(o){return o?o.split(".").pop().toLowerCase():""},resetCurrentPublication(){this.currentPublication={id:null,title:"",slug:"",description:"",file_path:"",file_type:"",status:"draft",published_at:null}}}});const he={class:"flex w-100"},_e={class:"flex w-100"},ve={class:"flex w-100"},ye={class:"w-100 mb-4"},Pe={class:"w-100"},xe={__name:"CreatePublicationTranslatable",setup(o){const{t:a}=J(),l=K(),s=R(()=>l.isEditMode?a("update"):a("create")),_=R(()=>l.isEditMode?a("update"):a("submit")),b=["title","description"],g=T({id:null,title:"",slug:"",description:"",file_path:"",file_type:"",status:"draft",published_at:null}),S=h(null),O=h(!1);Y(()=>l.currentPublication,async t=>{t&&Object.keys(t).length>0&&(g.id=t.id,g.title=t.title||"",g.slug=t.slug||"",g.description=t.description||"",g.file_path=t.file_path||"",g.file_type=t.file_type||"",g.status=t.status||"draft",g.published_at=t.published_at?new Date(t.published_at).toISOString().slice(0,16):null,l.isEditMode&&t.id&&await A(t.id))},{deep:!0,immediate:!0}),Y(()=>g.status,t=>{t==="published"&&!g.published_at&&(g.published_at=new Date().toISOString().slice(0,16))});const H={required:t=>!!t||"This field is required.",maxLength:t=>!t||t.length<=1e3||"Description must be 1000 characters or less."},V=()=>{g.title&&!g.slug&&(g.slug=g.title.toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))},X=t=>{const d=t.target.files[0];d&&console.log("File selected:",d)},z=()=>".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt",A=async t=>{try{await l.fetchPublication(t);const d=l.currentPublication||{};g.translationData={...d,farsi_translations:d.farsi_translations||{},pashto_translations:d.pashto_translations||{}}}catch(d){console.error("Error loading translations:",d)}},q=async t=>{O.value=!0;try{if(t?.type!=="complete")return;const d={...t.data};d.published_at?d.published_at=new Date(d.published_at).toISOString():d.status==="published"&&(d.published_at=new Date().toISOString()),l.isEditMode?await l.updatePublication(g.id,d):await l.createPublication(d)}catch(d){console.error("Error saving publication:",d)}finally{O.value=!1}};return(t,d)=>{const k=f("v-text-field"),D=f("v-select"),N=f("v-file-input"),M=f("v-textarea");return w(),F(be,{modelValue:m(l).createDialog,"onUpdate:modelValue":d[1]||(d[1]=u=>m(l).createDialog=u),"form-title":s.value,"button-text":_.value,"translatable-fields":b,"form-data":g,rules:H,saving:O.value,onSave:q},{"base-fields":n(({formData:u,rules:y})=>[p("div",he,[i(k,{modelValue:u.title,"onUpdate:modelValue":e=>u.title=e,variant:"outlined",label:t.$t("title"),density:"compact",class:"pb-4 pr-2 w-75",rules:[y.required],onInput:V},null,8,["modelValue","onUpdate:modelValue","label","rules"]),i(D,{modelValue:u.status,"onUpdate:modelValue":e=>u.status=e,items:m(l).statusOptions,variant:"outlined",density:"compact","item-value":"value","item-title":"label","return-object":!1,label:t.$t("status"),class:"pb-4 pl-2 w-25",rules:[y.required]},null,8,["modelValue","onUpdate:modelValue","items","label","rules"])]),p("div",_e,[i(k,{modelValue:u.slug,"onUpdate:modelValue":e=>u.slug=e,variant:"outlined",label:t.$t("slug"),density:"compact",class:"pb-4 pr-2 w-50",hint:"URL-friendly version of the title","persistent-hint":""},null,8,["modelValue","onUpdate:modelValue","label"]),i(D,{modelValue:u.file_type,"onUpdate:modelValue":e=>u.file_type=e,items:m(l).fileTypeOptions,variant:"outlined",density:"compact","item-value":"value","item-title":"label","return-object":!1,label:t.$t("file_type"),class:"pb-4 pl-2 w-50"},null,8,["modelValue","onUpdate:modelValue","items","label"])]),p("div",ve,[i(k,{modelValue:u.file_path,"onUpdate:modelValue":e=>u.file_path=e,variant:"outlined",label:t.$t("file_path"),density:"compact",class:"pb-4 pr-2 w-75",hint:"URL or path to the file","persistent-hint":""},null,8,["modelValue","onUpdate:modelValue","label"]),u.status==="published"?(w(),F(k,{key:0,modelValue:u.published_at,"onUpdate:modelValue":e=>u.published_at=e,variant:"outlined",label:t.$t("published_date"),density:"compact",type:"datetime-local",class:"pb-4 pl-2 w-25"},null,8,["modelValue","onUpdate:modelValue","label"])):L("",!0)]),p("div",ye,[i(N,{modelValue:S.value,"onUpdate:modelValue":d[0]||(d[0]=e=>S.value=e),label:t.$t("upload_file"),variant:"outlined",density:"compact",accept:z(),onChange:X,"show-size":"",counter:""},null,8,["modelValue","label","accept"]),d[2]||(d[2]=p("div",{class:"text-caption text-grey mt-1"}," Supported formats: PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX, TXT ",-1))]),p("div",Pe,[i(M,{modelValue:u.description,"onUpdate:modelValue":e=>u.description=e,variant:"outlined",label:t.$t("description"),density:"compact",class:"pb-4",rules:[y.required],rows:"6",hint:"Detailed description of the publication","persistent-hint":""},null,8,["modelValue","onUpdate:modelValue","label","rules"])])]),"farsi-fields":n(({translations:u,clearTranslation:y,hasTranslation:e})=>[i(B,{modelValue:u.title,"onUpdate:modelValue":c=>u.title=c,"field-name":"title","field-label":t.$t("title"),language:"farsi","language-label":t.$t("farsi"),"has-translation":e("title"),onClear:y},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"]),i(B,{modelValue:u.description,"onUpdate:modelValue":c=>u.description=c,"field-name":"description","field-label":t.$t("description"),language:"farsi","language-label":t.$t("farsi"),"field-type":"textarea",rows:6,"has-translation":e("description"),onClear:y},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"])]),"pashto-fields":n(({translations:u,clearTranslation:y,hasTranslation:e})=>[i(B,{modelValue:u.title,"onUpdate:modelValue":c=>u.title=c,"field-name":"title","field-label":t.$t("title"),language:"pashto","language-label":t.$t("pashto"),"has-translation":e("title"),onClear:y},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"]),i(B,{modelValue:u.description,"onUpdate:modelValue":c=>u.description=c,"field-name":"description","field-label":t.$t("description"),language:"pashto","language-label":t.$t("pashto"),"field-type":"textarea",rows:6,"has-translation":e("description"),onClear:y},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"])]),_:1},8,["modelValue","form-title","button-text","form-data","saving"])}}},Ve=G(xe,[["__scopeId","data-v-9e71a649"]]),Ce=["dir"],we={class:"btn-search pt-12 pb-6"},ke={class:"text-field w-25"},$e={class:"btn flex"},Se={class:"table-section"},Oe={class:"py-2 pl-4"},Ue={class:"d-flex align-center"},Te={class:"font-weight-medium"},Fe={class:"text-caption text-grey"},De={class:"py-2 pl-4"},Me={class:"py-2 pl-4"},Ie={class:"py-2 pl-4"},Ee={class:"d-flex flex-column gap-1"},Be={class:"py-2 pl-4"},Le={key:0,class:"d-flex align-center"},Re={class:"text-caption"},He={key:1,class:"text-grey"},Xe={class:"py-2 pl-4"},ze={__name:"Publications",setup(o){const{t:a,locale:l}=J();me();const s=K(),_=R(()=>["fa","pa"].includes(l.value)?"rtl":"ltr"),b=h(""),g=h("");let S;const O=()=>{clearTimeout(S),S=setTimeout(()=>{s.fetchPublications({page:1,itemsPerPage:s.itemsPerPage,status:b.value,fileType:g.value})},500)},H=e=>{s.fetchPublications({page:e.page,itemsPerPage:e.itemsPerPage,status:b.value,fileType:g.value})},V=h([]),X=()=>{V.value.length>0&&(s.bulkDeletePublications(V.value),V.value=[])},z=()=>{s.resetCurrentPublication(),s.isEditMode=!1,s.createDialog=!0},A=e=>{s.isEditMode=!0,s.currentPublication={...e},s.createDialog=!0},q=async e=>{await s.deletePublication(e.id)},t=e=>{e.file_path&&window.open(e.file_path,"_blank")},d=e=>({pdf:"mdi-file-pdf-box",doc:"mdi-file-word-box",docx:"mdi-file-word-box",xls:"mdi-file-excel-box",xlsx:"mdi-file-excel-box",ppt:"mdi-file-powerpoint-box",pptx:"mdi-file-powerpoint-box",txt:"mdi-file-document-outline",other:"mdi-file-outline"})[e]||"mdi-file-outline",k=e=>({pdf:"red",doc:"blue",docx:"blue",xls:"green",xlsx:"green",ppt:"orange",pptx:"orange",txt:"grey",other:"grey"})[e]||"grey",D=e=>({pdf:"red",doc:"blue",docx:"blue",xls:"green",xlsx:"green",ppt:"orange",pptx:"orange",txt:"grey",other:"grey"})[e]||"primary",N=e=>{switch(e){case"published":return"success";case"draft":return"warning";case"archived":return"grey";default:return"primary"}},M=e=>e===100?"success":e>=50?"warning":"error",u=e=>e.split("/").pop(),y=R(()=>[{title:"",key:"checkbox",align:"start",sortable:!1},{title:a("title"),key:"title",align:"start",sortable:!0},{title:a("file_type"),key:"file_type",align:"center",sortable:!0},{title:a("status"),key:"status",align:"center",sortable:!0},{title:a("file_path"),key:"file_path",align:"center",sortable:!1},{title:a("published_date"),key:"published_at",align:"center",sortable:!0},{title:a("action"),key:"action",align:"center",sortable:!1}]);return ce(()=>{s.fetchPublications({page:1,itemsPerPage:s.itemsPerPage,status:b.value,fileType:g.value})}),Y(()=>l.value,()=>{s.fetchPublications({page:1,itemsPerPage:s.itemsPerPage,status:b.value,fileType:g.value})}),(e,c)=>{const Q=f("v-divider"),Z=f("v-text-field"),I=f("v-btn"),U=f("v-icon"),E=f("v-chip"),ee=f("v-checkbox"),j=f("v-list-item-title"),te=f("v-list-item"),ae=f("v-list"),le=f("v-menu"),se=f("v-data-table-server"),oe=f("v-col"),ie=f("v-row"),re=f("v-main"),ne=f("v-app");return w(),W(ge,null,[m(s).createDialog?(w(),F(Ve,{key:0})):L("",!0),p("div",{dir:_.value},[i(fe,{pageTitle:"Publications Management"}),i(Q,{thickness:1,class:"border-opacity-100"}),p("div",we,[p("div",ke,[i(Z,{color:"primary",density:"compact",variant:"outlined",label:e.$t("search"),"append-inner-icon":"mdi-magnify","hide-details":"",modelValue:m(s).publicationsSearch,"onUpdate:modelValue":c[0]||(c[0]=r=>m(s).publicationsSearch=r),onInput:O},null,8,["label","modelValue"])]),p("div",$e,[i(I,{class:"action-btn-success px-6"},{default:n(()=>[v(P(m(a)("filter")),1)]),_:1}),c[3]||(c[3]=v(" Â  ",-1)),i(I,{onClick:z,class:"action-btn-success px-6",text:e.$t("create")},null,8,["text"])])]),p("div",Se,[i(ne,null,{default:n(()=>[i(re,{class:"main"},{default:n(()=>[i(ie,null,{default:n(()=>[i(oe,null,{default:n(()=>[i(se,{dir:_.value,theme:"cursor-pointer","items-per-page":m(s).itemsPerPage,"onUpdate:itemsPerPage":c[2]||(c[2]=r=>m(s).itemsPerPage=r),headers:y.value,"items-length":m(s).totalItems,items:m(s).publications,loading:m(s).loading,"onUpdate:options":H,hover:"",class:"w-100 mx-auto"},{"item.title":n(({item:r})=>[p("td",Oe,[p("div",Ue,[i(U,{icon:d(r.file_type),size:"24",class:"mr-3",color:k(r.file_type)},null,8,["icon","color"]),p("div",null,[p("div",Te,P(r.title),1),p("div",Fe,P(r.description?.substring(0,50))+"...",1)])])])]),"item.file_type":n(({item:r})=>[p("td",De,[i(E,{color:D(r.file_type),size:"small",variant:"flat"},{default:n(()=>[v(P(m(s).getFileTypeLabel(r.file_type)),1)]),_:2},1032,["color"])])]),"item.status":n(({item:r})=>[p("td",Me,[i(E,{color:N(r.status),size:"small",variant:"flat"},{default:n(()=>[v(P(m(s).getStatusLabel(r.status)),1)]),_:2},1032,["color"])])]),"item.translations":n(({item:r})=>[p("td",Ie,[p("div",Ee,[i(E,{color:M(r.farsi_coverage||0),size:"x-small",variant:"flat"},{default:n(()=>[v(" FA: "+P(r.farsi_coverage||0)+"% ",1)]),_:2},1032,["color"]),i(E,{color:M(r.pashto_coverage||0),size:"x-small",variant:"flat"},{default:n(()=>[v(" PS: "+P(r.pashto_coverage||0)+"% ",1)]),_:2},1032,["color"])])])]),"item.file_path":n(({item:r})=>[p("td",Be,[r.file_path?(w(),W("div",Le,[i(U,{icon:"mdi-file",size:"16",class:"mr-2"}),p("span",Re,P(u(r.file_path)),1)])):(w(),W("span",He,"No file"))])]),"item.published_at":n(({item:r})=>[p("td",Xe,[p("span",null,P(m(s).formatDate(r.published_at)),1)])]),"item.checkbox":n(({item:r})=>[i(ee,{value:r.id,modelValue:V.value,"onUpdate:modelValue":c[1]||(c[1]=$=>V.value=$),class:"w-6 d-flex"},null,8,["value","modelValue"])]),"item.action":n(({item:r})=>[i(le,null,{activator:n(({props:$})=>[i(I,pe({icon:"mdi-dots-vertical"},$,{variant:"text"}),null,16)]),default:n(()=>[i(ae,null,{default:n(()=>[i(te,null,{default:n(()=>[i(j,{onClick:$=>A(r),class:"cursor-pointer d-flex gap-3 justify-left pb-3"},{default:n(()=>[i(U,{color:"tealColor"},{default:n(()=>[...c[4]||(c[4]=[v("mdi-square-edit-outline",-1)])]),_:1}),v(" "+P(e.$t("edit")),1)]),_:1},8,["onClick"]),r.file_path?(w(),F(j,{key:0,onClick:$=>t(r),class:"cursor-pointer d-flex gap-3 pb-3"},{default:n(()=>[i(U,{color:"blue"},{default:n(()=>[...c[5]||(c[5]=[v("mdi-download",-1)])]),_:1}),c[6]||(c[6]=v(" Download ",-1))]),_:1},8,["onClick"])):L("",!0),i(j,{class:"cursor-pointer d-flex gap-3",onClick:$=>q(r)},{default:n(()=>[i(U,{color:"error"},{default:n(()=>[...c[7]||(c[7]=[v("mdi-delete-outline",-1)])]),_:1}),v(" "+P(e.$t("delete")),1)]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["dir","items-per-page","headers","items-length","items","loading"]),V.value.length>0?(w(),F(I,{key:0,class:"header-button",onClick:X,color:"#B71C1C",flat:"",inset:"",text:`Delete ${V.value.length} selected`},null,8,["text"])):L("",!0)]),_:1})]),_:1})]),_:1})]),_:1})])],8,Ce)],64)}}},Ge=G(ze,[["__scopeId","data-v-3de12d61"]]);export{Ge as default};
