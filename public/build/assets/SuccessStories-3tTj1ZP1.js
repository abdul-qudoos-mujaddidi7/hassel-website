import{ak as ae,j as V,M as B,r as v,am as le,s as q,c as H,z as oe,h as d,A as O,k as w,w as u,g as l,d as g,u as m,f as F,o as re,b as ie,m as y,t as P,$ as ne,F as ue}from"./_plugin-vue_export-helper-Bve7U4QZ.js";import{H as ce}from"./Header-EurA_yJ3.js";import{l as f,u as A,a as de}from"./admin-DEzJhurF.js";import{T as U,a as pe}from"./TranslationField-BohEiJDC.js";/* empty css                                                               *//* empty css              */let j=ae("SuccessStoriesRepository",{state(){return{isEditMode:v(!1),router:le(),search:v(""),loadingTable:v(!0),loading:v(!0),totalItems:v(0),selectedItems:v([]),itemsPerPage:v(5),createDialog:v(!1),successStories:B([]),successStoriesSearch:v(""),currentSuccessStory:B({}),statusOptions:B([{value:"draft",label:"Draft"},{value:"published",label:"Published"},{value:"archived",label:"Archived"}])}},actions:{setEditMode(i){this.isEditMode=i},getTodaysDate(){const i=new Date,e=i.getFullYear(),o=String(i.getMonth()+1).padStart(2,"0"),s=String(i.getDate()).padStart(2,"0");return`${e}-${o}-${s}`},async fetchSuccessStories({page:i=1,itemsPerPage:e=5,status:o=""}){this.loading=!0;try{const s=new URLSearchParams({page:i,perPage:e,search:this.successStoriesSearch});o&&s.append("status",o);const _=await V.get(`success-stories?${s}`);console.log("API Response:",_.data),_.data.success?(this.successStories=_.data.data||[],this.totalItems=_.data.meta?.total||0):(this.successStories=[],this.totalItems=0,f.error(_.data.message||"Failed to fetch data",{position:"top-right",autoClose:3e3})),this.loading=!1}catch(s){console.error("API Error:",s),console.error("Error Response:",s.response?.data),this.successStories=[],this.totalItems=0,this.loading=!1;const _=s.response?.data?.message||"Failed to fetch success stories";f.error(_,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async fetchSuccessStory(i){this.loading=!0;try{const e=await V.get(`success-stories/${i}`,{params:{include_translations:1}});this.currentSuccessStory=e.data.data,this.loading=!1}catch(e){console.error(e),this.loading=!1,f.error("Failed to fetch success story",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async createSuccessStory(i){try{const e=await V.post("success-stories",i);this.createDialog=!1,f.success("Success story created successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchSuccessStories({page:1,itemsPerPage:this.itemsPerPage})}catch(e){console.error(e);const o=e.response?.data?.message||"Failed to create success story. Please try again.";f.error(o,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async updateSuccessStory(i,e){try{const o=await V.put(`success-stories/${i}`,e);this.createDialog=!1,this.isEditMode=!1,f.success("Success story updated successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchSuccessStories({page:1,itemsPerPage:this.itemsPerPage})}catch(o){console.error(o);const s=o.response?.data?.message||"Failed to update success story. Please try again.";f.error(s,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async deleteSuccessStory(i){try{await V.delete(`success-stories/${i}`),f.success("Success story deleted successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchSuccessStories({page:1,itemsPerPage:this.itemsPerPage})}catch(e){console.error(e);const o=e.response?.data?.message||"Failed to delete success story. Please try again.";f.error(o,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async bulkDeleteSuccessStories(i){try{const e=i.map(o=>V.delete(`success-stories/${o}`));await Promise.all(e),f.success(`${i.length} success stories deleted successfully!`,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchSuccessStories({page:1,itemsPerPage:this.itemsPerPage})}catch(e){console.error(e),f.error("Failed to delete selected success stories. Please try again.",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async toggleStatus(i){try{const e=await V.post(`success-stories/${i}/toggle-status`);f.success("Success story status updated successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchSuccessStories({page:1,itemsPerPage:this.itemsPerPage})}catch(e){console.error(e);const o=e.response?.data?.message||"Failed to update success story status. Please try again.";f.error(o,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async getPublishedSuccessStories({page:i=1,itemsPerPage:e=10}){try{const o=new URLSearchParams({page:i,perPage:e,search:this.successStoriesSearch});return(await V.get(`success-stories/published?${o}`)).data}catch(o){return console.error(o),{success:!1,data:[],meta:{total:0}}}},getStatusLabel(i){const e=this.statusOptions.find(o=>o.value===i);return e?e.label:i},formatDate(i){return i?new Date(i).toLocaleDateString():""},resetCurrentSuccessStory(){this.currentSuccessStory={id:null,title:"",slug:"",content:"",featured_image:"",author_name:"",author_title:"",location:"",status:"draft",published_at:null}}}});const ge={class:"flex w-100"},me={class:"flex w-100"},he={class:"flex w-100"},fe={class:"w-100"},_e={__name:"CreateSuccessStoryTranslatable",setup(i){const{t:e}=A(),o=j(),s=H(()=>o.isEditMode?e("update"):e("create")),_=H(()=>o.isEditMode?e("update"):e("submit")),$=v(!1),M=["title","client_name","story"],p=B({id:null,title:"",slug:"",client_name:"",story:"",image:"",status:"draft",published_at:null});oe(()=>o.currentSuccessStory,t=>{t&&Object.keys(t).length>0&&(p.id=t.id,p.title=t.title||"",p.slug=t.slug||"",p.client_name=t.client_name||"",p.story=t.story||"",p.image=t.image||"",p.status=t.status||"draft",p.published_at=t.published_at?new Date(t.published_at).toISOString().slice(0,16):null,p.translationData={...t,farsi_translations:t.farsi_translations||{},pashto_translations:t.pashto_translations||{}})},{deep:!0,immediate:!0});const D={required:t=>!!t||"This field is required."},S=()=>{p.title&&!p.slug&&(p.slug=p.title.toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))},E=async({data:t})=>{$.value=!0;try{const b={...t};b.status==="published"?b.published_at=b.published_at?new Date(b.published_at).toISOString():new Date().toISOString():b.published_at=null,o.isEditMode?await o.updateSuccessStory(p.id,b):await o.createSuccessStory(b)}finally{$.value=!1}};return(t,b)=>{const C=d("v-text-field"),R=d("v-select"),L=d("v-textarea");return w(),O(pe,{modelValue:m(o).createDialog,"onUpdate:modelValue":b[0]||(b[0]=r=>m(o).createDialog=r),"form-title":s.value,"button-text":_.value,"translatable-fields":M,"form-data":p,rules:D,saving:$.value,"is-edit-mode":m(o).isEditMode,onSave:E},{"base-fields":u(({formData:r,rules:n})=>[g("div",ge,[l(C,{modelValue:r.title,"onUpdate:modelValue":a=>r.title=a,variant:"outlined",label:t.$t("title"),density:"compact",class:"pb-4 pr-2 w-75",rules:[n.required],onInput:S},null,8,["modelValue","onUpdate:modelValue","label","rules"]),l(R,{modelValue:r.status,"onUpdate:modelValue":a=>r.status=a,items:m(o).statusOptions,variant:"outlined",density:"compact","item-value":"value","item-title":"label","return-object":!1,label:t.$t("status"),class:"pb-4 pl-2 w-25",rules:[n.required]},null,8,["modelValue","onUpdate:modelValue","items","label","rules"])]),g("div",me,[l(C,{modelValue:r.slug,"onUpdate:modelValue":a=>r.slug=a,variant:"outlined",label:t.$t("slug"),density:"compact",class:"pb-4 pr-2 w-50",hint:"URL-friendly version of the title","persistent-hint":""},null,8,["modelValue","onUpdate:modelValue","label"]),l(C,{modelValue:r.client_name,"onUpdate:modelValue":a=>r.client_name=a,variant:"outlined",label:t.$t("client_name"),density:"compact",class:"pb-4 pl-2 w-50"},null,8,["modelValue","onUpdate:modelValue","label"])]),g("div",he,[l(C,{modelValue:r.image,"onUpdate:modelValue":a=>r.image=a,variant:"outlined",label:t.$t("featured_image"),density:"compact",class:"pb-4 pr-2 w-50",hint:"URL of the featured image","persistent-hint":""},null,8,["modelValue","onUpdate:modelValue","label"]),r.status==="published"?(w(),O(C,{key:0,modelValue:r.published_at,"onUpdate:modelValue":a=>r.published_at=a,variant:"outlined",label:t.$t("published_date"),density:"compact",type:"datetime-local",class:"pb-4 pl-2 w-50"},null,8,["modelValue","onUpdate:modelValue","label"])):F("",!0)]),g("div",fe,[l(L,{modelValue:r.story,"onUpdate:modelValue":a=>r.story=a,variant:"outlined",label:t.$t("content"),density:"compact",class:"pb-4",rules:[n.required],rows:"8",hint:"Main content of the success story","persistent-hint":""},null,8,["modelValue","onUpdate:modelValue","label","rules"])])]),"farsi-fields":u(({translations:r,clearTranslation:n,hasTranslation:a})=>[l(U,{modelValue:r.title,"onUpdate:modelValue":h=>r.title=h,"field-name":"title","field-label":t.$t("title"),language:"farsi","language-label":t.$t("dari"),"has-translation":a("title"),onClear:n},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"]),l(U,{modelValue:r.client_name,"onUpdate:modelValue":h=>r.client_name=h,"field-name":"client_name","field-label":t.$t("client_name"),language:"farsi","language-label":t.$t("dari"),"has-translation":a("client_name"),onClear:n},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"]),l(U,{modelValue:r.story,"onUpdate:modelValue":h=>r.story=h,"field-name":"story","field-label":t.$t("content"),language:"farsi","language-label":t.$t("dari"),"field-type":"textarea",rows:8,"has-translation":a("story"),onClear:n},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"])]),"pashto-fields":u(({translations:r,clearTranslation:n,hasTranslation:a})=>[l(U,{modelValue:r.title,"onUpdate:modelValue":h=>r.title=h,"field-name":"title","field-label":t.$t("title"),language:"pashto","language-label":t.$t("pashto"),"has-translation":a("title"),onClear:n},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"]),l(U,{modelValue:r.client_name,"onUpdate:modelValue":h=>r.client_name=h,"field-name":"client_name","field-label":t.$t("client_name"),language:"pashto","language-label":t.$t("pashto"),"has-translation":a("client_name"),onClear:n},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"]),l(U,{modelValue:r.story,"onUpdate:modelValue":h=>r.story=h,"field-name":"story","field-label":t.$t("content"),language:"pashto","language-label":t.$t("pashto"),"field-type":"textarea",rows:8,"has-translation":a("story"),onClear:n},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"])]),_:1},8,["modelValue","form-title","button-text","form-data","saving","is-edit-mode"])}}},be=q(_e,[["__scopeId","data-v-05721b18"]]),ve=["dir"],ye={class:"btn-search pt-12 pb-6"},Se={class:"text-field w-25"},Pe={class:"btn flex"},Ve={class:"table-section"},Ce={class:"py-2 pl-4"},$e={class:"d-flex align-center"},ke={class:"font-weight-medium"},Ue={class:"text-caption text-grey"},we={class:"py-2 pl-4"},Oe={class:"py-2 pl-4"},Me={__name:"SuccessStories",setup(i){const{t:e,locale:o}=A();de();const s=j(),_=H(()=>["fa","pa"].includes(o.value)?"rtl":"ltr"),$=v("");let M;const p=()=>{clearTimeout(M),M=setTimeout(()=>{s.fetchSuccessStories({page:1,itemsPerPage:s.itemsPerPage,status:$.value})},500)},D=n=>{s.fetchSuccessStories({page:n.page,itemsPerPage:n.itemsPerPage,status:$.value})},S=v([]),E=()=>{S.value.length>0&&(s.bulkDeleteSuccessStories(S.value),S.value=[])},t=()=>{s.resetCurrentSuccessStory(),s.isEditMode=!1,s.createDialog=!0},b=n=>{s.isEditMode=!0,s.currentSuccessStory={...n},s.createDialog=!0},C=async n=>{await s.deleteSuccessStory(n.id)},R=async n=>{await s.toggleStatus(n.id)},L=n=>{switch(n){case"published":return"success";case"draft":return"warning";case"archived":return"grey";default:return"primary"}},r=H(()=>[{title:"",key:"checkbox",align:"start",sortable:!1},{title:e("title"),key:"title",align:"start",sortable:!0},{title:e("status"),key:"status",align:"center",sortable:!0},{title:e("published_date"),key:"published_at",align:"center",sortable:!0},{title:e("created_at"),key:"created_at",align:"center",sortable:!0},{title:e("action"),key:"action",align:"center",sortable:!1}]);return re(()=>{s.fetchSuccessStories({page:1,itemsPerPage:s.itemsPerPage})}),(n,a)=>{const h=d("v-divider"),z=d("v-text-field"),x=d("v-btn"),I=d("v-icon"),N=d("v-img"),Y=d("v-avatar"),G=d("v-chip"),J=d("v-checkbox"),T=d("v-list-item-title"),K=d("v-list-item"),Q=d("v-list"),W=d("v-menu"),X=d("v-data-table-server"),Z=d("v-col"),ee=d("v-row"),te=d("v-main"),se=d("v-app");return w(),ie(ue,null,[m(s).createDialog?(w(),O(be,{key:0})):F("",!0),g("div",{dir:_.value},[l(ce,{pageTitle:"Success Stories Management"}),l(h,{thickness:1,class:"border-opacity-100"}),g("div",ye,[g("div",Se,[l(z,{color:"primary",density:"compact",variant:"outlined",label:n.$t("search"),"append-inner-icon":"mdi-magnify","hide-details":"",modelValue:m(s).successStoriesSearch,"onUpdate:modelValue":a[0]||(a[0]=c=>m(s).successStoriesSearch=c),onInput:p},null,8,["label","modelValue"])]),g("div",Pe,[l(x,{variant:"outlined",color:"primary",class:"px-6"},{default:u(()=>[y(P(m(e)("filter")),1)]),_:1}),a[4]||(a[4]=y(" Â  ",-1)),l(x,{onClick:t,class:"create-btn-gradient px-6",text:n.$t("create")},{default:u(()=>[l(I,null,{default:u(()=>[...a[3]||(a[3]=[y("mdi-plus",-1)])]),_:1})]),_:1},8,["text"])])]),g("div",Ve,[l(se,null,{default:u(()=>[l(te,{class:"main"},{default:u(()=>[l(ee,null,{default:u(()=>[l(Z,null,{default:u(()=>[l(X,{dir:_.value,theme:"cursor-pointer","items-per-page":m(s).itemsPerPage,"onUpdate:itemsPerPage":a[2]||(a[2]=c=>m(s).itemsPerPage=c),headers:r.value,"items-length":m(s).totalItems,items:m(s).successStories,loading:m(s).loading,"onUpdate:options":D,hover:"",class:"w-100 mx-auto"},{"item.title":u(({item:c})=>[g("td",Ce,[g("div",$e,[c.featured_image?(w(),O(Y,{key:0,size:"40",class:"mr-3"},{default:u(()=>[l(N,{src:c.featured_image,alt:c.title},null,8,["src","alt"])]),_:2},1024)):F("",!0),g("div",null,[g("div",ke,P(c.title),1),g("div",Ue,P(c.author_name),1)])])])]),"item.status":u(({item:c})=>[g("td",we,[l(G,{color:L(c.status),size:"small",variant:"flat"},{default:u(()=>[y(P(m(s).getStatusLabel(c.status)),1)]),_:2},1032,["color"])])]),"item.published_at":u(({item:c})=>[g("td",Oe,[g("span",null,P(m(s).formatDate(c.published_at)),1)])]),"item.checkbox":u(({item:c})=>[l(J,{value:c.id,modelValue:S.value,"onUpdate:modelValue":a[1]||(a[1]=k=>S.value=k),class:"w-6 d-flex"},null,8,["value","modelValue"])]),"item.action":u(({item:c})=>[l(W,null,{activator:u(({props:k})=>[l(x,ne({icon:"mdi-dots-vertical"},k,{variant:"text"}),null,16)]),default:u(()=>[l(Q,null,{default:u(()=>[l(K,null,{default:u(()=>[l(T,{onClick:k=>b(c),class:"cursor-pointer d-flex gap-3 justify-left pb-3"},{default:u(()=>[l(I,{color:"tealColor"},{default:u(()=>[...a[5]||(a[5]=[y("mdi-square-edit-outline",-1)])]),_:1}),y(" "+P(n.$t("edit")),1)]),_:1},8,["onClick"]),l(T,{onClick:k=>R(c),class:"cursor-pointer d-flex gap-3 pb-3"},{default:u(()=>[l(I,{color:c.status==="published"?"orange":"green"},{default:u(()=>[y(P(c.status==="published"?"mdi-eye-off":"mdi-eye"),1)]),_:2},1032,["color"]),y(" "+P(c.status==="published"?"Unpublish":"Publish"),1)]),_:2},1032,["onClick"]),l(T,{class:"cursor-pointer d-flex gap-3",onClick:k=>C(c)},{default:u(()=>[l(I,{color:"error"},{default:u(()=>[...a[6]||(a[6]=[y("mdi-delete-outline",-1)])]),_:1}),y(" "+P(n.$t("delete")),1)]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["dir","items-per-page","headers","items-length","items","loading"]),S.value.length>0?(w(),O(x,{key:0,class:"header-button",onClick:E,color:"#B71C1C",flat:"",inset:"",text:`Delete ${S.value.length} selected`},null,8,["text"])):F("",!0)]),_:1})]),_:1})]),_:1})]),_:1})])],8,ve)],64)}}},Ee=q(Me,[["__scopeId","data-v-8b132475"]]);export{Ee as default};
