import{al as oe,i as I,N as W,r as _,G as re,q as Y,c as B,y as H,h as p,z as q,j as x,w as u,g as s,d as f,b as A,f as N,t as k,B as ne,D as ie,l as $,u as P,o as ue,s as de,a0 as ce,F as ge}from"./_plugin-vue_export-helper-P6s7mfAX.js";import{H as pe}from"./Header-Dc2gjrUc.js";import{l as S,u as Q,a as me}from"./admin-C1tUPR0Q.js";import{T as M,a as fe}from"./TranslationField-DYZ6aUjw.js";/* empty css                                                               *//* empty css              */let X=oe("NewsRepository",{state(){return{isEditMode:_(!1),router:re(),search:_(""),loadingTable:_(!0),loading:_(!0),totalItems:_(0),selectedItems:_([]),itemsPerPage:_(5),createDialog:_(!1),news:W([]),newsSearch:_(""),currentNews:W({}),statusOptionsBase:[{value:"draft",labelKey:"status.draft"},{value:"published",labelKey:"status.published"},{value:"archived",labelKey:"status.archived"}]}},actions:{setEditMode(i){this.isEditMode=i},getTodaysDate(){const i=new Date,t=i.getFullYear(),l=String(i.getMonth()+1).padStart(2,"0"),a=String(i.getDate()).padStart(2,"0");return`${t}-${l}-${a}`},async fetchNews({page:i=1,itemsPerPage:t=5,status:l=""}){this.loading=!0;try{const a=new URLSearchParams({page:i,perPage:t,search:this.newsSearch});l&&a.append("status",l);const b=await I.get(`news?${a}`);b.data.success?(this.news=b.data.data||[],this.totalItems=b.data.meta?.total||0):(this.news=[],this.totalItems=0,S.error(b.data.message||"Failed to fetch data",{position:"top-right",autoClose:3e3})),this.loading=!1}catch(a){this.news=[],this.totalItems=0,this.loading=!1;const b=a.response?.data?.message||"Failed to fetch news articles";S.error(b,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async fetchNewsItem(i){this.loading=!0;try{const t=await I.get(`news/${i}`,{params:{include_translations:1}});this.currentNews=t.data.data,this.loading=!1}catch{this.loading=!1,S.error("Failed to fetch news article",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async createNews(i){try{const t=await I.post("news",i);this.createDialog=!1,S.success("News article created successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchNews({page:1,itemsPerPage:this.itemsPerPage})}catch(t){const l=t.response?.data?.message||"Failed to create news article. Please try again.";S.error(l,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async updateNews(i,t){try{const l=await I.post(`news/${i}`,t);this.createDialog=!1,this.isEditMode=!1,S.success("News article updated successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchNews({page:1,itemsPerPage:this.itemsPerPage})}catch(l){const a=l.response?.data?.message||"Failed to update news article. Please try again.";S.error(a,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async deleteNews(i){try{await I.delete(`news/${i}`),S.success("News article deleted successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchNews({page:1,itemsPerPage:this.itemsPerPage})}catch(t){const l=t.response?.data?.message||"Failed to delete news article. Please try again.";S.error(l,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async bulkDeleteNews(i){try{const t=i.map(l=>I.delete(`news/${l}`));await Promise.all(t),S.success(`${i.length} news articles deleted successfully!`,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchNews({page:1,itemsPerPage:this.itemsPerPage})}catch{S.error("Failed to delete selected news articles. Please try again.",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async toggleStatus(i){try{const t=await I.post(`news/${i}/toggle-status`);S.success("News article status updated successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchNews({page:1,itemsPerPage:this.itemsPerPage})}catch(t){const l=t.response?.data?.message||"Failed to update news article status. Please try again.";S.error(l,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async getPublishedNews({page:i=1,itemsPerPage:t=10}){try{const l=new URLSearchParams({page:i,perPage:t,search:this.newsSearch});return(await I.get(`news/published?${l}`)).data}catch{return{success:!1,data:[],meta:{total:0}}}},getStatusLabel(i,t){const l=t||(b=>b),a=this.statusOptionsBase.find(b=>b.value===i);return a?l(a.labelKey):i},formatDate(i){return i?new Date(i).toLocaleDateString():""},resetCurrentNews(){this.currentNews={id:null,title:"",slug:"",excerpt:"",content:"",featured_image:"",status:"draft",published_at:null}}}});const he={class:"flex w-100"},ve={class:"flex w-100"},_e={class:"w-100 mb-4"},be={class:"image-upload-label mb-2 d-block"},ye={class:"photo-upload-container"},Pe=["src"],we={class:"photo-overlay"},Ce={key:0,class:"w-100"},Ve={class:"w-100"},Se={__name:"CreateNews",setup(i){const{t}=Q(),l=X(),a=B(()=>l.statusOptionsBase.map(e=>({value:e.value,label:t(e.labelKey)}))),b=B(()=>l.isEditMode?t("update"):t("create")),R=B(()=>l.isEditMode?t("update"):t("submit")),L=["title","excerpt","content"],r=W({id:null,title:"",slug:"",excerpt:"",content:"",featured_image:"",status:"draft",published_at:null}),C=_(null),m=_(null),D=_(null),U=B(()=>m.value||r.featured_image||null);H(C,e=>{if(e&&e instanceof File){if(!["image/png","image/jpeg","image/jpg","image/webp"].includes(e.type)){alert(t("please_select_image")||"Please select a valid image file (PNG, JPEG, JPG, or WebP)"),C.value=null,m.value=null;return}if(e.size>3*1024*1024){alert(t("image_too_large")||"Image size must be less than 3MB"),C.value=null,m.value=null;return}const y=new FileReader;y.onload=d=>{m.value=d.target.result},y.onerror=()=>{m.value=null},y.readAsDataURL(e)}else e||r.featured_image||(m.value=null)}),H(()=>r.featured_image,e=>{e&&!m.value&&!C.value&&(m.value=e)},{immediate:!0});const T=_(!1),j=_(null);H(()=>l.currentNews,async e=>{if(e&&Object.keys(e).length>0){r.id=e.id,r.title=e.title||"",r.slug=e.slug||"",r.excerpt=e.excerpt||"",r.content=e.content||"",r.featured_image=e.featured_image||"",r.status=e.status||"draft",r.published_at=e.published_at?new Date(e.published_at).toISOString().slice(0,16):null,C.value=null,m.value=r.featured_image||null,j.value=r.featured_image||null;let n={},y={};e.farsi_translations&&(n=typeof e.farsi_translations=="string"?JSON.parse(e.farsi_translations):e.farsi_translations),e.pashto_translations&&(y=typeof e.pashto_translations=="string"?JSON.parse(e.pashto_translations):e.pashto_translations),e.translations&&Array.isArray(e.translations)&&e.translations.forEach(d=>{const O=d.field_name,F=d.content;d.language==="farsi"||d.language==="fa"?n[O]=F:(d.language==="pashto"||d.language==="ps")&&(y[O]=F)}),r.translationData={...e,farsi_translations:n,pashto_translations:y}}},{deep:!0,immediate:!0}),H(()=>r.status,e=>{e==="published"&&!r.published_at&&(r.published_at=new Date().toISOString().slice(0,16))});const J={required:e=>!!e||t("field_required"),maxLength:e=>!e||e.length<=500||t("excerpt_max_length")},K=()=>{r.title&&!r.slug&&(r.slug=r.title.toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))},z=()=>{D.value?.click()},h=e=>{if(e&&e.target&&e.target.files&&e.target.files.length>0){const n=e.target.files[0];C.value=n}},w=()=>{C.value=null,m.value=null,r.featured_image="",D.value&&(D.value.value="")},G=async e=>{T.value=!0;try{if(e.type==="complete"){const n=new FormData;Object.keys(e.data).forEach(d=>{d!=="featured_image"&&(d==="translations"?n.append(d,JSON.stringify(e.data[d])):e.data[d]!==null&&e.data[d]!==void 0&&n.append(d,e.data[d]))}),C.value?n.append("featured_image",C.value):l.isEditMode&&!m.value&&!C.value&&j.value?n.append("featured_image",""):r.featured_image&&!r.featured_image.startsWith("data:")&&!C.value?n.append("featured_image",r.featured_image):l.isEditMode||n.append("featured_image",""),r.published_at?n.set("published_at",new Date(r.published_at).toISOString()):r.status==="published"&&n.set("published_at",new Date().toISOString());const y=e.data.translations||{};l.isEditMode?await l.updateNews(r.id,n):await l.createNews(n)}}catch{}finally{T.value=!1}};return(e,n)=>{const y=p("v-text-field"),d=p("v-select"),O=p("v-icon"),F=p("v-textarea");return x(),q(fe,{modelValue:P(l).createDialog,"onUpdate:modelValue":n[0]||(n[0]=o=>P(l).createDialog=o),"form-title":b.value,"button-text":R.value,"translatable-fields":L,"form-data":r,rules:J,saving:T.value,"is-edit-mode":P(l).isEditMode,onSave:G},{"base-fields":u(({formData:o,rules:v})=>[f("div",he,[s(y,{modelValue:o.title,"onUpdate:modelValue":c=>o.title=c,variant:"outlined",label:e.$t("title"),density:"compact",class:"pb-4 pr-2 w-75",rules:[v.required],onInput:K},null,8,["modelValue","onUpdate:modelValue","label","rules"]),s(d,{modelValue:o.status,"onUpdate:modelValue":c=>o.status=c,items:a.value,variant:"outlined",density:"compact","item-value":"value","item-title":"label","return-object":!1,label:e.$t("status"),class:"pb-4 pl-2 w-25",rules:[v.required]},null,8,["modelValue","onUpdate:modelValue","items","label","rules"])]),f("div",ve,[s(y,{modelValue:o.slug,"onUpdate:modelValue":c=>o.slug=c,variant:"outlined",label:e.$t("slug"),density:"compact",class:"pb-4 pr-2 w-50","persistent-hint":""},null,8,["modelValue","onUpdate:modelValue","label"]),s(y,{modelValue:o.excerpt,"onUpdate:modelValue":c=>o.excerpt=c,variant:"outlined",label:e.$t("excerpt"),density:"compact",class:"pb-4 pl-2 w-50",counter:500,rules:[v.maxLength],"persistent-hint":""},null,8,["modelValue","onUpdate:modelValue","label","rules"])]),f("div",_e,[f("label",be,k(e.$t("featured_image")),1),f("div",ye,[f("input",{ref_key:"fileInputRef",ref:D,type:"file",accept:"image/png, image/jpeg, image/jpg, image/webp",style:{display:"none"},onChange:h},null,544),ne(f("img",{src:U.value,class:"photo-preview"},null,8,Pe),[[ie,U.value!==null]]),f("div",we,[U.value?N("",!0):(x(),A("button",{key:0,type:"button",onClick:z,class:"overlay-button"},[s(O,{size:"x-large",color:"blue-grey-lighten-2"},{default:u(()=>[...n[1]||(n[1]=[$("mdi-camera",-1)])]),_:1})])),U.value?(x(),A("button",{key:1,type:"button",onClick:w,class:"close-button"},[s(O,{size:"lg",color:"red"},{default:u(()=>[...n[2]||(n[2]=[$("mdi-close",-1)])]),_:1})])):N("",!0),U.value?(x(),A("button",{key:2,type:"button",onClick:z,class:"edit-button"},[s(O,{size:"small"},{default:u(()=>[...n[3]||(n[3]=[$("mdi-pencil",-1)])]),_:1})])):N("",!0)])])]),o.status==="published"?(x(),A("div",Ce,[s(y,{modelValue:o.published_at,"onUpdate:modelValue":c=>o.published_at=c,variant:"outlined",label:e.$t("published_date"),density:"compact",type:"datetime-local",class:"pb-4"},null,8,["modelValue","onUpdate:modelValue","label"])])):N("",!0),f("div",Ve,[s(F,{modelValue:o.content,"onUpdate:modelValue":c=>o.content=c,variant:"outlined",label:e.$t("content"),density:"compact",class:"pb-4",rules:[v.required],rows:"8","persistent-hint":""},null,8,["modelValue","onUpdate:modelValue","label","rules"])])]),"farsi-fields":u(({translations:o,clearTranslation:v,hasTranslation:c})=>[s(M,{modelValue:o.title,"onUpdate:modelValue":V=>o.title=V,"field-name":"title","field-label":e.$t("title"),language:"farsi","language-label":e.$t("dari"),"has-translation":c("title"),onClear:v},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"]),s(M,{modelValue:o.excerpt,"onUpdate:modelValue":V=>o.excerpt=V,"field-name":"excerpt","field-label":e.$t("excerpt"),language:"farsi","language-label":e.$t("dari"),"field-type":"textarea",rows:3,"has-translation":c("excerpt"),onClear:v},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"]),s(M,{modelValue:o.content,"onUpdate:modelValue":V=>o.content=V,"field-name":"content","field-label":e.$t("content"),language:"farsi","language-label":e.$t("dari"),"field-type":"textarea",rows:8,"has-translation":c("content"),onClear:v},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"])]),"pashto-fields":u(({translations:o,clearTranslation:v,hasTranslation:c})=>[s(M,{modelValue:o.title,"onUpdate:modelValue":V=>o.title=V,"field-name":"title","field-label":e.$t("title"),language:"pashto","language-label":e.$t("pashto"),"has-translation":c("title"),onClear:v},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"]),s(M,{modelValue:o.excerpt,"onUpdate:modelValue":V=>o.excerpt=V,"field-name":"excerpt","field-label":e.$t("excerpt"),language:"pashto","language-label":e.$t("pashto"),"field-type":"textarea",rows:3,"has-translation":c("excerpt"),onClear:v},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"]),s(M,{modelValue:o.content,"onUpdate:modelValue":V=>o.content=V,"field-name":"content","field-label":e.$t("content"),language:"pashto","language-label":e.$t("pashto"),"field-type":"textarea",rows:8,"has-translation":c("content"),onClear:v},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"])]),_:1},8,["modelValue","form-title","button-text","form-data","saving","is-edit-mode"])}}},$e=Y(Se,[["__scopeId","data-v-d4de0e47"]]),ke=["dir"],xe={class:"btn-search pt-12 pb-6"},Oe={class:"text-field w-25"},Ie={class:"flex"},Ue={class:"table-section"},Ne={class:"py-2 pl-4 d-flex align-center"},De={class:"font-weight-medium"},Fe={class:"text-caption text-grey"},Ee={class:"py-2 pl-4"},Me={__name:"News",setup(i){const{t,locale:l}=Q();me();const a=X(),b=B(()=>["fa","ps"].includes(l.value)?"rtl":"ltr"),R=_("");let L;const r=()=>{clearTimeout(L),L=setTimeout(()=>{a.fetchNews({page:1,itemsPerPage:a.itemsPerPage,status:R.value})},500)},C=h=>{a.fetchNews({page:h.page,itemsPerPage:h.itemsPerPage,status:R.value})},m=_([]),D=()=>{m.value.length>0&&(a.bulkDeleteNews(m.value),m.value=[])},U=()=>{a.resetCurrentNews(),a.isEditMode=!1,a.createDialog=!0},T=async h=>{a.isEditMode=!0,await a.fetchNewsItem(h.id),a.createDialog=!0},j=async h=>{await a.deleteNews(h.id)},J=async h=>{await a.toggleStatus(h.id)},K=h=>{switch(h){case"published":return"success";case"draft":return"warning";case"archived":return"grey";default:return"primary"}},z=B(()=>[{title:"",key:"checkbox",align:"start",sortable:!1},{title:t("title"),key:"title",align:"start",sortable:!0},{title:t("status"),key:"status",align:"center",sortable:!0},{title:t("published_date"),key:"published_at",align:"center",sortable:!0},{title:t("action"),key:"action",align:"center",sortable:!1}]);return ue(()=>{a.fetchNews({page:1,itemsPerPage:a.itemsPerPage})}),H(()=>l.value,()=>{a.fetchNews({page:1,itemsPerPage:a.itemsPerPage,status:R.value})}),(h,w)=>{const G=p("v-divider"),e=p("v-text-field"),n=p("v-btn"),y=p("v-img"),d=p("v-avatar"),O=p("v-chip"),F=p("v-checkbox"),o=p("v-icon"),v=p("v-list-item-title"),c=p("v-list-item"),V=p("v-list"),Z=p("v-menu"),ee=p("v-data-table-server"),te=p("v-col"),ae=p("v-row"),se=p("v-main"),le=p("v-app");return x(),A(ge,null,[P(a).createDialog?(x(),q($e,{key:0})):N("",!0),f("div",{dir:b.value},[s(pe,{pageTitle:h.$t("news_management")},null,8,["pageTitle"]),s(G,{thickness:1,class:"border-opacity-100"}),f("div",xe,[f("div",Oe,[s(e,{color:"primary",density:"compact",variant:"outlined",label:h.$t("search"),"append-inner-icon":"mdi-magnify","hide-details":"",modelValue:P(a).newsSearch,"onUpdate:modelValue":w[0]||(w[0]=g=>P(a).newsSearch=g),onInput:r},null,8,["label","modelValue"])]),f("div",Ie,[s(n,{class:"action-btn-success"},{default:u(()=>[$(k(P(t)("filter")),1)]),_:1}),w[3]||(w[3]=$(" Â  ",-1)),s(n,{onClick:de(U,["stop"]),variant:"flat",class:"action-btn-success"},{default:u(()=>[$(k(P(t)("create")),1)]),_:1})])]),f("div",Ue,[s(le,null,{default:u(()=>[s(se,{class:"main"},{default:u(()=>[s(ae,null,{default:u(()=>[s(te,null,{default:u(()=>[s(ee,{dir:b.value,theme:"cursor-pointer","items-per-page":P(a).itemsPerPage,"onUpdate:itemsPerPage":w[2]||(w[2]=g=>P(a).itemsPerPage=g),headers:z.value,"items-length":P(a).totalItems,items:P(a).news,loading:P(a).loading,"onUpdate:options":C,hover:"",class:"w-100 mx-auto"},{"item.title":u(({item:g})=>[f("div",Ne,[g.featured_image?(x(),q(d,{key:0,size:"40",class:"mr-3"},{default:u(()=>[s(y,{src:g.featured_image,alt:g.title},null,8,["src","alt"])]),_:2},1024)):N("",!0),f("div",null,[f("div",De,k(g.title),1),f("div",Fe,k(g.excerpt),1)])])]),"item.status":u(({item:g})=>[f("div",Ee,[s(O,{color:K(g.status),size:"small",variant:"flat"},{default:u(()=>[$(k(P(a).getStatusLabel(g.status,P(t))),1)]),_:2},1032,["color"])])]),"item.checkbox":u(({item:g})=>[s(F,{value:g.id,modelValue:m.value,"onUpdate:modelValue":w[1]||(w[1]=E=>m.value=E),class:"w-6 d-flex"},null,8,["value","modelValue"])]),"item.action":u(({item:g})=>[s(Z,null,{activator:u(({props:E})=>[s(n,ce({icon:"mdi-dots-vertical"},E,{variant:"text"}),null,16)]),default:u(()=>[s(V,null,{default:u(()=>[s(c,null,{default:u(()=>[s(v,{onClick:E=>T(g),class:"cursor-pointer d-flex gap-3 justify-left pb-3"},{default:u(()=>[s(o,{color:"tealColor"},{default:u(()=>[...w[4]||(w[4]=[$("mdi-square-edit-outline",-1)])]),_:1}),$(" "+k(h.$t("edit")),1)]),_:1},8,["onClick"]),s(v,{onClick:E=>J(g),class:"cursor-pointer d-flex gap-3 pb-3"},{default:u(()=>[s(o,{color:g.status==="published"?"orange":"green"},{default:u(()=>[$(k(g.status==="published"?"mdi-eye-off":"mdi-eye"),1)]),_:2},1032,["color"]),$(" "+k(g.status==="published"?"Unpublish":"Publish"),1)]),_:2},1032,["onClick"]),s(v,{class:"cursor-pointer d-flex gap-3",onClick:E=>j(g)},{default:u(()=>[s(o,{color:"error"},{default:u(()=>[...w[5]||(w[5]=[$("mdi-delete-outline",-1)])]),_:1}),$(" "+k(h.$t("delete")),1)]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["dir","items-per-page","headers","items-length","items","loading"]),m.value.length>0?(x(),q(n,{key:0,class:"header-button",onClick:D,color:"#B71C1C",flat:"",inset:"",text:`Delete ${m.value.length} selected`},null,8,["text"])):N("",!0)]),_:1})]),_:1})]),_:1})]),_:1})])],8,ke)],64)}}},je=Y(Me,[["__scopeId","data-v-8ab25739"]]);export{je as default};
