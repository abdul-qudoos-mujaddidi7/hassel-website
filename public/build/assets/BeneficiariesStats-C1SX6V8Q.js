import{al as Z,i as S,N,r as g,G as ee,q as j,c as w,y as te,h as l,b as q,j as T,g as a,w as i,d as _,t as h,l as b,u as f,z as R,f as U,a0 as ae,k as se,F as re}from"./_plugin-vue_export-helper-BPPfTR4S.js";import{H as ie}from"./Header-CgJPtGh2.js";import{l as m,u as z,a as oe}from"./admin-BgzI1_lQ.js";/* empty css                                                               *//* empty css              */let L=Z("BeneficiariesRepository",{state(){return{isEditMode:g(!1),router:ee(),search:g(""),loadingTable:g(!0),loading:g(!0),totalItems:g(0),selectedItems:g([]),itemsPerPage:g(5),createDialog:g(!1),beneficiariesStats:N([]),beneficiariesStatsSearch:g(""),currentStat:N({}),statTypesBase:[{value:"beneficiaries",labelKey:"stat_type.beneficiaries"},{value:"total_beneficiaries",labelKey:"stat_type.total_beneficiaries"},{value:"male_beneficiaries",labelKey:"stat_type.male_beneficiaries"},{value:"female_beneficiaries",labelKey:"stat_type.female_beneficiaries"},{value:"programs_completed",labelKey:"stat_type.programs_completed"},{value:"provinces_reached",labelKey:"stat_type.provinces_reached"},{value:"cooperatives_formed",labelKey:"stat_type.cooperatives_formed"},{value:"projects",labelKey:"stat_type.projects"},{value:"staff",labelKey:"stat_type.staff"},{value:"partners",labelKey:"stat_type.partners"}]}},actions:{setEditMode(r){this.isEditMode=r},getTodaysDate(){const r=new Date,e=r.getFullYear(),o=String(r.getMonth()+1).padStart(2,"0"),t=String(r.getDate()).padStart(2,"0");return`${e}-${o}-${t}`},async fetchBeneficiariesStats({page:r=1,itemsPerPage:e=5}){this.loading=!0;try{const o=await S.get(`beneficiaries-stats?page=${r}&perPage=${e}&search=${this.beneficiariesStatsSearch}`);console.log("API Response:",o.data),o.data.success?(this.beneficiariesStats=o.data.data||[],this.totalItems=o.data.meta?.total||0):(this.beneficiariesStats=[],this.totalItems=0,m.error(o.data.message||"Failed to fetch data",{position:"top-right",autoClose:3e3})),this.loading=!1}catch(o){console.error("API Error:",o),console.error("Error Response:",o.response?.data),this.beneficiariesStats=[],this.totalItems=0,this.loading=!1;const t=o.response?.data?.message||"Failed to fetch beneficiaries statistics";m.error(t,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async fetchBeneficiariesStat(r){this.loading=!0;try{const e=await S.get(`beneficiaries-stats/${r}`);this.currentStat=e.data.data,this.loading=!1}catch(e){console.error(e),this.loading=!1,m.error("Failed to fetch beneficiaries stat",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async createBeneficiariesStat(r){try{const e=await S.post("beneficiaries-stats",r);this.createDialog=!1,m.success("Beneficiaries stat created successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchBeneficiariesStats({page:1,itemsPerPage:this.itemsPerPage})}catch(e){console.error(e);const o=e.response?.data?.message||"Failed to create beneficiaries stat. Please try again.";m.error(o,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async updateBeneficiariesStat(r,e){try{const o=await S.put(`beneficiaries-stats/${r}`,e);this.createDialog=!1,this.isEditMode=!1,m.success("Beneficiaries stat updated successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchBeneficiariesStats({page:1,itemsPerPage:this.itemsPerPage})}catch(o){console.error(o);const t=o.response?.data?.message||"Failed to update beneficiaries stat. Please try again.";m.error(t,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async deleteBeneficiariesStat(r){try{await S.delete(`beneficiaries-stats/${r}`),m.success("Beneficiaries stat deleted successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchBeneficiariesStats({page:1,itemsPerPage:this.itemsPerPage})}catch(e){console.error(e);const o=e.response?.data?.message||"Failed to delete beneficiaries stat. Please try again.";m.error(o,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async bulkDeleteBeneficiariesStats(r){try{const e=r.map(o=>S.delete(`beneficiaries-stats/${o}`));await Promise.all(e),m.success(`${r.length} beneficiaries stats deleted successfully!`,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchBeneficiariesStats({page:1,itemsPerPage:this.itemsPerPage})}catch(e){console.error(e),m.error("Failed to delete selected beneficiaries stats. Please try again.",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async getStatsSummary(){try{return(await S.get("beneficiaries-stats-summary")).data.data}catch(r){return console.error(r),[]}},getStatTypeLabel(r,e){const o=e||(y=>y),t=this.statTypesBase.find(y=>y.value===r);return t?o(t.labelKey):r},formatNumber(r){return new Intl.NumberFormat().format(r)},resetCurrentStat(){this.currentStat={id:null,stat_type:"",value:0,description:"",year:new Date().getFullYear()}}}});const le={dir:"rtl"},ne={class:"font-weight-bold pl-4"},ce={class:"flex w-100"},de={class:"flex w-100"},ue={class:"w-50 pl-2"},pe={class:"d-flex flex-row-reverse mb-6 mx-6"},fe={__name:"CreateBeneficiariesStats",setup(r){const{t:e,locale:o}=z(),t=L(),y=w(()=>t.statTypesBase.map(s=>({value:s.value,label:e(s.labelKey)}))),$=w(()=>t.isEditMode?e("update"):e("create")),M=w(()=>t.isEditMode?e("update"):e("submit")),V=g(null),n=N({id:null,stat_type:"",value:0,description:"",year:new Date().getFullYear()});te(()=>t.currentStat,s=>{s&&Object.keys(s).length>0&&(n.id=s.id,n.stat_type=s.stat_type||"",n.value=s.value||0,n.description=s.description||"",n.year=s.year||new Date().getFullYear())},{deep:!0,immediate:!0});const P={required:s=>!!s||e("field_required"),positiveNumber:s=>s!=null&&s>=0||e("positive_number"),year:s=>{if(!s)return!0;const c=parseInt(s);return c>=2e3&&c<=2100||e("year_range")},maxLength:s=>!s||s.length<=500||e("max_length_500")},F=async()=>{await V.value.validate()&&(t.isEditMode?await t.updateBeneficiariesStat(n.id,n):await t.createBeneficiariesStat(n))};return(s,c)=>{const E=l("v-icon"),O=l("v-btn"),d=l("v-card-title"),u=l("v-divider"),H=l("v-select"),C=l("v-text-field"),B=l("v-form"),D=l("v-card-text"),K=l("v-card"),I=l("v-dialog");return T(),q("div",le,[a(I,{transition:"dialog-top-transition",width:"50rem",modelValue:f(t).createDialog,"onUpdate:modelValue":c[4]||(c[4]=x=>f(t).createDialog=x),class:"rtl-dialog"},{default:i(({isActive:x})=>[a(K,{class:"px-3"},{default:i(()=>[a(d,{class:"px-2 pt-4 d-flex justify-space-between"},{default:i(()=>[_("h2",ne,h($.value),1),a(O,{variant:"text",onClick:v=>x.value=!1},{default:i(()=>[a(E,null,{default:i(()=>[...c[5]||(c[5]=[b("mdi-close",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1024),a(u,{class:"border-opacity-100 mx-6"}),a(D,null,{default:i(()=>[a(B,{ref_key:"formRef",ref:V,class:"pt-4"},{default:i(()=>[_("div",ce,[a(H,{modelValue:n.stat_type,"onUpdate:modelValue":c[0]||(c[0]=v=>n.stat_type=v),items:y.value,variant:"outlined",density:"compact","item-value":"value","item-title":"label","return-object":!1,label:s.$t("stat_type"),class:"pb-4 pr-2 w-50",rules:[P.required]},null,8,["modelValue","items","label","rules"]),a(C,{modelValue:n.value,"onUpdate:modelValue":c[1]||(c[1]=v=>n.value=v),modelModifiers:{number:!0},variant:"outlined",label:s.$t("value"),density:"compact",type:"number",min:"0",class:"pb-4 pl-2 w-50",rules:[P.required,P.positiveNumber]},null,8,["modelValue","label","rules"])]),_("div",de,[a(C,{modelValue:n.year,"onUpdate:modelValue":c[2]||(c[2]=v=>n.year=v),modelModifiers:{number:!0},variant:"outlined",label:s.$t("year"),density:"compact",type:"number",min:2e3,max:2100,class:"pb-4 pr-2 w-50",rules:[P.year]},null,8,["modelValue","label","rules"]),_("div",ue,[a(C,{modelValue:n.description,"onUpdate:modelValue":c[3]||(c[3]=v=>n.description=v),variant:"outlined",label:s.$t("description"),density:"compact",class:"pb-4",counter:500,rules:[P.maxLength]},null,8,["modelValue","label","rules"])])])]),_:1},512)]),_:1}),_("div",pe,[a(O,{class:"create-btn-gradient px-4",onClick:F},{default:i(()=>[b(h(M.value),1)]),_:1})])]),_:2},1024)]),_:1},8,["modelValue"])])}}},me=j(fe,[["__scopeId","data-v-09291236"]]),ge=["dir"],_e={class:"btn-search pt-12 pb-6"},ve={class:"text-field w-25"},be={class:"flex"},ye={class:"table-section"},he={__name:"BeneficiariesStats",setup(r){const{t:e,locale:o}=z();oe();const t=L(),y=w(()=>["fa","ps"].includes(o.value)?"rtl":"ltr");let $;const M=()=>{clearTimeout($),$=setTimeout(()=>{t.fetchBeneficiariesStats({page:1,itemsPerPage:t.itemsPerPage})},500)},V=d=>{t.fetchBeneficiariesStats({page:d.page,itemsPerPage:d.itemsPerPage})},n=g([]),P=()=>{n.value.length>0&&(t.bulkDeleteBeneficiariesStats(n.value),n.value=[])},F=()=>{t.resetCurrentStat(),t.isEditMode=!1,t.createDialog=!0},s=d=>{t.isEditMode=!0,t.currentStat={...d},t.createDialog=!0},c=async d=>{await t.deleteBeneficiariesStat(d.id)},E=w(()=>[{title:"",key:"checkbox",align:"start",sortable:!1,width:"50px"},{title:e("stat_type"),key:"stat_type",align:"start",sortable:!0,width:"180px"},{title:e("value"),key:"value",align:"end",sortable:!0,width:"150px"},{title:e("description"),key:"description",align:"start",sortable:!1,width:"400px"},{title:e("year"),key:"year",align:"start",sortable:!0,width:"120px"},{title:e("action"),key:"action",align:"center",sortable:!1,width:"100px"}]),O=d=>({farmers:"green",women:"pink",youth:"blue",total:"primary"})[d]||"grey";return(d,u)=>{const H=l("v-divider"),C=l("v-text-field"),B=l("v-btn"),D=l("v-chip"),K=l("v-checkbox"),I=l("v-icon"),x=l("v-list-item-title"),v=l("v-list-item"),Y=l("v-list"),A=l("v-menu"),G=l("v-data-table-server"),J=l("v-col"),Q=l("v-row"),W=l("v-main"),X=l("v-app");return T(),q(re,null,[f(t).createDialog?(T(),R(me,{key:0})):U("",!0),_("div",{dir:y.value},[a(ie,{pageTitle:d.$t("beneficiaries_stats_management")},null,8,["pageTitle"]),a(H,{thickness:1,class:"border-opacity-100"}),_("div",_e,[_("div",ve,[a(C,{color:"primary",density:"compact",variant:"outlined",label:d.$t("search"),"append-inner-icon":"mdi-magnify","hide-details":"",modelValue:f(t).beneficiariesStatsSearch,"onUpdate:modelValue":u[0]||(u[0]=p=>f(t).beneficiariesStatsSearch=p),onInput:M},null,8,["label","modelValue"])]),_("div",be,[a(B,{class:"action-btn-success"},{default:i(()=>[b(h(f(e)("filter")),1)]),_:1}),u[3]||(u[3]=b(" Â  ",-1)),a(B,{onClick:F,class:"create-btn-gradient",text:d.$t("create")},null,8,["text"])])]),_("div",ye,[a(X,null,{default:i(()=>[a(W,{class:"main"},{default:i(()=>[a(Q,null,{default:i(()=>[a(J,null,{default:i(()=>[a(G,{dir:y.value,theme:"cursor-pointer","items-per-page":f(t).itemsPerPage,"onUpdate:itemsPerPage":u[2]||(u[2]=p=>f(t).itemsPerPage=p),headers:E.value,"items-length":f(t).totalItems,items:f(t).beneficiariesStats,loading:f(t).loading,"onUpdate:options":V,hover:"",class:"w-100 mx-auto"},{"item.stat_type":i(({item:p})=>[a(D,{color:O(p.stat_type),variant:"flat",size:"small"},{default:i(()=>[b(h(f(t).getStatTypeLabel(p.stat_type,f(e))),1)]),_:2},1032,["color"])]),"item.value":i(({item:p})=>[_("span",{class:se(["font-weight-bold text-h6 value-cell",y.value==="rtl"?"text-left":"text-right"])},h(f(t).formatNumber(p.value)),3)]),"item.year":i(({item:p})=>[a(D,{color:"primary",variant:"outlined",size:"small"},{default:i(()=>[b(h(p.year),1)]),_:2},1024)]),"item.checkbox":i(({item:p})=>[a(K,{value:p.id,modelValue:n.value,"onUpdate:modelValue":u[1]||(u[1]=k=>n.value=k),class:"w-6 d-flex"},null,8,["value","modelValue"])]),"item.action":i(({item:p})=>[a(A,null,{activator:i(({props:k})=>[a(B,ae({icon:"mdi-dots-vertical"},k,{variant:"text"}),null,16)]),default:i(()=>[a(Y,null,{default:i(()=>[a(v,null,{default:i(()=>[a(x,{onClick:k=>s(p),class:"cursor-pointer d-flex gap-3 justify-left pb-3"},{default:i(()=>[a(I,{color:"primary"},{default:i(()=>[...u[4]||(u[4]=[b("mdi-square-edit-outline",-1)])]),_:1}),b(" "+h(d.$t("edit")),1)]),_:1},8,["onClick"]),a(x,{class:"cursor-pointer d-flex gap-3",onClick:k=>c(p)},{default:i(()=>[a(I,{color:"error"},{default:i(()=>[...u[5]||(u[5]=[b("mdi-delete-outline",-1)])]),_:1}),b(" "+h(d.$t("delete")),1)]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["dir","items-per-page","headers","items-length","items","loading"]),n.value.length>0?(T(),R(B,{key:0,class:"header-button",onClick:P,color:"#B71C1C",flat:"",inset:"",text:`Delete ${n.value.length} selected`},null,8,["text"])):U("",!0)]),_:1})]),_:1})]),_:1})]),_:1})])],8,ge)],64)}}},ke=j(he,[["__scopeId","data-v-81f40ed5"]]);export{ke as default};
