import{N as it,c as S,q as J,r as C,o as dt,y as B,h as p,b as L,j as _,g as u,w as f,d as V,t as O,l as N,F as ut,e as ct,u as T,z as D,an as z,k as R,a7 as ft,f as mt,A as pt}from"./_plugin-vue_export-helper-BPPfTR4S.js";import{u as H}from"./admin-BgzI1_lQ.js";function yt(a=[]){const{t:y}=H(),e=it({farsi:{},pashto:{}}),i=()=>{a.forEach(t=>{t==="target_crops"||t==="partner_organizations"||t==="features"?(e.farsi[t]=[],e.pashto[t]=[]):(e.farsi[t]="",e.pashto[t]="")})},F=(t={})=>{console.log("=== LOAD TRANSLATIONS DEBUG ==="),console.log("API Data received:",t),console.log("Farsi translations:",t.farsi_translations),console.log("Pashto translations:",t.pashto_translations),console.log("Translatable fields:",a);const r=n=>n?Object.values(n).every(m=>typeof m=="string"?!m||m==="":Array.isArray(m)?m.length===0:!m):!0;r(e.farsi)&&r(e.pashto)&&i();const s=(n,m)=>{if((m==="target_crops"||m==="partner_organizations"||m==="features")&&typeof n=="string")try{const b=JSON.parse(n);if(Array.isArray(b))return b}catch(b){console.warn(`Failed to parse JSON for field ${m}:`,b)}return n||""};t.farsi_translations?(console.log("Loading Farsi translations..."),Object.keys(t.farsi_translations).forEach(n=>{e.farsi[n]!==void 0&&(e.farsi[n]=s(t.farsi_translations[n],n),console.log(`Set farsi.${n}:`,t.farsi_translations[n]))})):console.log("No Farsi translations found in API data"),t.pashto_translations?(console.log("Loading Pashto translations..."),Object.keys(t.pashto_translations).forEach(n=>{e.pashto[n]!==void 0&&(e.pashto[n]=s(t.pashto_translations[n],n),console.log(`Set pashto.${n}:`,t.pashto_translations[n]))})):console.log("No Pashto translations found in API data"),console.log("Final translations state:",e),console.log("================================")},E=(t,r)=>{e[t]&&e[t][r]!==void 0&&(e[t][r]="")},A=t=>{e[t]&&Object.keys(e[t]).forEach(r=>{e[t][r]=""})},g=t=>{if(!e[t])return 0;const r=a.length,s=Object.values(e[t]).filter(n=>typeof n=="string"?n&&n.trim()!=="":Array.isArray(n)?n.length>0:!!n).length;return r>0?Math.round(s/r*100):0},c=S(()=>({farsi:g("farsi"),pashto:g("pashto")})),x=(t,r)=>{if(!e[t]||!e[t][r])return!1;const s=e[t][r];return typeof s=="string"?s.trim()!=="":Array.isArray(s)?s.length>0:!!s},v=t=>t===100?"success":t>=50?"warning":"error",k=()=>{const t={farsi:{},pashto:{}},r=s=>typeof s=="string"?s.trim()!=="":Array.isArray(s)?s.length>0:!!s;return Object.keys(e.farsi).forEach(s=>{r(e.farsi[s])&&(Array.isArray(e.farsi[s])?t.farsi[s]=JSON.stringify(e.farsi[s]):t.farsi[s]=e.farsi[s])}),Object.keys(e.pashto).forEach(s=>{r(e.pashto[s])&&(Array.isArray(e.pashto[s])?t.pashto[s]=JSON.stringify(e.pashto[s]):t.pashto[s]=e.pashto[s])}),t},j={farsi:y("dari"),pashto:y("pashto")},w=S(()=>[{key:"base",title:y("english"),icon:"mdi-translate"},{key:"farsi",title:y("dari"),icon:"mdi-flag",coverage:c.value.farsi},{key:"pashto",title:y("pashto"),icon:"mdi-flag",coverage:c.value.pashto}]);return{translations:e,initializeTranslations:i,loadTranslations:F,clearTranslation:E,clearLanguageTranslations:A,getTranslationCoverage:g,getTranslationCoverages:c,hasTranslation:x,getCoverageBadgeColor:v,prepareTranslationsForApi:k,languageLabels:j,translationTabs:w}}const gt=["dir"],ht={class:"font-weight-bold pl-4"},vt={class:"translation-tab"},bt={class:"translation-tab"},Tt={class:"d-flex flex-row-reverse mb-6 mx-6"},St={__name:"TranslatableForm",props:{modelValue:{type:Boolean,default:!1},formTitle:{type:String,required:!0},buttonText:{type:String,default:"Save"},buttonClass:{type:String,default:"action-btn action-btn-success px-4"},width:{type:String,default:"60rem"},transition:{type:String,default:"dialog-top-transition"},dialogClass:{type:String,default:"rtl-dialog"},translatableFields:{type:Array,required:!0},formData:{type:Object,required:!0},rules:{type:Object,default:()=>({})},saving:{type:Boolean,default:!1},dir:{type:String,default:null},isEditMode:{type:Boolean,default:!1}},emits:["update:modelValue","save","load-translations"],setup(a,{expose:y,emit:e}){const i=a,F=e,{t:E,locale:A}=H(),g=S(()=>i.dir!==null?i.dir:["fa","ps"].includes(A.value)?"rtl":"ltr"),{translations:c,initializeTranslations:x,loadTranslations:v,clearTranslation:k,clearLanguageTranslations:j,hasTranslation:w,prepareTranslationsForApi:t,translationTabs:r}=yt(i.translatableFields),s=C(null),n=C("base"),m=C(!1),b=C(!1),M=C(!1),$=S({get:()=>i.modelValue,set:o=>F("update:modelValue",o)}),G=()=>{const o=["title"];m.value=o.every(l=>i.formData[l]&&i.formData[l].toString().trim()!=="")},W=()=>{const o=Object.values(c.farsi).some(l=>l&&l.toString().trim()!=="");b.value=o},K=()=>{const o=Object.values(c.pashto).some(l=>l&&l.toString().trim()!=="");M.value=o},q=()=>{g.value==="rtl"&&ft(()=>{setTimeout(()=>{((s.value?.$el||document).querySelectorAll?.('.v-field__input, .v-text-field input, .v-textarea textarea, input[type="text"], input[type="number"], textarea')||[]).forEach(h=>{h&&h.tagName&&(h.style.setProperty("text-align","right","important"),h.style.setProperty("direction","rtl","important"))})},150)})};dt(()=>{!i.isEditMode&&!i.formData?.translationData&&x(),q()}),B(()=>i.formData,(o,l)=>{if(console.log("=== TRANSLATABLE FORM WATCHER ==="),console.log("Form data changed:",o),console.log("Has translations:",!!o?.translations),console.log("Has translationData:",!!o?.translationData),console.log("TranslationData content:",o?.translationData),o?.translationData&&l?.translationData&&o.translationData.id===l.translationData.id){console.log("Skipping reload - same translation data");return}o&&o.translations?(console.log("Loading from old translations format"),v(o.translations)):o&&o.translationData&&(console.log("Loading from new JSON translation format"),console.log("Translation data:",o.translationData),v(o.translationData)),G()},{deep:!0,immediate:!0}),B(()=>c.farsi,()=>{W()},{deep:!0}),B(()=>c.pashto,()=>{K()},{deep:!0}),B(()=>g.value,()=>{q()},{immediate:!0}),B(()=>$.value,o=>{o&&q()});const Q=()=>X()&&i.isEditMode?"Update All Content":"Save All Content",X=()=>m.value&&(b.value||M.value),Y=async()=>{const{valid:o}=await s.value.validate();if(!o)return;const l={...i.formData,translations:t()};F("save",{data:l,type:"complete"})};return y({formRef:s,clearTranslation:k,clearLanguageTranslations:j,loadTranslations:v}),(o,l)=>{const h=p("v-icon"),U=p("v-btn"),Z=p("v-card-title"),tt=p("v-divider"),et=p("v-tab"),at=p("v-tabs"),P=p("v-window-item"),st=p("v-window"),nt=p("v-form"),ot=p("v-card-text"),lt=p("v-card"),rt=p("v-dialog");return _(),L("div",{dir:g.value},[u(rt,{transition:a.transition,width:a.width,modelValue:$.value,"onUpdate:modelValue":l[2]||(l[2]=I=>$.value=I),class:R(a.dialogClass)},{default:f(({isActive:I})=>[u(lt,{class:"px-3"},{default:f(()=>[u(Z,{class:"px-2 pt-4 d-flex justify-space-between"},{default:f(()=>[V("h2",ht,O(a.formTitle),1),u(U,{variant:"text",onClick:d=>I.value=!1},{default:f(()=>[u(h,null,{default:f(()=>[...l[3]||(l[3]=[N("mdi-close",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1024),u(tt,{class:"border-opacity-100 mx-6"}),u(ot,null,{default:f(()=>[u(nt,{ref_key:"formRef",ref:s,class:"pt-4"},{default:f(()=>[u(at,{modelValue:n.value,"onUpdate:modelValue":l[0]||(l[0]=d=>n.value=d),color:"primary",class:"mb-4","align-tabs":"start"},{default:f(()=>[(_(!0),L(ut,null,ct(T(r),d=>(_(),D(et,{key:d.key,value:d.key,class:"text-capitalize"},{default:f(()=>[u(h,{icon:d.icon,class:"me-2"},null,8,["icon"]),N(" "+O(d.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),u(st,{modelValue:n.value,"onUpdate:modelValue":l[1]||(l[1]=d=>n.value=d)},{default:f(()=>[u(P,{value:"base"},{default:f(()=>[z(o.$slots,"base-fields",{formData:a.formData,rules:a.rules},void 0,!0)]),_:3}),u(P,{value:"farsi"},{default:f(()=>[V("div",vt,[z(o.$slots,"farsi-fields",{translations:T(c).farsi,clearTranslation:d=>T(k)("farsi",d),hasTranslation:d=>T(w)("farsi",d)},void 0,!0)])]),_:3}),u(P,{value:"pashto"},{default:f(()=>[V("div",bt,[z(o.$slots,"pashto-fields",{translations:T(c).pashto,clearTranslation:d=>T(k)("pashto",d),hasTranslation:d=>T(w)("pashto",d)},void 0,!0)])]),_:3})]),_:3},8,["modelValue"])]),_:3},512)]),_:3}),V("div",Tt,[u(U,{class:R(a.buttonClass),loading:a.saving,disabled:a.saving,onClick:Y},{default:f(()=>[u(h,null,{default:f(()=>[...l[4]||(l[4]=[N("mdi-content-save",-1)])]),_:1}),N(" "+O(Q()),1)]),_:1},8,["class","loading","disabled"])])]),_:2},1024)]),_:3},8,["transition","width","modelValue","class"])],8,gt)}}},Bt=J(St,[["__scopeId","data-v-9bc9d9d0"]]),At={class:"translation-field mb-4"},xt={class:"d-flex justify-space-between align-center mb-2"},Vt={class:"text-subtitle-2 font-weight-medium"},_t={key:0,class:"text-caption text-grey mt-1"},Ft={__name:"TranslationField",props:{fieldName:{type:String,required:!0},fieldLabel:{type:String,required:!0},language:{type:String,required:!0},languageLabel:{type:String,required:!0},modelValue:{type:[String,Number,Array],default:""},fieldType:{type:String,default:"text",validator:a=>["text","textarea","select","multiselect","date","number"].includes(a)},variant:{type:String,default:"outlined"},density:{type:String,default:"compact"},placeholder:{type:String,default:""},rules:{type:Array,default:()=>[]},rows:{type:[String,Number],default:3},type:{type:String,default:"text"},items:{type:Array,default:()=>[]},itemTitle:{type:String,default:"title"},itemValue:{type:String,default:"value"},multiple:{type:Boolean,default:!1},chips:{type:Boolean,default:!1},closableChips:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},hint:{type:String,default:""},persistentHint:{type:Boolean,default:!1},fieldClass:{type:String,default:""}},emits:["update:modelValue","clear"],setup(a,{emit:y}){const e=a,i=y,{t:F}=H(),E=S(()=>{switch(e.fieldType){case"textarea":return"v-textarea";case"select":case"multiselect":return"v-select";case"date":return"v-text-field";case"number":return"v-text-field";default:return"v-text-field"}}),A=S({get:()=>e.modelValue,set:c=>i("update:modelValue",c)});S(()=>Array.isArray(e.modelValue)?e.modelValue.length>0:e.modelValue&&e.modelValue.toString().trim()!=="");const g=c=>{i("update:modelValue",c)};return(c,x)=>(_(),L("div",At,[V("div",xt,[V("label",Vt,O(a.fieldLabel),1)]),(_(),D(pt(E.value),{modelValue:A.value,"onUpdate:modelValue":[x[0]||(x[0]=v=>A.value=v),g],variant:a.variant,density:a.density,label:a.placeholder,rules:a.rules,rows:a.rows,type:a.type,items:a.items,"item-title":a.itemTitle,"item-value":a.itemValue,multiple:a.multiple,chips:a.chips,"closable-chips":a.closableChips,disabled:a.disabled,readonly:a.readonly,hint:a.hint,"persistent-hint":a.persistentHint,class:R(a.fieldClass)},null,8,["modelValue","variant","density","label","rules","rows","type","items","item-title","item-value","multiple","chips","closable-chips","disabled","readonly","hint","persistent-hint","class"])),a.hint&&!a.persistentHint?(_(),L("div",_t,O(a.hint),1)):mt("",!0)]))}},Ot=J(Ft,[["__scopeId","data-v-ae2bb894"]]);export{Ot as T,Bt as a};
