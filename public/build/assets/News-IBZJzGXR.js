import{al as oe,i as U,N as W,r as y,G as re,q as Y,c as D,y as A,h as p,z as q,j as x,w as u,g as l,d as h,b as L,f as N,t as k,B as ne,D as ie,l as $,u as w,o as ue,s as de,a0 as ce,F as ge}from"./_plugin-vue_export-helper-P2oMpLHC.js";import{H as pe}from"./Header-CiPE5FKx.js";import{l as S,u as Q,a as me}from"./admin-LHx5b8IY.js";import{T as F,a as fe}from"./TranslationField-CGTZUZqR.js";/* empty css                                                               *//* empty css              */let X=oe("NewsRepository",{state(){return{isEditMode:y(!1),router:re(),search:y(""),loadingTable:y(!0),loading:y(!0),totalItems:y(0),selectedItems:y([]),itemsPerPage:y(5),createDialog:y(!1),news:W([]),newsSearch:y(""),currentNews:W({}),statusOptionsBase:[{value:"draft",labelKey:"status.draft"},{value:"published",labelKey:"status.published"},{value:"archived",labelKey:"status.archived"}]}},actions:{setEditMode(i){this.isEditMode=i},getTodaysDate(){const i=new Date,t=i.getFullYear(),s=String(i.getMonth()+1).padStart(2,"0"),a=String(i.getDate()).padStart(2,"0");return`${t}-${s}-${a}`},async fetchNews({page:i=1,itemsPerPage:t=5,status:s=""}){this.loading=!0;try{const a=new URLSearchParams({page:i,perPage:t,search:this.newsSearch});s&&a.append("status",s);const _=await U.get(`news?${a}`);console.log("API Response:",_.data),_.data.success?(this.news=_.data.data||[],this.totalItems=_.data.meta?.total||0):(this.news=[],this.totalItems=0,S.error(_.data.message||"Failed to fetch data",{position:"top-right",autoClose:3e3})),this.loading=!1}catch(a){console.error("API Error:",a),console.error("Error Response:",a.response?.data),this.news=[],this.totalItems=0,this.loading=!1;const _=a.response?.data?.message||"Failed to fetch news articles";S.error(_,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async fetchNewsItem(i){this.loading=!0;try{const t=await U.get(`news/${i}`,{params:{include_translations:1}});this.currentNews=t.data.data,this.loading=!1}catch(t){console.error(t),this.loading=!1,S.error("Failed to fetch news article",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async createNews(i){try{const t=await U.post("news",i);this.createDialog=!1,S.success("News article created successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchNews({page:1,itemsPerPage:this.itemsPerPage})}catch(t){console.error(t);const s=t.response?.data?.message||"Failed to create news article. Please try again.";S.error(s,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async updateNews(i,t){try{const s=await U.post(`news/${i}`,t);this.createDialog=!1,this.isEditMode=!1,S.success("News article updated successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchNews({page:1,itemsPerPage:this.itemsPerPage})}catch(s){console.error(s);const a=s.response?.data?.message||"Failed to update news article. Please try again.";S.error(a,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async deleteNews(i){try{await U.delete(`news/${i}`),S.success("News article deleted successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchNews({page:1,itemsPerPage:this.itemsPerPage})}catch(t){console.error(t);const s=t.response?.data?.message||"Failed to delete news article. Please try again.";S.error(s,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async bulkDeleteNews(i){try{const t=i.map(s=>U.delete(`news/${s}`));await Promise.all(t),S.success(`${i.length} news articles deleted successfully!`,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchNews({page:1,itemsPerPage:this.itemsPerPage})}catch(t){console.error(t),S.error("Failed to delete selected news articles. Please try again.",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async toggleStatus(i){try{const t=await U.post(`news/${i}/toggle-status`);S.success("News article status updated successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchNews({page:1,itemsPerPage:this.itemsPerPage})}catch(t){console.error(t);const s=t.response?.data?.message||"Failed to update news article status. Please try again.";S.error(s,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async getPublishedNews({page:i=1,itemsPerPage:t=10}){try{const s=new URLSearchParams({page:i,perPage:t,search:this.newsSearch});return(await U.get(`news/published?${s}`)).data}catch(s){return console.error(s),{success:!1,data:[],meta:{total:0}}}},getStatusLabel(i,t){const s=t||(_=>_),a=this.statusOptionsBase.find(_=>_.value===i);return a?s(a.labelKey):i},formatDate(i){return i?new Date(i).toLocaleDateString():""},resetCurrentNews(){this.currentNews={id:null,title:"",slug:"",excerpt:"",content:"",featured_image:"",status:"draft",published_at:null}}}});const he={class:"flex w-100"},ve={class:"flex w-100"},_e={class:"w-100 mb-4"},be={class:"image-upload-label mb-2 d-block"},ye={class:"photo-upload-container"},Pe=["src"],we={class:"photo-overlay"},Ce={key:0,class:"w-100"},Ve={class:"w-100"},Se={__name:"CreateNews",setup(i){const{t}=Q(),s=X(),a=D(()=>s.statusOptionsBase.map(e=>({value:e.value,label:t(e.labelKey)}))),_=D(()=>s.isEditMode?t("update"):t("create")),R=D(()=>s.isEditMode?t("update"):t("submit")),j=["title","excerpt","content"],o=W({id:null,title:"",slug:"",excerpt:"",content:"",featured_image:"",status:"draft",published_at:null}),P=y(null),m=y(null),E=y(null),I=D(()=>m.value||o.featured_image||null);A(P,e=>{if(e&&e instanceof File){if(!["image/png","image/jpeg","image/jpg","image/webp"].includes(e.type)){alert(t("please_select_image")||"Please select a valid image file (PNG, JPEG, JPG, or WebP)"),P.value=null,m.value=null;return}if(e.size>3*1024*1024){alert(t("image_too_large")||"Image size must be less than 3MB"),P.value=null,m.value=null;return}const f=new FileReader;f.onload=d=>{m.value=d.target.result},f.onerror=()=>{console.error("Error reading file"),m.value=null},f.readAsDataURL(e)}else e||o.featured_image||(m.value=null)}),A(()=>o.featured_image,e=>{e&&!m.value&&!P.value&&(m.value=e)},{immediate:!0});const T=y(!1),H=y(null);A(()=>s.currentNews,async e=>{if(e&&Object.keys(e).length>0){o.id=e.id,o.title=e.title||"",o.slug=e.slug||"",o.excerpt=e.excerpt||"",o.content=e.content||"",o.featured_image=e.featured_image||"",o.status=e.status||"draft",o.published_at=e.published_at?new Date(e.published_at).toISOString().slice(0,16):null,P.value=null,m.value=o.featured_image||null,H.value=o.featured_image||null;let r={},f={};e.farsi_translations&&(r=typeof e.farsi_translations=="string"?JSON.parse(e.farsi_translations):e.farsi_translations),e.pashto_translations&&(f=typeof e.pashto_translations=="string"?JSON.parse(e.pashto_translations):e.pashto_translations),e.translations&&Array.isArray(e.translations)&&e.translations.forEach(d=>{const O=d.field_name,M=d.content;d.language==="farsi"||d.language==="fa"?r[O]=M:(d.language==="pashto"||d.language==="ps")&&(f[O]=M)}),o.translationData={...e,farsi_translations:r,pashto_translations:f},console.log("=== FORM DATA UPDATED ==="),console.log("Form data:",o),console.log("Translation data:",o.translationData),console.log("Farsi translations:",o.translationData.farsi_translations),console.log("Pashto translations:",o.translationData.pashto_translations),console.log("Raw news translations array:",e.translations),console.log("========================")}},{deep:!0,immediate:!0}),A(()=>o.status,e=>{e==="published"&&!o.published_at&&(o.published_at=new Date().toISOString().slice(0,16))});const J={required:e=>!!e||t("field_required"),maxLength:e=>!e||e.length<=500||t("excerpt_max_length")},K=()=>{o.title&&!o.slug&&(o.slug=o.title.toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))},z=()=>{E.value?.click()},v=e=>{if(e&&e.target&&e.target.files&&e.target.files.length>0){const r=e.target.files[0];P.value=r}},C=()=>{P.value=null,m.value=null,o.featured_image="",E.value&&(E.value.value="")},G=async e=>{T.value=!0;try{if(e.type==="complete"){const r=new FormData;Object.keys(e.data).forEach(d=>{d!=="featured_image"&&(d==="translations"?r.append(d,JSON.stringify(e.data[d])):e.data[d]!==null&&e.data[d]!==void 0&&r.append(d,e.data[d]))}),console.log("Image state:",{imageFile:P.value,imageSrc:m.value,formDataFeaturedImage:o.featured_image,originalFeaturedImage:H.value,isEditMode:s.isEditMode}),P.value?(console.log("Sending new file:",P.value.name),r.append("featured_image",P.value)):s.isEditMode&&!m.value&&!P.value&&H.value?(console.log("Clearing existing image"),r.append("featured_image","")):o.featured_image&&!o.featured_image.startsWith("data:")&&!P.value?(console.log("Keeping existing image URL"),r.append("featured_image",o.featured_image)):s.isEditMode?console.log("Edit mode - keeping existing image (not sending featured_image field)"):(console.log("Create mode - no image"),r.append("featured_image","")),o.published_at?r.set("published_at",new Date(o.published_at).toISOString()):o.status==="published"&&r.set("published_at",new Date().toISOString());const f=e.data.translations||{};console.log("=== SAVING TRANSLATIONS ==="),console.log("Translations object:",f),console.log("Farsi translations:",f.farsi),console.log("Pashto translations:",f.pashto),console.log("Translations JSON string:",JSON.stringify(f)),console.log("==========================="),s.isEditMode?await s.updateNews(o.id,r):await s.createNews(r)}}catch(r){console.error("Error saving news:",r)}finally{T.value=!1}};return(e,r)=>{const f=p("v-text-field"),d=p("v-select"),O=p("v-icon"),M=p("v-textarea");return x(),q(fe,{modelValue:w(s).createDialog,"onUpdate:modelValue":r[0]||(r[0]=n=>w(s).createDialog=n),"form-title":_.value,"button-text":R.value,"translatable-fields":j,"form-data":o,rules:J,saving:T.value,"is-edit-mode":w(s).isEditMode,onSave:G},{"base-fields":u(({formData:n,rules:b})=>[h("div",he,[l(f,{modelValue:n.title,"onUpdate:modelValue":c=>n.title=c,variant:"outlined",label:e.$t("title"),density:"compact",class:"pb-4 pr-2 w-75",rules:[b.required],onInput:K},null,8,["modelValue","onUpdate:modelValue","label","rules"]),l(d,{modelValue:n.status,"onUpdate:modelValue":c=>n.status=c,items:a.value,variant:"outlined",density:"compact","item-value":"value","item-title":"label","return-object":!1,label:e.$t("status"),class:"pb-4 pl-2 w-25",rules:[b.required]},null,8,["modelValue","onUpdate:modelValue","items","label","rules"])]),h("div",ve,[l(f,{modelValue:n.slug,"onUpdate:modelValue":c=>n.slug=c,variant:"outlined",label:e.$t("slug"),density:"compact",class:"pb-4 pr-2 w-50","persistent-hint":""},null,8,["modelValue","onUpdate:modelValue","label"]),l(f,{modelValue:n.excerpt,"onUpdate:modelValue":c=>n.excerpt=c,variant:"outlined",label:e.$t("excerpt"),density:"compact",class:"pb-4 pl-2 w-50",counter:500,rules:[b.maxLength],"persistent-hint":""},null,8,["modelValue","onUpdate:modelValue","label","rules"])]),h("div",_e,[h("label",be,k(e.$t("featured_image")),1),h("div",ye,[h("input",{ref_key:"fileInputRef",ref:E,type:"file",accept:"image/png, image/jpeg, image/jpg, image/webp",style:{display:"none"},onChange:v},null,544),ne(h("img",{src:I.value,class:"photo-preview"},null,8,Pe),[[ie,I.value!==null]]),h("div",we,[I.value?N("",!0):(x(),L("button",{key:0,type:"button",onClick:z,class:"overlay-button"},[l(O,{size:"x-large",color:"blue-grey-lighten-2"},{default:u(()=>[...r[1]||(r[1]=[$("mdi-camera",-1)])]),_:1})])),I.value?(x(),L("button",{key:1,type:"button",onClick:C,class:"close-button"},[l(O,{size:"lg",color:"red"},{default:u(()=>[...r[2]||(r[2]=[$("mdi-close",-1)])]),_:1})])):N("",!0),I.value?(x(),L("button",{key:2,type:"button",onClick:z,class:"edit-button"},[l(O,{size:"small"},{default:u(()=>[...r[3]||(r[3]=[$("mdi-pencil",-1)])]),_:1})])):N("",!0)])])]),n.status==="published"?(x(),L("div",Ce,[l(f,{modelValue:n.published_at,"onUpdate:modelValue":c=>n.published_at=c,variant:"outlined",label:e.$t("published_date"),density:"compact",type:"datetime-local",class:"pb-4"},null,8,["modelValue","onUpdate:modelValue","label"])])):N("",!0),h("div",Ve,[l(M,{modelValue:n.content,"onUpdate:modelValue":c=>n.content=c,variant:"outlined",label:e.$t("content"),density:"compact",class:"pb-4",rules:[b.required],rows:"8","persistent-hint":""},null,8,["modelValue","onUpdate:modelValue","label","rules"])])]),"farsi-fields":u(({translations:n,clearTranslation:b,hasTranslation:c})=>[l(F,{modelValue:n.title,"onUpdate:modelValue":V=>n.title=V,"field-name":"title","field-label":e.$t("title"),language:"farsi","language-label":e.$t("dari"),"has-translation":c("title"),onClear:b},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"]),l(F,{modelValue:n.excerpt,"onUpdate:modelValue":V=>n.excerpt=V,"field-name":"excerpt","field-label":e.$t("excerpt"),language:"farsi","language-label":e.$t("dari"),"field-type":"textarea",rows:3,"has-translation":c("excerpt"),onClear:b},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"]),l(F,{modelValue:n.content,"onUpdate:modelValue":V=>n.content=V,"field-name":"content","field-label":e.$t("content"),language:"farsi","language-label":e.$t("dari"),"field-type":"textarea",rows:8,"has-translation":c("content"),onClear:b},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"])]),"pashto-fields":u(({translations:n,clearTranslation:b,hasTranslation:c})=>[l(F,{modelValue:n.title,"onUpdate:modelValue":V=>n.title=V,"field-name":"title","field-label":e.$t("title"),language:"pashto","language-label":e.$t("pashto"),"has-translation":c("title"),onClear:b},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"]),l(F,{modelValue:n.excerpt,"onUpdate:modelValue":V=>n.excerpt=V,"field-name":"excerpt","field-label":e.$t("excerpt"),language:"pashto","language-label":e.$t("pashto"),"field-type":"textarea",rows:3,"has-translation":c("excerpt"),onClear:b},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"]),l(F,{modelValue:n.content,"onUpdate:modelValue":V=>n.content=V,"field-name":"content","field-label":e.$t("content"),language:"pashto","language-label":e.$t("pashto"),"field-type":"textarea",rows:8,"has-translation":c("content"),onClear:b},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"])]),_:1},8,["modelValue","form-title","button-text","form-data","saving","is-edit-mode"])}}},$e=Y(Se,[["__scopeId","data-v-d4de0e47"]]),ke=["dir"],xe={class:"btn-search pt-12 pb-6"},Oe={class:"text-field w-25"},Ue={class:"flex"},Ie={class:"table-section"},Ne={class:"py-2 pl-4 d-flex align-center"},Ee={class:"font-weight-medium"},Me={class:"text-caption text-grey"},Be={class:"py-2 pl-4"},Fe={__name:"News",setup(i){const{t,locale:s}=Q();me();const a=X(),_=D(()=>["fa","ps"].includes(s.value)?"rtl":"ltr"),R=y("");let j;const o=()=>{clearTimeout(j),j=setTimeout(()=>{a.fetchNews({page:1,itemsPerPage:a.itemsPerPage,status:R.value})},500)},P=v=>{a.fetchNews({page:v.page,itemsPerPage:v.itemsPerPage,status:R.value})},m=y([]),E=()=>{m.value.length>0&&(a.bulkDeleteNews(m.value),m.value=[])},I=()=>{a.resetCurrentNews(),a.isEditMode=!1,a.createDialog=!0},T=async v=>{a.isEditMode=!0,await a.fetchNewsItem(v.id),a.createDialog=!0},H=async v=>{await a.deleteNews(v.id)},J=async v=>{await a.toggleStatus(v.id)},K=v=>{switch(v){case"published":return"success";case"draft":return"warning";case"archived":return"grey";default:return"primary"}},z=D(()=>[{title:"",key:"checkbox",align:"start",sortable:!1},{title:t("title"),key:"title",align:"start",sortable:!0},{title:t("status"),key:"status",align:"center",sortable:!0},{title:t("published_date"),key:"published_at",align:"center",sortable:!0},{title:t("action"),key:"action",align:"center",sortable:!1}]);return ue(()=>{a.fetchNews({page:1,itemsPerPage:a.itemsPerPage})}),A(()=>s.value,()=>{a.fetchNews({page:1,itemsPerPage:a.itemsPerPage,status:R.value})}),(v,C)=>{const G=p("v-divider"),e=p("v-text-field"),r=p("v-btn"),f=p("v-img"),d=p("v-avatar"),O=p("v-chip"),M=p("v-checkbox"),n=p("v-icon"),b=p("v-list-item-title"),c=p("v-list-item"),V=p("v-list"),Z=p("v-menu"),ee=p("v-data-table-server"),te=p("v-col"),ae=p("v-row"),se=p("v-main"),le=p("v-app");return x(),L(ge,null,[w(a).createDialog?(x(),q($e,{key:0})):N("",!0),h("div",{dir:_.value},[l(pe,{pageTitle:v.$t("news_management")},null,8,["pageTitle"]),l(G,{thickness:1,class:"border-opacity-100"}),h("div",xe,[h("div",Oe,[l(e,{color:"primary",density:"compact",variant:"outlined",label:v.$t("search"),"append-inner-icon":"mdi-magnify","hide-details":"",modelValue:w(a).newsSearch,"onUpdate:modelValue":C[0]||(C[0]=g=>w(a).newsSearch=g),onInput:o},null,8,["label","modelValue"])]),h("div",Ue,[l(r,{class:"action-btn-success"},{default:u(()=>[$(k(w(t)("filter")),1)]),_:1}),C[3]||(C[3]=$(" Â  ",-1)),l(r,{onClick:de(I,["stop"]),variant:"flat",class:"action-btn-success"},{default:u(()=>[$(k(w(t)("create")),1)]),_:1})])]),h("div",Ie,[l(le,null,{default:u(()=>[l(se,{class:"main"},{default:u(()=>[l(ae,null,{default:u(()=>[l(te,null,{default:u(()=>[l(ee,{dir:_.value,theme:"cursor-pointer","items-per-page":w(a).itemsPerPage,"onUpdate:itemsPerPage":C[2]||(C[2]=g=>w(a).itemsPerPage=g),headers:z.value,"items-length":w(a).totalItems,items:w(a).news,loading:w(a).loading,"onUpdate:options":P,hover:"",class:"w-100 mx-auto"},{"item.title":u(({item:g})=>[h("div",Ne,[g.featured_image?(x(),q(d,{key:0,size:"40",class:"mr-3"},{default:u(()=>[l(f,{src:g.featured_image,alt:g.title},null,8,["src","alt"])]),_:2},1024)):N("",!0),h("div",null,[h("div",Ee,k(g.title),1),h("div",Me,k(g.excerpt),1)])])]),"item.status":u(({item:g})=>[h("div",Be,[l(O,{color:K(g.status),size:"small",variant:"flat"},{default:u(()=>[$(k(w(a).getStatusLabel(g.status,w(t))),1)]),_:2},1032,["color"])])]),"item.checkbox":u(({item:g})=>[l(M,{value:g.id,modelValue:m.value,"onUpdate:modelValue":C[1]||(C[1]=B=>m.value=B),class:"w-6 d-flex"},null,8,["value","modelValue"])]),"item.action":u(({item:g})=>[l(Z,null,{activator:u(({props:B})=>[l(r,ce({icon:"mdi-dots-vertical"},B,{variant:"text"}),null,16)]),default:u(()=>[l(V,null,{default:u(()=>[l(c,null,{default:u(()=>[l(b,{onClick:B=>T(g),class:"cursor-pointer d-flex gap-3 justify-left pb-3"},{default:u(()=>[l(n,{color:"tealColor"},{default:u(()=>[...C[4]||(C[4]=[$("mdi-square-edit-outline",-1)])]),_:1}),$(" "+k(v.$t("edit")),1)]),_:1},8,["onClick"]),l(b,{onClick:B=>J(g),class:"cursor-pointer d-flex gap-3 pb-3"},{default:u(()=>[l(n,{color:g.status==="published"?"orange":"green"},{default:u(()=>[$(k(g.status==="published"?"mdi-eye-off":"mdi-eye"),1)]),_:2},1032,["color"]),$(" "+k(g.status==="published"?"Unpublish":"Publish"),1)]),_:2},1032,["onClick"]),l(b,{class:"cursor-pointer d-flex gap-3",onClick:B=>H(g)},{default:u(()=>[l(n,{color:"error"},{default:u(()=>[...C[5]||(C[5]=[$("mdi-delete-outline",-1)])]),_:1}),$(" "+k(v.$t("delete")),1)]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["dir","items-per-page","headers","items-length","items","loading"]),m.value.length>0?(x(),q(r,{key:0,class:"header-button",onClick:E,color:"#B71C1C",flat:"",inset:"",text:`Delete ${m.value.length} selected`},null,8,["text"])):N("",!0)]),_:1})]),_:1})]),_:1})]),_:1})])],8,ke)],64)}}},je=Y(Fe,[["__scopeId","data-v-8ab25739"]]);export{je as default};
