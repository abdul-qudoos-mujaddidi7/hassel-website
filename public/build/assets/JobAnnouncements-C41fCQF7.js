import{al as oe,i as C,N as A,r as $,G as le,q as Y,c as O,y as H,h as b,z as L,j as F,w as u,g as s,d as h,u as _,b as R,f as G,l as j,t as y,s as ne,a0 as re,F as ie}from"./_plugin-vue_export-helper-BPPfTR4S.js";import{H as de}from"./Header-BuSZ5oPR.js";import{l as m,u as K,a as ce}from"./admin-CEQmQzC7.js";import{T as E,a as ue}from"./TranslationField-C3vKw1zE.js";/* empty css                                                               *//* empty css              */let z=oe("JobAnnouncementRepository",{state(){return{isEditMode:$(!1),router:le(),search:$(""),loadingTable:$(!0),loading:$(!0),totalItems:$(0),selectedItems:$([]),itemsPerPage:$(5),createDialog:$(!1),jobs:A([]),jobSearch:$(""),currentJob:A({}),statusOptions:A([{value:"draft",label:"Draft"},{value:"open",label:"Open"},{value:"closed",label:"Closed"},{value:"archived",label:"Archived"}])}},actions:{setEditMode(d){this.isEditMode=d},getTodaysDate(){const d=new Date,t=d.getFullYear(),n=String(d.getMonth()+1).padStart(2,"0"),i=String(d.getDate()).padStart(2,"0");return`${t}-${n}-${i}`},async fetchJobs({page:d=1,itemsPerPage:t=5,status:n=""}){this.loading=!0;try{const i={page:d,perPage:t,search:this.jobSearch,status:n},q=await C.get("job-announcements",{params:i});q.data.success?(this.jobs=q.data.data,this.totalItems=q.data.meta.total):m.error("Failed to fetch job announcements")}catch(i){console.error("Error fetching job announcements:",i),m.error("Error fetching job announcements")}finally{this.loading=!1}},async createJob(d){try{const t=await C.post("job-announcements",d);if(t.data.success)return m.success("Job announcement created successfully"),this.createDialog=!1,this.resetCurrentJob(),this.fetchJobs({page:1,itemsPerPage:this.itemsPerPage}),t.data.data;m.error("Failed to create job announcement")}catch(t){console.error("Error creating job announcement:",t),t.response?.data?.message?m.error(t.response.data.message):m.error("Error creating job announcement")}},async updateJob(d,t){try{const n=await C.put(`job-announcements/${d}`,t);if(n.data.success)return m.success("Job announcement updated successfully"),this.createDialog=!1,this.resetCurrentJob(),this.fetchJobs({page:1,itemsPerPage:this.itemsPerPage}),n.data.data;m.error("Failed to update job announcement")}catch(n){console.error("Error updating job announcement:",n),n.response?.data?.message?m.error(n.response.data.message):m.error("Error updating job announcement")}},async deleteJob(d){try{(await C.delete(`job-announcements/${d}`)).data.success?(m.success("Job announcement deleted successfully"),this.fetchJobs({page:1,itemsPerPage:this.itemsPerPage})):m.error("Failed to delete job announcement")}catch(t){console.error("Error deleting job announcement:",t),t.response?.data?.message?m.error(t.response.data.message):m.error("Error deleting job announcement")}},async bulkDeleteJobs(d){try{(await C.post("job-announcements/bulk-delete",{ids:d})).data.success?(m.success(`${d.length} job announcements deleted successfully`),this.fetchJobs({page:1,itemsPerPage:this.itemsPerPage})):m.error("Failed to delete job announcements")}catch(t){console.error("Error bulk deleting job announcements:",t),t.response?.data?.message?m.error(t.response.data.message):m.error("Error deleting job announcements")}},async toggleStatus(d){try{(await C.patch(`job-announcements/${d}/toggle-status`)).data.success?(m.success("Job announcement status updated successfully"),this.fetchJobs({page:1,itemsPerPage:this.itemsPerPage})):m.error("Failed to update job announcement status")}catch(t){console.error("Error toggling job announcement status:",t),t.response?.data?.message?m.error(t.response.data.message):m.error("Error updating job announcement status")}},async getJob(d){this.loading=!0;try{const t=await C.get(`job-announcements/${d}`,{params:{include_translations:1}});if(t.data&&t.data.success)return this.currentJob=t.data.data,this.loading=!1,t.data.data;{this.loading=!1;const n=t.data?.message||"Failed to fetch job announcement";throw m.error(n),new Error(n)}}catch(t){console.error("Error fetching job announcement:",t),console.error("Error response:",t.response),this.loading=!1;const n=t.response?.data?.message||t.message||"Error fetching job announcement";throw m.error(n),t}},resetCurrentJob(){this.currentJob={title:"",slug:"",description:"",requirements:"",location:"",salary_range:"",deadline:this.getTodaysDate(),status:"draft",farsi_translations:{title:"",location:"",description:"",requirements:""},pashto_translations:{title:"",location:"",description:"",requirements:""}}},getStatusLabel(d){const t=this.statusOptions.find(n=>n.value===d);return t?t.label:d},getStatusColor(d){return{draft:"warning",open:"success",closed:"error",archived:"grey"}[d]||"primary"}}});z();const me={class:"flex w-100"},pe={class:"flex w-100"},ge={class:"flex w-100"},fe={class:"flex w-100"},be={class:"flex w-100"},he={__name:"CreateJobAnnouncement",setup(d){const{t}=K(),n=z(),i=O(()=>n.isEditMode?t("edit_job_announcement"):t("create_job_announcement")),q=O(()=>n.isEditMode?t("update"):t("create")),T=$(!1),M=["title","location","description","requirements"],o=A({id:null,title:"",slug:"",description:"",requirements:"",location:"",salary_range:"",deadline:"",status:"draft",farsi_translations:{},pashto_translations:{}}),c=A({title:"",location:"",description:"",requirements:""}),r=A({title:"",location:"",description:"",requirements:""});H(()=>n.currentJob,async(e,a)=>{if(a!==e)if(e&&Object.keys(e).length>0&&e.id){if(console.log("=== JOB ANNOUNCEMENT DATA LOADED ==="),console.log("Full job data:",e),console.log("Has ID:",e.id),console.log("Farsi translations:",e.farsi_translations),console.log("Pashto translations:",e.pashto_translations),console.log("===================================="),o.id=e.id||null,o.title=e.title||"",o.slug=e.slug||"",o.description=e.description||"",o.requirements=e.requirements||"",o.location=e.location||"",o.salary_range=e.salary_range||"",e.deadline){const v=new Date(e.deadline);isNaN(v.getTime())?o.deadline=e.deadline:o.deadline=v.toISOString().split("T")[0]}else o.deadline="";o.status=e.status||"draft";let f={},V={};if(e.farsi_translations)try{f=typeof e.farsi_translations=="string"?JSON.parse(e.farsi_translations):e.farsi_translations}catch(v){console.error("Error parsing farsi_translations:",v),f={}}if(e.pashto_translations)try{V=typeof e.pashto_translations=="string"?JSON.parse(e.pashto_translations):e.pashto_translations}catch(v){console.error("Error parsing pashto_translations:",v),V={}}o.farsi_translations=f,o.pashto_translations=V,o.translationData={...e,farsi_translations:f,pashto_translations:V},c.title=f.title||"",c.location=f.location||"",c.description=f.description||"",c.requirements=f.requirements||"",r.title=V.title||"",r.location=V.location||"",r.description=V.description||"",r.requirements=V.requirements||"",console.log("=== FORM DATA POPULATED ==="),console.log("Form data:",o),console.log("Translation data:",o.translationData),console.log("Farsi translations reactive:",c),console.log("Pashto translations reactive:",r),console.log("==========================="),await new Promise(v=>setTimeout(v,100))}else e&&Object.keys(e).length===0&&N()},{deep:!0,immediate:!0}),H(()=>n.createDialog,e=>{e||N()});const N=()=>{o.id=null,o.title="",o.slug="",o.description="",o.requirements="",o.location="",o.salary_range="",o.deadline="",o.status="draft",o.farsi_translations={},o.pashto_translations={},c.title="",c.location="",c.description="",c.requirements="",r.title="",r.location="",r.description="",r.requirements=""},x=()=>{o.title&&!o.slug&&(o.slug=o.title.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))},U=e=>c[e]&&c[e].trim()!=="",k=e=>r[e]&&r[e].trim()!=="",S=e=>{c[e]=""},w=e=>{r[e]=""},I=async e=>{T.value=!0;try{const a={farsi:{title:c.title||"",location:c.location||"",description:c.description||"",requirements:c.requirements||""},pashto:{title:r.title||"",location:r.location||"",description:r.description||"",requirements:r.requirements||""}},f={...o,translations:a};delete f.translationData,console.log("=== SAVING JOB ANNOUNCEMENT ==="),console.log("Data to send:",f),console.log("Translations:",a),console.log("Is Edit Mode:",n.isEditMode),console.log("=============================="),n.isEditMode?await n.updateJob(o.id,f):await n.createJob(f)}catch(a){console.error("Error saving job announcement:",a),console.error("Error response:",a.response?.data)}finally{T.value=!1}},J={required:e=>!!e||t("field_required")};return(e,a)=>{const f=b("v-text-field"),V=b("v-select"),v=b("v-textarea");return F(),L(ue,{modelValue:_(n).createDialog,"onUpdate:modelValue":a[8]||(a[8]=p=>_(n).createDialog=p),"form-title":i.value,"button-text":q.value,"translatable-fields":M,"form-data":o,rules:J,saving:T.value,"is-edit-mode":_(n).isEditMode,onSave:I},{"base-fields":u(({formData:p,rules:P})=>[h("div",me,[s(f,{modelValue:p.title,"onUpdate:modelValue":l=>p.title=l,variant:"outlined",label:e.$t("title"),density:"compact",class:"pb-4 pr-2 w-75",rules:[P.required],onInput:x},null,8,["modelValue","onUpdate:modelValue","label","rules"]),s(V,{modelValue:p.status,"onUpdate:modelValue":l=>p.status=l,items:_(n).statusOptions,variant:"outlined",density:"compact","item-value":"value","item-title":"label","return-object":!1,label:e.$t("status"),class:"pb-4 pl-2 w-25",rules:[P.required]},null,8,["modelValue","onUpdate:modelValue","items","label","rules"])]),h("div",pe,[s(f,{modelValue:p.slug,"onUpdate:modelValue":l=>p.slug=l,variant:"outlined",label:e.$t("slug"),density:"compact",class:"pb-4 pr-2 w-50",hint:e.$t("hint_url_friendly")},null,8,["modelValue","onUpdate:modelValue","label","hint"]),s(f,{modelValue:p.location,"onUpdate:modelValue":l=>p.location=l,variant:"outlined",label:e.$t("location"),density:"compact",class:"pb-4 pl-2 w-50",rules:[P.required]},null,8,["modelValue","onUpdate:modelValue","label","rules"])]),h("div",ge,[s(v,{modelValue:p.description,"onUpdate:modelValue":l=>p.description=l,variant:"outlined",label:e.$t("description"),density:"compact",class:"pb-4 w-100",rules:[P.required],rows:"4"},null,8,["modelValue","onUpdate:modelValue","label","rules"])]),h("div",fe,[s(v,{modelValue:p.requirements,"onUpdate:modelValue":l=>p.requirements=l,variant:"outlined",label:e.$t("requirements"),density:"compact",class:"pb-4 w-100",rows:"3"},null,8,["modelValue","onUpdate:modelValue","label"])]),h("div",be,[s(f,{modelValue:p.salary_range,"onUpdate:modelValue":l=>p.salary_range=l,variant:"outlined",label:e.$t("salary_range"),density:"compact",class:"pb-4 pr-2 w-50"},null,8,["modelValue","onUpdate:modelValue","label"]),s(f,{modelValue:p.deadline,"onUpdate:modelValue":l=>p.deadline=l,variant:"outlined",label:e.$t("application_deadline"),density:"compact",class:"pb-4 pl-2 w-50",type:"date",rules:[P.required]},null,8,["modelValue","onUpdate:modelValue","label","rules"])])]),"farsi-fields":u(({formData:p,rules:P})=>[s(E,{modelValue:c.title,"onUpdate:modelValue":a[0]||(a[0]=l=>c.title=l),"field-name":"title","field-label":e.$t("title"),language:"farsi","language-label":e.$t("farsi"),"has-translation":U("title"),onClear:S},null,8,["modelValue","field-label","language-label","has-translation"]),s(E,{modelValue:c.location,"onUpdate:modelValue":a[1]||(a[1]=l=>c.location=l),"field-name":"location","field-label":e.$t("location"),language:"farsi","language-label":e.$t("farsi"),"has-translation":U("location"),onClear:S},null,8,["modelValue","field-label","language-label","has-translation"]),s(E,{modelValue:c.description,"onUpdate:modelValue":a[2]||(a[2]=l=>c.description=l),"field-name":"description","field-label":e.$t("description"),language:"farsi","language-label":e.$t("farsi"),"field-type":"textarea",rows:4,"has-translation":U("description"),onClear:S},null,8,["modelValue","field-label","language-label","has-translation"]),s(E,{modelValue:c.requirements,"onUpdate:modelValue":a[3]||(a[3]=l=>c.requirements=l),"field-name":"requirements","field-label":e.$t("requirements"),language:"farsi","language-label":e.$t("farsi"),"field-type":"textarea",rows:3,"has-translation":U("requirements"),onClear:S},null,8,["modelValue","field-label","language-label","has-translation"])]),"pashto-fields":u(({formData:p,rules:P})=>[s(E,{modelValue:r.title,"onUpdate:modelValue":a[4]||(a[4]=l=>r.title=l),"field-name":"title","field-label":e.$t("title"),language:"pashto","language-label":e.$t("pashto"),"has-translation":k("title"),onClear:w},null,8,["modelValue","field-label","language-label","has-translation"]),s(E,{modelValue:r.location,"onUpdate:modelValue":a[5]||(a[5]=l=>r.location=l),"field-name":"location","field-label":e.$t("location"),language:"pashto","language-label":e.$t("pashto"),"has-translation":k("location"),onClear:w},null,8,["modelValue","field-label","language-label","has-translation"]),s(E,{modelValue:r.description,"onUpdate:modelValue":a[6]||(a[6]=l=>r.description=l),"field-name":"description","field-label":e.$t("description"),language:"pashto","language-label":e.$t("pashto"),"field-type":"textarea",rows:4,"has-translation":k("description"),onClear:w},null,8,["modelValue","field-label","language-label","has-translation"]),s(E,{modelValue:r.requirements,"onUpdate:modelValue":a[7]||(a[7]=l=>r.requirements=l),"field-name":"requirements","field-label":e.$t("requirements"),language:"pashto","language-label":e.$t("pashto"),"field-type":"textarea",rows:3,"has-translation":k("requirements"),onClear:w},null,8,["modelValue","field-label","language-label","has-translation"])]),_:1},8,["modelValue","form-title","button-text","form-data","saving","is-edit-mode"])}}},ve=Y(he,[["__scopeId","data-v-1798a880"]]),_e=["dir"],ye={class:"btn-search pt-12 pb-6"},Ve={class:"text-field w-25"},$e={class:"flex"},je={class:"table-section"},Pe={class:"py-2 pl-4 d-flex align-center"},qe={class:"font-weight-medium"},Ee={class:"text-caption text-grey"},Ce={class:"py-2 pl-4"},Te={class:"py-2 pl-4"},Ue={class:"text-caption"},ke={key:0,class:"text-caption text-success"},Se={key:1,class:"text-caption text-error"},we={__name:"JobAnnouncements",setup(d){const{t,locale:n}=K();ce();const i=z(),q=O(()=>["fa","ps"].includes(n.value)?"rtl":"ltr"),T=$("");let M;const o=()=>{clearTimeout(M),M=setTimeout(()=>{i.fetchJobs({page:1,itemsPerPage:i.itemsPerPage,status:T.value})},500)},c=e=>{i.fetchJobs({page:e.page,itemsPerPage:e.itemsPerPage,status:T.value})},r=$([]),N=()=>{r.value.length>0&&(i.bulkDeleteJobs(r.value),r.value=[])},x=()=>{i.resetCurrentJob(),i.isEditMode=!1,i.createDialog=!0},U=async e=>{try{i.isEditMode=!0,await i.getJob(e.id),i.createDialog=!0}catch(a){console.error("Error loading job announcement for edit:",a),i.isEditMode=!1}},k=async e=>{await i.deleteJob(e.id)},S=async e=>{await i.toggleStatus(e.id)},w=e=>{switch(e){case"open":return"success";case"draft":return"warning";case"closed":return"error";case"archived":return"grey";default:return"primary"}},I=e=>new Date(e).toLocaleDateString(),J=O(()=>[{title:"",key:"checkbox",align:"start",sortable:!1},{title:t("title"),key:"title",align:"start",sortable:!0},{title:t("status"),key:"status",align:"center",sortable:!0},{title:t("deadline"),key:"deadline",align:"center",sortable:!0},{title:t("created_date"),key:"created_at",align:"center",sortable:!0},{title:t("action"),key:"action",align:"center",sortable:!1}]);return(e,a)=>{const f=b("v-divider"),V=b("v-text-field"),v=b("v-btn"),p=b("v-chip"),P=b("v-checkbox"),l=b("v-icon"),B=b("v-list-item-title"),Q=b("v-list-item"),W=b("v-list"),X=b("v-menu"),Z=b("v-data-table-server"),ee=b("v-col"),te=b("v-row"),ae=b("v-main"),se=b("v-app");return F(),R(ie,null,[_(i).createDialog?(F(),L(ve,{key:0})):G("",!0),h("div",{dir:q.value},[s(de,{pageTitle:e.$t("job_announcements_management")},null,8,["pageTitle"]),s(f,{thickness:1,class:"border-opacity-100"}),h("div",ye,[h("div",Ve,[s(V,{color:"primary",density:"compact",variant:"outlined",label:e.$t("search"),"append-inner-icon":"mdi-magnify","hide-details":"",modelValue:_(i).jobSearch,"onUpdate:modelValue":a[0]||(a[0]=g=>_(i).jobSearch=g),onInput:o},null,8,["label","modelValue"])]),h("div",$e,[s(v,{class:"action-btn-success"},{default:u(()=>[j(y(_(t)("filter")),1)]),_:1}),a[3]||(a[3]=j(" Â  ",-1)),s(v,{onClick:ne(x,["stop"]),variant:"flat",class:"action-btn-success"},{default:u(()=>[j(y(_(t)("create")),1)]),_:1})])]),h("div",je,[s(se,null,{default:u(()=>[s(ae,{class:"main"},{default:u(()=>[s(te,null,{default:u(()=>[s(ee,null,{default:u(()=>[s(Z,{dir:q.value,theme:"cursor-pointer","items-per-page":_(i).itemsPerPage,"onUpdate:itemsPerPage":a[2]||(a[2]=g=>_(i).itemsPerPage=g),headers:J.value,"items-length":_(i).totalItems,items:_(i).jobs,loading:_(i).loading,"onUpdate:options":c,hover:"",class:"w-100 mx-auto"},{"item.title":u(({item:g})=>[h("div",Pe,[h("div",null,[h("div",qe,y(g.title),1),h("div",Ee,y(g.location),1)])])]),"item.status":u(({item:g})=>[h("div",Ce,[s(p,{color:w(g.status),size:"small",variant:"flat"},{default:u(()=>[j(y(_(i).getStatusLabel(g.status)),1)]),_:2},1032,["color"])])]),"item.deadline":u(({item:g})=>[h("div",Te,[h("div",Ue,y(I(g.deadline)),1),g.days_remaining>0?(F(),R("div",ke,y(g.days_remaining)+" "+y(e.$t("days_left")),1)):(F(),R("div",Se,y(e.$t("expired")),1))])]),"item.checkbox":u(({item:g})=>[s(P,{value:g.id,modelValue:r.value,"onUpdate:modelValue":a[1]||(a[1]=D=>r.value=D),class:"w-6 d-flex"},null,8,["value","modelValue"])]),"item.action":u(({item:g})=>[s(X,null,{activator:u(({props:D})=>[s(v,re({icon:"mdi-dots-vertical"},D,{variant:"text"}),null,16)]),default:u(()=>[s(W,null,{default:u(()=>[s(Q,null,{default:u(()=>[s(B,{onClick:D=>U(g),class:"cursor-pointer d-flex gap-3 justify-left pb-3"},{default:u(()=>[s(l,{color:"tealColor"},{default:u(()=>[...a[4]||(a[4]=[j("mdi-square-edit-outline",-1)])]),_:1}),j(" "+y(e.$t("edit")),1)]),_:1},8,["onClick"]),s(B,{onClick:D=>S(g),class:"cursor-pointer d-flex gap-3 pb-3"},{default:u(()=>[s(l,{color:g.status==="open"?"orange":"green"},{default:u(()=>[j(y(g.status==="open"?"mdi-eye-off":"mdi-eye"),1)]),_:2},1032,["color"]),j(" "+y(g.status==="open"?e.$t("close"):e.$t("open")),1)]),_:2},1032,["onClick"]),s(B,{class:"cursor-pointer d-flex gap-3",onClick:D=>k(g)},{default:u(()=>[s(l,{color:"error"},{default:u(()=>[...a[5]||(a[5]=[j("mdi-delete-outline",-1)])]),_:1}),j(" "+y(e.$t("delete")),1)]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["dir","items-per-page","headers","items-length","items","loading"]),r.value.length>0?(F(),L(v,{key:0,class:"header-button",onClick:N,color:"#B71C1C",flat:"",inset:"",text:_(t)("delete_selected",{count:r.value.length})},null,8,["text"])):G("",!0)]),_:1})]),_:1})]),_:1})]),_:1})])],8,_e)],64)}}},xe=Y(we,[["__scopeId","data-v-bde28de6"]]);export{xe as default};
