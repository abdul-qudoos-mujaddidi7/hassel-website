import{al as Z,i as S,N,r as g,G as ee,q as j,c as w,y as te,h as o,b as q,j as T,g as a,w as r,d as _,t as h,l as b,u as f,z as R,f as U,a0 as ae,k as se,F as re}from"./_plugin-vue_export-helper-P6s7mfAX.js";import{H as ie}from"./Header-Dc2gjrUc.js";import{l as m,u as z,a as oe}from"./admin-C1tUPR0Q.js";/* empty css                                                               *//* empty css              */let L=Z("BeneficiariesRepository",{state(){return{isEditMode:g(!1),router:ee(),search:g(""),loadingTable:g(!0),loading:g(!0),totalItems:g(0),selectedItems:g([]),itemsPerPage:g(5),createDialog:g(!1),beneficiariesStats:N([]),beneficiariesStatsSearch:g(""),currentStat:N({}),statTypesBase:[{value:"beneficiaries",labelKey:"stat_type.beneficiaries"},{value:"total_beneficiaries",labelKey:"stat_type.total_beneficiaries"},{value:"male_beneficiaries",labelKey:"stat_type.male_beneficiaries"},{value:"female_beneficiaries",labelKey:"stat_type.female_beneficiaries"},{value:"programs_completed",labelKey:"stat_type.programs_completed"},{value:"provinces_reached",labelKey:"stat_type.provinces_reached"},{value:"cooperatives_formed",labelKey:"stat_type.cooperatives_formed"},{value:"projects",labelKey:"stat_type.projects"},{value:"staff",labelKey:"stat_type.staff"},{value:"partners",labelKey:"stat_type.partners"}]}},actions:{setEditMode(i){this.isEditMode=i},getTodaysDate(){const i=new Date,t=i.getFullYear(),n=String(i.getMonth()+1).padStart(2,"0"),e=String(i.getDate()).padStart(2,"0");return`${t}-${n}-${e}`},async fetchBeneficiariesStats({page:i=1,itemsPerPage:t=5}){this.loading=!0;try{const n=await S.get(`beneficiaries-stats?page=${i}&perPage=${t}&search=${this.beneficiariesStatsSearch}`);n.data.success?(this.beneficiariesStats=n.data.data||[],this.totalItems=n.data.meta?.total||0):(this.beneficiariesStats=[],this.totalItems=0,m.error(n.data.message||"Failed to fetch data",{position:"top-right",autoClose:3e3})),this.loading=!1}catch(n){this.beneficiariesStats=[],this.totalItems=0,this.loading=!1;const e=n.response?.data?.message||"Failed to fetch beneficiaries statistics";m.error(e,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async fetchBeneficiariesStat(i){this.loading=!0;try{const t=await S.get(`beneficiaries-stats/${i}`);this.currentStat=t.data.data,this.loading=!1}catch{this.loading=!1,m.error("Failed to fetch beneficiaries stat",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async createBeneficiariesStat(i){try{const t=await S.post("beneficiaries-stats",i);this.createDialog=!1,m.success("Beneficiaries stat created successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchBeneficiariesStats({page:1,itemsPerPage:this.itemsPerPage})}catch(t){const n=t.response?.data?.message||"Failed to create beneficiaries stat. Please try again.";m.error(n,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async updateBeneficiariesStat(i,t){try{const n=await S.put(`beneficiaries-stats/${i}`,t);this.createDialog=!1,this.isEditMode=!1,m.success("Beneficiaries stat updated successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchBeneficiariesStats({page:1,itemsPerPage:this.itemsPerPage})}catch(n){const e=n.response?.data?.message||"Failed to update beneficiaries stat. Please try again.";m.error(e,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async deleteBeneficiariesStat(i){try{await S.delete(`beneficiaries-stats/${i}`),m.success("Beneficiaries stat deleted successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchBeneficiariesStats({page:1,itemsPerPage:this.itemsPerPage})}catch(t){const n=t.response?.data?.message||"Failed to delete beneficiaries stat. Please try again.";m.error(n,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async bulkDeleteBeneficiariesStats(i){try{const t=i.map(n=>S.delete(`beneficiaries-stats/${n}`));await Promise.all(t),m.success(`${i.length} beneficiaries stats deleted successfully!`,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchBeneficiariesStats({page:1,itemsPerPage:this.itemsPerPage})}catch{m.error("Failed to delete selected beneficiaries stats. Please try again.",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async getStatsSummary(){try{return(await S.get("beneficiaries-stats-summary")).data.data}catch{return[]}},getStatTypeLabel(i,t){const n=t||(y=>y),e=this.statTypesBase.find(y=>y.value===i);return e?n(e.labelKey):i},formatNumber(i){return new Intl.NumberFormat().format(i)},resetCurrentStat(){this.currentStat={id:null,stat_type:"",value:0,description:"",year:new Date().getFullYear()}}}});const le={dir:"rtl"},ne={class:"font-weight-bold pl-4"},ce={class:"flex w-100"},de={class:"flex w-100"},ue={class:"w-50 pl-2"},pe={class:"d-flex flex-row-reverse mb-6 mx-6"},fe={__name:"CreateBeneficiariesStats",setup(i){const{t,locale:n}=z(),e=L(),y=w(()=>e.statTypesBase.map(s=>({value:s.value,label:t(s.labelKey)}))),$=w(()=>e.isEditMode?t("update"):t("create")),M=w(()=>e.isEditMode?t("update"):t("submit")),V=g(null),l=N({id:null,stat_type:"",value:0,description:"",year:new Date().getFullYear()});te(()=>e.currentStat,s=>{s&&Object.keys(s).length>0&&(l.id=s.id,l.stat_type=s.stat_type||"",l.value=s.value||0,l.description=s.description||"",l.year=s.year||new Date().getFullYear())},{deep:!0,immediate:!0});const P={required:s=>!!s||t("field_required"),positiveNumber:s=>s!=null&&s>=0||t("positive_number"),year:s=>{if(!s)return!0;const c=parseInt(s);return c>=2e3&&c<=2100||t("year_range")},maxLength:s=>!s||s.length<=500||t("max_length_500")},F=async()=>{await V.value.validate()&&(e.isEditMode?await e.updateBeneficiariesStat(l.id,l):await e.createBeneficiariesStat(l))};return(s,c)=>{const E=o("v-icon"),O=o("v-btn"),d=o("v-card-title"),u=o("v-divider"),H=o("v-select"),C=o("v-text-field"),B=o("v-form"),D=o("v-card-text"),K=o("v-card"),I=o("v-dialog");return T(),q("div",le,[a(I,{transition:"dialog-top-transition",width:"50rem",modelValue:f(e).createDialog,"onUpdate:modelValue":c[4]||(c[4]=x=>f(e).createDialog=x),class:"rtl-dialog"},{default:r(({isActive:x})=>[a(K,{class:"px-3"},{default:r(()=>[a(d,{class:"px-2 pt-4 d-flex justify-space-between"},{default:r(()=>[_("h2",ne,h($.value),1),a(O,{variant:"text",onClick:v=>x.value=!1},{default:r(()=>[a(E,null,{default:r(()=>[...c[5]||(c[5]=[b("mdi-close",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1024),a(u,{class:"border-opacity-100 mx-6"}),a(D,null,{default:r(()=>[a(B,{ref_key:"formRef",ref:V,class:"pt-4"},{default:r(()=>[_("div",ce,[a(H,{modelValue:l.stat_type,"onUpdate:modelValue":c[0]||(c[0]=v=>l.stat_type=v),items:y.value,variant:"outlined",density:"compact","item-value":"value","item-title":"label","return-object":!1,label:s.$t("stat_type"),class:"pb-4 pr-2 w-50",rules:[P.required]},null,8,["modelValue","items","label","rules"]),a(C,{modelValue:l.value,"onUpdate:modelValue":c[1]||(c[1]=v=>l.value=v),modelModifiers:{number:!0},variant:"outlined",label:s.$t("value"),density:"compact",type:"number",min:"0",class:"pb-4 pl-2 w-50",rules:[P.required,P.positiveNumber]},null,8,["modelValue","label","rules"])]),_("div",de,[a(C,{modelValue:l.year,"onUpdate:modelValue":c[2]||(c[2]=v=>l.year=v),modelModifiers:{number:!0},variant:"outlined",label:s.$t("year"),density:"compact",type:"number",min:2e3,max:2100,class:"pb-4 pr-2 w-50",rules:[P.year]},null,8,["modelValue","label","rules"]),_("div",ue,[a(C,{modelValue:l.description,"onUpdate:modelValue":c[3]||(c[3]=v=>l.description=v),variant:"outlined",label:s.$t("description"),density:"compact",class:"pb-4",counter:500,rules:[P.maxLength]},null,8,["modelValue","label","rules"])])])]),_:1},512)]),_:1}),_("div",pe,[a(O,{class:"create-btn-gradient px-4",onClick:F},{default:r(()=>[b(h(M.value),1)]),_:1})])]),_:2},1024)]),_:1},8,["modelValue"])])}}},me=j(fe,[["__scopeId","data-v-09291236"]]),ge=["dir"],_e={class:"btn-search pt-12 pb-6"},ve={class:"text-field w-25"},be={class:"flex"},ye={class:"table-section"},he={__name:"BeneficiariesStats",setup(i){const{t,locale:n}=z();oe();const e=L(),y=w(()=>["fa","ps"].includes(n.value)?"rtl":"ltr");let $;const M=()=>{clearTimeout($),$=setTimeout(()=>{e.fetchBeneficiariesStats({page:1,itemsPerPage:e.itemsPerPage})},500)},V=d=>{e.fetchBeneficiariesStats({page:d.page,itemsPerPage:d.itemsPerPage})},l=g([]),P=()=>{l.value.length>0&&(e.bulkDeleteBeneficiariesStats(l.value),l.value=[])},F=()=>{e.resetCurrentStat(),e.isEditMode=!1,e.createDialog=!0},s=d=>{e.isEditMode=!0,e.currentStat={...d},e.createDialog=!0},c=async d=>{await e.deleteBeneficiariesStat(d.id)},E=w(()=>[{title:"",key:"checkbox",align:"start",sortable:!1,width:"50px"},{title:t("stat_type"),key:"stat_type",align:"start",sortable:!0,width:"180px"},{title:t("value"),key:"value",align:"end",sortable:!0,width:"150px"},{title:t("description"),key:"description",align:"start",sortable:!1,width:"400px"},{title:t("year"),key:"year",align:"start",sortable:!0,width:"120px"},{title:t("action"),key:"action",align:"center",sortable:!1,width:"100px"}]),O=d=>({farmers:"green",women:"pink",youth:"blue",total:"primary"})[d]||"grey";return(d,u)=>{const H=o("v-divider"),C=o("v-text-field"),B=o("v-btn"),D=o("v-chip"),K=o("v-checkbox"),I=o("v-icon"),x=o("v-list-item-title"),v=o("v-list-item"),Y=o("v-list"),A=o("v-menu"),G=o("v-data-table-server"),J=o("v-col"),Q=o("v-row"),W=o("v-main"),X=o("v-app");return T(),q(re,null,[f(e).createDialog?(T(),R(me,{key:0})):U("",!0),_("div",{dir:y.value},[a(ie,{pageTitle:d.$t("beneficiaries_stats_management")},null,8,["pageTitle"]),a(H,{thickness:1,class:"border-opacity-100"}),_("div",_e,[_("div",ve,[a(C,{color:"primary",density:"compact",variant:"outlined",label:d.$t("search"),"append-inner-icon":"mdi-magnify","hide-details":"",modelValue:f(e).beneficiariesStatsSearch,"onUpdate:modelValue":u[0]||(u[0]=p=>f(e).beneficiariesStatsSearch=p),onInput:M},null,8,["label","modelValue"])]),_("div",be,[a(B,{class:"action-btn-success"},{default:r(()=>[b(h(f(t)("filter")),1)]),_:1}),u[3]||(u[3]=b(" Â  ",-1)),a(B,{onClick:F,class:"create-btn-gradient",text:d.$t("create")},null,8,["text"])])]),_("div",ye,[a(X,null,{default:r(()=>[a(W,{class:"main"},{default:r(()=>[a(Q,null,{default:r(()=>[a(J,null,{default:r(()=>[a(G,{dir:y.value,theme:"cursor-pointer","items-per-page":f(e).itemsPerPage,"onUpdate:itemsPerPage":u[2]||(u[2]=p=>f(e).itemsPerPage=p),headers:E.value,"items-length":f(e).totalItems,items:f(e).beneficiariesStats,loading:f(e).loading,"onUpdate:options":V,hover:"",class:"w-100 mx-auto"},{"item.stat_type":r(({item:p})=>[a(D,{color:O(p.stat_type),variant:"flat",size:"small"},{default:r(()=>[b(h(f(e).getStatTypeLabel(p.stat_type,f(t))),1)]),_:2},1032,["color"])]),"item.value":r(({item:p})=>[_("span",{class:se(["font-weight-bold text-h6 value-cell",y.value==="rtl"?"text-left":"text-right"])},h(f(e).formatNumber(p.value)),3)]),"item.year":r(({item:p})=>[a(D,{color:"primary",variant:"outlined",size:"small"},{default:r(()=>[b(h(p.year),1)]),_:2},1024)]),"item.checkbox":r(({item:p})=>[a(K,{value:p.id,modelValue:l.value,"onUpdate:modelValue":u[1]||(u[1]=k=>l.value=k),class:"w-6 d-flex"},null,8,["value","modelValue"])]),"item.action":r(({item:p})=>[a(A,null,{activator:r(({props:k})=>[a(B,ae({icon:"mdi-dots-vertical"},k,{variant:"text"}),null,16)]),default:r(()=>[a(Y,null,{default:r(()=>[a(v,null,{default:r(()=>[a(x,{onClick:k=>s(p),class:"cursor-pointer d-flex gap-3 justify-left pb-3"},{default:r(()=>[a(I,{color:"primary"},{default:r(()=>[...u[4]||(u[4]=[b("mdi-square-edit-outline",-1)])]),_:1}),b(" "+h(d.$t("edit")),1)]),_:1},8,["onClick"]),a(x,{class:"cursor-pointer d-flex gap-3",onClick:k=>c(p)},{default:r(()=>[a(I,{color:"error"},{default:r(()=>[...u[5]||(u[5]=[b("mdi-delete-outline",-1)])]),_:1}),b(" "+h(d.$t("delete")),1)]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["dir","items-per-page","headers","items-length","items","loading"]),l.value.length>0?(T(),R(B,{key:0,class:"header-button",onClick:P,color:"#B71C1C",flat:"",inset:"",text:`Delete ${l.value.length} selected`},null,8,["text"])):U("",!0)]),_:1})]),_:1})]),_:1})]),_:1})])],8,ge)],64)}}},ke=j(he,[["__scopeId","data-v-81f40ed5"]]);export{ke as default};
