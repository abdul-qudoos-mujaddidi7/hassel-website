import{ak as le,j as V,M as I,r as _,am as oe,s as A,c as B,z as T,h as p,A as O,k as x,w as u,g as l,d as h,u as g,f as M,o as re,b as ne,m as w,t as P,v as ie,$ as de,F as ue}from"./_plugin-vue_export-helper-Bve7U4QZ.js";import{H as ce}from"./Header-EurA_yJ3.js";import{l as b,u as q,a as pe}from"./admin-DEzJhurF.js";import{T as k,a as ge}from"./TranslationField-BohEiJDC.js";/* empty css                                                               *//* empty css              */let j=le("NewsRepository",{state(){return{isEditMode:_(!1),router:oe(),search:_(""),loadingTable:_(!0),loading:_(!0),totalItems:_(0),selectedItems:_([]),itemsPerPage:_(5),createDialog:_(!1),news:I([]),newsSearch:_(""),currentNews:I({}),statusOptions:I([{value:"draft",label:"Draft"},{value:"published",label:"Published"},{value:"archived",label:"Archived"}])}},actions:{setEditMode(n){this.isEditMode=n},getTodaysDate(){const n=new Date,t=n.getFullYear(),s=String(n.getMonth()+1).padStart(2,"0"),a=String(n.getDate()).padStart(2,"0");return`${t}-${s}-${a}`},async fetchNews({page:n=1,itemsPerPage:t=5,status:s=""}){this.loading=!0;try{const a=new URLSearchParams({page:n,perPage:t,search:this.newsSearch});s&&a.append("status",s);const v=await V.get(`news?${a}`);console.log("API Response:",v.data),v.data.success?(this.news=v.data.data||[],this.totalItems=v.data.meta?.total||0):(this.news=[],this.totalItems=0,b.error(v.data.message||"Failed to fetch data",{position:"top-right",autoClose:3e3})),this.loading=!1}catch(a){console.error("API Error:",a),console.error("Error Response:",a.response?.data),this.news=[],this.totalItems=0,this.loading=!1;const v=a.response?.data?.message||"Failed to fetch news articles";b.error(v,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async fetchNewsItem(n){this.loading=!0;try{const t=await V.get(`news/${n}`,{params:{include_translations:1}});this.currentNews=t.data.data,this.loading=!1}catch(t){console.error(t),this.loading=!1,b.error("Failed to fetch news article",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async createNews(n){try{const t=await V.post("news",n);this.createDialog=!1,b.success("News article created successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchNews({page:1,itemsPerPage:this.itemsPerPage})}catch(t){console.error(t);const s=t.response?.data?.message||"Failed to create news article. Please try again.";b.error(s,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async updateNews(n,t){try{const s=await V.put(`news/${n}`,t);this.createDialog=!1,this.isEditMode=!1,b.success("News article updated successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchNews({page:1,itemsPerPage:this.itemsPerPage})}catch(s){console.error(s);const a=s.response?.data?.message||"Failed to update news article. Please try again.";b.error(a,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async deleteNews(n){try{await V.delete(`news/${n}`),b.success("News article deleted successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchNews({page:1,itemsPerPage:this.itemsPerPage})}catch(t){console.error(t);const s=t.response?.data?.message||"Failed to delete news article. Please try again.";b.error(s,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async bulkDeleteNews(n){try{const t=n.map(s=>V.delete(`news/${s}`));await Promise.all(t),b.success(`${n.length} news articles deleted successfully!`,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchNews({page:1,itemsPerPage:this.itemsPerPage})}catch(t){console.error(t),b.error("Failed to delete selected news articles. Please try again.",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async toggleStatus(n){try{const t=await V.post(`news/${n}/toggle-status`);b.success("News article status updated successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchNews({page:1,itemsPerPage:this.itemsPerPage})}catch(t){console.error(t);const s=t.response?.data?.message||"Failed to update news article status. Please try again.";b.error(s,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async getPublishedNews({page:n=1,itemsPerPage:t=10}){try{const s=new URLSearchParams({page:n,perPage:t,search:this.newsSearch});return(await V.get(`news/published?${s}`)).data}catch(s){return console.error(s),{success:!1,data:[],meta:{total:0}}}},getStatusLabel(n){const t=this.statusOptions.find(s=>s.value===n);return t?t.label:n},formatDate(n){return n?new Date(n).toLocaleDateString():""},resetCurrentNews(){this.currentNews={id:null,title:"",slug:"",excerpt:"",content:"",featured_image:"",status:"draft",published_at:null}}}});const me={class:"flex w-100"},he={class:"flex w-100"},fe={class:"flex w-100"},be={class:"w-100"},ve={__name:"CreateNews",setup(n){const{t}=q(),s=j(),a=B(()=>s.isEditMode?t("update"):t("create")),v=B(()=>s.isEditMode?t("update"):t("submit")),U=["title","excerpt","content"],d=I({id:null,title:"",slug:"",excerpt:"",content:"",featured_image:"",status:"draft",published_at:null}),S=_(!1);T(()=>s.currentNews,async e=>{e&&Object.keys(e).length>0&&(d.id=e.id,d.title=e.title||"",d.slug=e.slug||"",d.excerpt=e.excerpt||"",d.content=e.content||"",d.featured_image=e.featured_image||"",d.status=e.status||"draft",d.published_at=e.published_at?new Date(e.published_at).toISOString().slice(0,16):null,d.translationData={...e,farsi_translations:e.farsi_translations||{},pashto_translations:e.pashto_translations||{}},console.log("=== FORM DATA UPDATED ==="),console.log("Form data:",d),console.log("Translation data:",d.translationData),console.log("Farsi translations:",d.translationData.farsi_translations),console.log("Pashto translations:",d.translationData.pashto_translations),console.log("========================"))},{deep:!0,immediate:!0}),T(()=>d.status,e=>{e==="published"&&!d.published_at&&(d.published_at=new Date().toISOString().slice(0,16))});const D={required:e=>!!e||"This field is required.",maxLength:e=>!e||e.length<=500||"Excerpt must be 500 characters or less."},y=()=>{d.title&&!d.slug&&(d.slug=d.title.toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))},F=async e=>{S.value=!0;try{if(e.type==="complete"){const m={...e.data};m.published_at?m.published_at=new Date(m.published_at).toISOString():m.status==="published"&&(m.published_at=new Date().toISOString()),s.isEditMode?await s.updateNews(d.id,m):await s.createNews(m)}}catch(m){console.error("Error saving news:",m)}finally{S.value=!1}};return(e,m)=>{const C=p("v-text-field"),E=p("v-select"),H=p("v-textarea");return x(),O(ge,{modelValue:g(s).createDialog,"onUpdate:modelValue":m[0]||(m[0]=r=>g(s).createDialog=r),"form-title":a.value,"button-text":v.value,"translatable-fields":U,"form-data":d,rules:D,saving:S.value,"is-edit-mode":g(s).isEditMode,onSave:F},{"base-fields":u(({formData:r,rules:i})=>[h("div",me,[l(C,{modelValue:r.title,"onUpdate:modelValue":o=>r.title=o,variant:"outlined",label:e.$t("title"),density:"compact",class:"pb-4 pr-2 w-75",rules:[i.required],onInput:y},null,8,["modelValue","onUpdate:modelValue","label","rules"]),l(E,{modelValue:r.status,"onUpdate:modelValue":o=>r.status=o,items:g(s).statusOptions,variant:"outlined",density:"compact","item-value":"value","item-title":"label","return-object":!1,label:e.$t("status"),class:"pb-4 pl-2 w-25",rules:[i.required]},null,8,["modelValue","onUpdate:modelValue","items","label","rules"])]),h("div",he,[l(C,{modelValue:r.slug,"onUpdate:modelValue":o=>r.slug=o,variant:"outlined",label:e.$t("slug"),density:"compact",class:"pb-4 pr-2 w-50",hint:"URL-friendly version of the title","persistent-hint":""},null,8,["modelValue","onUpdate:modelValue","label"]),l(C,{modelValue:r.excerpt,"onUpdate:modelValue":o=>r.excerpt=o,variant:"outlined",label:e.$t("excerpt"),density:"compact",class:"pb-4 pl-2 w-50",counter:500,rules:[i.maxLength],hint:"Brief description of the article","persistent-hint":""},null,8,["modelValue","onUpdate:modelValue","label","rules"])]),h("div",fe,[l(C,{modelValue:r.featured_image,"onUpdate:modelValue":o=>r.featured_image=o,variant:"outlined",label:e.$t("featured_image"),density:"compact",class:"pb-4 pr-2 w-50",hint:"URL of the featured image","persistent-hint":""},null,8,["modelValue","onUpdate:modelValue","label"]),r.status==="published"?(x(),O(C,{key:0,modelValue:r.published_at,"onUpdate:modelValue":o=>r.published_at=o,variant:"outlined",label:e.$t("published_date"),density:"compact",type:"datetime-local",class:"pb-4 pl-2 w-50"},null,8,["modelValue","onUpdate:modelValue","label"])):M("",!0)]),h("div",be,[l(H,{modelValue:r.content,"onUpdate:modelValue":o=>r.content=o,variant:"outlined",label:e.$t("content"),density:"compact",class:"pb-4",rules:[i.required],rows:"8",hint:"Main content of the news article","persistent-hint":""},null,8,["modelValue","onUpdate:modelValue","label","rules"])])]),"farsi-fields":u(({translations:r,clearTranslation:i,hasTranslation:o})=>[l(k,{modelValue:r.title,"onUpdate:modelValue":f=>r.title=f,"field-name":"title","field-label":e.$t("title"),language:"farsi","language-label":e.$t("dari"),"has-translation":o("title"),onClear:i},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"]),l(k,{modelValue:r.excerpt,"onUpdate:modelValue":f=>r.excerpt=f,"field-name":"excerpt","field-label":e.$t("excerpt"),language:"farsi","language-label":e.$t("dari"),"field-type":"textarea",rows:3,"has-translation":o("excerpt"),onClear:i},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"]),l(k,{modelValue:r.content,"onUpdate:modelValue":f=>r.content=f,"field-name":"content","field-label":e.$t("content"),language:"farsi","language-label":e.$t("dari"),"field-type":"textarea",rows:8,"has-translation":o("content"),onClear:i},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"])]),"pashto-fields":u(({translations:r,clearTranslation:i,hasTranslation:o})=>[l(k,{modelValue:r.title,"onUpdate:modelValue":f=>r.title=f,"field-name":"title","field-label":e.$t("title"),language:"pashto","language-label":e.$t("pashto"),"has-translation":o("title"),onClear:i},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"]),l(k,{modelValue:r.excerpt,"onUpdate:modelValue":f=>r.excerpt=f,"field-name":"excerpt","field-label":e.$t("excerpt"),language:"pashto","language-label":e.$t("pashto"),"field-type":"textarea",rows:3,"has-translation":o("excerpt"),onClear:i},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"]),l(k,{modelValue:r.content,"onUpdate:modelValue":f=>r.content=f,"field-name":"content","field-label":e.$t("content"),language:"pashto","language-label":e.$t("pashto"),"field-type":"textarea",rows:8,"has-translation":o("content"),onClear:i},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"])]),_:1},8,["modelValue","form-title","button-text","form-data","saving","is-edit-mode"])}}},_e=A(ve,[["__scopeId","data-v-b3441dfc"]]),we=["dir"],ye={class:"btn-search pt-12 pb-6"},Pe={class:"text-field w-25"},Ve={class:"flex"},Ce={class:"table-section"},$e={class:"py-2 pl-4 d-flex align-center"},ke={class:"font-weight-medium"},xe={class:"text-caption text-grey"},Ue={class:"py-2 pl-4"},Se={__name:"News",setup(n){const{t,locale:s}=q();pe();const a=j(),v=B(()=>["fa","ps"].includes(s.value)?"rtl":"ltr"),U=_("");let d;const S=()=>{clearTimeout(d),d=setTimeout(()=>{a.fetchNews({page:1,itemsPerPage:a.itemsPerPage,status:U.value})},500)},D=i=>{a.fetchNews({page:i.page,itemsPerPage:i.itemsPerPage,status:U.value})},y=_([]),F=()=>{y.value.length>0&&(a.bulkDeleteNews(y.value),y.value=[])},e=()=>{a.resetCurrentNews(),a.isEditMode=!1,a.createDialog=!0},m=i=>{a.isEditMode=!0,a.currentNews={...i},a.createDialog=!0},C=async i=>{await a.deleteNews(i.id)},E=async i=>{await a.toggleStatus(i.id)},H=i=>{switch(i){case"published":return"success";case"draft":return"warning";case"archived":return"grey";default:return"primary"}},r=B(()=>[{title:"",key:"checkbox",align:"start",sortable:!1},{title:t("title"),key:"title",align:"start",sortable:!0},{title:t("status"),key:"status",align:"center",sortable:!0},{title:t("published_date"),key:"published_at",align:"center",sortable:!0},{title:t("action"),key:"action",align:"center",sortable:!1}]);return re(()=>{a.fetchNews({page:1,itemsPerPage:a.itemsPerPage})}),T(()=>s.value,()=>{a.fetchNews({page:1,itemsPerPage:a.itemsPerPage,status:U.value})}),(i,o)=>{const f=p("v-divider"),z=p("v-text-field"),N=p("v-btn"),Y=p("v-img"),G=p("v-avatar"),J=p("v-chip"),K=p("v-checkbox"),R=p("v-icon"),L=p("v-list-item-title"),Q=p("v-list-item"),W=p("v-list"),X=p("v-menu"),Z=p("v-data-table-server"),ee=p("v-col"),te=p("v-row"),ae=p("v-main"),se=p("v-app");return x(),ne(ue,null,[g(a).createDialog?(x(),O(_e,{key:0})):M("",!0),h("div",{dir:v.value},[l(ce,{pageTitle:i.$t("news_management")},null,8,["pageTitle"]),l(f,{thickness:1,class:"border-opacity-100"}),h("div",ye,[h("div",Pe,[l(z,{color:"primary",density:"compact",variant:"outlined",label:i.$t("search"),"append-inner-icon":"mdi-magnify","hide-details":"",modelValue:g(a).newsSearch,"onUpdate:modelValue":o[0]||(o[0]=c=>g(a).newsSearch=c),onInput:S},null,8,["label","modelValue"])]),h("div",Ve,[l(N,{class:"action-btn-success"},{default:u(()=>[w(P(g(t)("filter")),1)]),_:1}),o[3]||(o[3]=w(" Â  ",-1)),l(N,{onClick:ie(e,["stop"]),variant:"flat",class:"action-btn-success"},{default:u(()=>[w(P(g(t)("create")),1)]),_:1})])]),h("div",Ce,[l(se,null,{default:u(()=>[l(ae,{class:"main"},{default:u(()=>[l(te,null,{default:u(()=>[l(ee,null,{default:u(()=>[l(Z,{dir:v.value,theme:"cursor-pointer","items-per-page":g(a).itemsPerPage,"onUpdate:itemsPerPage":o[2]||(o[2]=c=>g(a).itemsPerPage=c),headers:r.value,"items-length":g(a).totalItems,items:g(a).news,loading:g(a).loading,"onUpdate:options":D,hover:"",class:"w-100 mx-auto"},{"item.title":u(({item:c})=>[h("div",$e,[c.featured_image?(x(),O(G,{key:0,size:"40",class:"mr-3"},{default:u(()=>[l(Y,{src:c.featured_image,alt:c.title},null,8,["src","alt"])]),_:2},1024)):M("",!0),h("div",null,[h("div",ke,P(c.title),1),h("div",xe,P(c.excerpt),1)])])]),"item.status":u(({item:c})=>[h("div",Ue,[l(J,{color:H(c.status),size:"small",variant:"flat"},{default:u(()=>[w(P(g(a).getStatusLabel(c.status)),1)]),_:2},1032,["color"])])]),"item.checkbox":u(({item:c})=>[l(K,{value:c.id,modelValue:y.value,"onUpdate:modelValue":o[1]||(o[1]=$=>y.value=$),class:"w-6 d-flex"},null,8,["value","modelValue"])]),"item.action":u(({item:c})=>[l(X,null,{activator:u(({props:$})=>[l(N,de({icon:"mdi-dots-vertical"},$,{variant:"text"}),null,16)]),default:u(()=>[l(W,null,{default:u(()=>[l(Q,null,{default:u(()=>[l(L,{onClick:$=>m(c),class:"cursor-pointer d-flex gap-3 justify-left pb-3"},{default:u(()=>[l(R,{color:"tealColor"},{default:u(()=>[...o[4]||(o[4]=[w("mdi-square-edit-outline",-1)])]),_:1}),w(" "+P(i.$t("edit")),1)]),_:1},8,["onClick"]),l(L,{onClick:$=>E(c),class:"cursor-pointer d-flex gap-3 pb-3"},{default:u(()=>[l(R,{color:c.status==="published"?"orange":"green"},{default:u(()=>[w(P(c.status==="published"?"mdi-eye-off":"mdi-eye"),1)]),_:2},1032,["color"]),w(" "+P(c.status==="published"?"Unpublish":"Publish"),1)]),_:2},1032,["onClick"]),l(L,{class:"cursor-pointer d-flex gap-3",onClick:$=>C(c)},{default:u(()=>[l(R,{color:"error"},{default:u(()=>[...o[5]||(o[5]=[w("mdi-delete-outline",-1)])]),_:1}),w(" "+P(i.$t("delete")),1)]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["dir","items-per-page","headers","items-length","items","loading"]),y.value.length>0?(x(),O(N,{key:0,class:"header-button",onClick:F,color:"#B71C1C",flat:"",inset:"",text:`Delete ${y.value.length} selected`},null,8,["text"])):M("",!0)]),_:1})]),_:1})]),_:1})]),_:1})])],8,we)],64)}}},Fe=A(Se,[["__scopeId","data-v-b1a2d657"]]);export{Fe as default};
