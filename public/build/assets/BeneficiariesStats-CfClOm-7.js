import{ak as ee,j as S,M,r as v,am as te,s as q,c as T,z as se,h as o,b as A,k as C,g as a,w as i,d as m,t as y,m as b,u,A as D,f as O,$ as ae,F as ie}from"./_plugin-vue_export-helper-Bve7U4QZ.js";import{H as re}from"./Header-EurA_yJ3.js";import{l as _,u as Y,a as oe}from"./admin-DEzJhurF.js";/* empty css                                                               *//* empty css              */let L=ee("BeneficiariesRepository",{state(){return{isEditMode:v(!1),router:te(),search:v(""),loadingTable:v(!0),loading:v(!0),totalItems:v(0),selectedItems:v([]),itemsPerPage:v(5),createDialog:v(!1),beneficiariesStats:M([]),beneficiariesStatsSearch:v(""),currentStat:M({}),statTypes:M([{value:"beneficiaries",label:"Beneficiaries"},{value:"total_beneficiaries",label:"Total Beneficiaries"},{value:"male_beneficiaries",label:"Male Beneficiaries"},{value:"female_beneficiaries",label:"Female Beneficiaries"},{value:"programs_completed",label:"Programs Completed"},{value:"provinces_reached",label:"Provinces Reached"},{value:"cooperatives_formed",label:"Cooperatives Formed"},{value:"projects",label:"Projects"},{value:"staff",label:"Staff"},{value:"partners",label:"Partners"}])}},actions:{setEditMode(r){this.isEditMode=r},getTodaysDate(){const r=new Date,e=r.getFullYear(),t=String(r.getMonth()+1).padStart(2,"0"),g=String(r.getDate()).padStart(2,"0");return`${e}-${t}-${g}`},async fetchBeneficiariesStats({page:r=1,itemsPerPage:e=5}){this.loading=!0;try{const t=await S.get(`beneficiaries-stats?page=${r}&perPage=${e}&search=${this.beneficiariesStatsSearch}`);console.log("API Response:",t.data),t.data.success?(this.beneficiariesStats=t.data.data||[],this.totalItems=t.data.meta?.total||0):(this.beneficiariesStats=[],this.totalItems=0,_.error(t.data.message||"Failed to fetch data",{position:"top-right",autoClose:3e3})),this.loading=!1}catch(t){console.error("API Error:",t),console.error("Error Response:",t.response?.data),this.beneficiariesStats=[],this.totalItems=0,this.loading=!1;const g=t.response?.data?.message||"Failed to fetch beneficiaries statistics";_.error(g,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async fetchBeneficiariesStat(r){this.loading=!0;try{const e=await S.get(`beneficiaries-stats/${r}`);this.currentStat=e.data.data,this.loading=!1}catch(e){console.error(e),this.loading=!1,_.error("Failed to fetch beneficiaries stat",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async createBeneficiariesStat(r){try{const e=await S.post("beneficiaries-stats",r);this.createDialog=!1,_.success("Beneficiaries stat created successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchBeneficiariesStats({page:1,itemsPerPage:this.itemsPerPage})}catch(e){console.error(e);const t=e.response?.data?.message||"Failed to create beneficiaries stat. Please try again.";_.error(t,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async updateBeneficiariesStat(r,e){try{const t=await S.put(`beneficiaries-stats/${r}`,e);this.createDialog=!1,this.isEditMode=!1,_.success("Beneficiaries stat updated successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchBeneficiariesStats({page:1,itemsPerPage:this.itemsPerPage})}catch(t){console.error(t);const g=t.response?.data?.message||"Failed to update beneficiaries stat. Please try again.";_.error(g,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async deleteBeneficiariesStat(r){try{await S.delete(`beneficiaries-stats/${r}`),_.success("Beneficiaries stat deleted successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchBeneficiariesStats({page:1,itemsPerPage:this.itemsPerPage})}catch(e){console.error(e);const t=e.response?.data?.message||"Failed to delete beneficiaries stat. Please try again.";_.error(t,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async bulkDeleteBeneficiariesStats(r){try{const e=r.map(t=>S.delete(`beneficiaries-stats/${t}`));await Promise.all(e),_.success(`${r.length} beneficiaries stats deleted successfully!`,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchBeneficiariesStats({page:1,itemsPerPage:this.itemsPerPage})}catch(e){console.error(e),_.error("Failed to delete selected beneficiaries stats. Please try again.",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async getStatsSummary(){try{return(await S.get("beneficiaries-stats-summary")).data.data}catch(r){return console.error(r),[]}},getStatTypeLabel(r){const e=this.statTypes.find(t=>t.value===r);return e?e.label:r},formatNumber(r){return new Intl.NumberFormat().format(r)},resetCurrentStat(){this.currentStat={id:null,stat_type:"",value:0,description:"",year:new Date().getFullYear()}}}});const le={dir:"rtl"},ne={class:"font-weight-bold pl-4"},ce={class:"flex w-100"},de={class:"flex w-100"},ue={class:"w-50 pl-2"},pe={class:"d-flex flex-row-reverse mb-6 mx-6"},fe={__name:"CreateBeneficiariesStats",setup(r){const{t:e}=Y(),t=L(),g=T(()=>t.isEditMode?e("update"):e("create")),l=T(()=>t.isEditMode?e("update"):e("submit")),x=v(null),n=M({id:null,stat_type:"",value:0,description:"",year:new Date().getFullYear()});se(()=>t.currentStat,s=>{s&&Object.keys(s).length>0&&(n.id=s.id,n.stat_type=s.stat_type||"",n.value=s.value||0,n.description=s.description||"",n.year=s.year||new Date().getFullYear())},{deep:!0,immediate:!0});const P={required:s=>!!s||"This field is required.",positiveNumber:s=>s!=null&&s>=0||"Value must be a positive number.",year:s=>{if(!s)return!0;const c=parseInt(s);return c>=2e3&&c<=2100||"Year must be between 2000 and 2100."},maxLength:s=>!s||s.length<=500||"Description must be 500 characters or less."},I=async()=>{await x.value.validate()&&(t.isEditMode?await t.updateBeneficiariesStat(n.id,n):await t.createBeneficiariesStat(n))};return(s,c)=>{const $=o("v-icon"),V=o("v-btn"),F=o("v-card-title"),E=o("v-divider"),H=o("v-select"),d=o("v-text-field"),p=o("v-form"),R=o("v-card-text"),U=o("v-card"),B=o("v-dialog");return C(),A("div",le,[a(B,{transition:"dialog-top-transition",width:"50rem",modelValue:u(t).createDialog,"onUpdate:modelValue":c[4]||(c[4]=k=>u(t).createDialog=k),class:"rtl-dialog"},{default:i(({isActive:k})=>[a(U,{class:"px-3"},{default:i(()=>[a(F,{class:"px-2 pt-4 d-flex justify-space-between"},{default:i(()=>[m("h2",ne,y(g.value),1),a(V,{variant:"text",onClick:h=>k.value=!1},{default:i(()=>[a($,null,{default:i(()=>[...c[5]||(c[5]=[b("mdi-close",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1024),a(E,{class:"border-opacity-100 mx-6"}),a(R,null,{default:i(()=>[a(p,{ref_key:"formRef",ref:x,class:"pt-4"},{default:i(()=>[m("div",ce,[a(H,{modelValue:n.stat_type,"onUpdate:modelValue":c[0]||(c[0]=h=>n.stat_type=h),items:u(t).statTypes,variant:"outlined",density:"compact","item-value":"value","item-title":"label","return-object":!1,label:s.$t("stat_type"),class:"pb-4 pr-2 w-50",rules:[P.required]},null,8,["modelValue","items","label","rules"]),a(d,{modelValue:n.value,"onUpdate:modelValue":c[1]||(c[1]=h=>n.value=h),modelModifiers:{number:!0},variant:"outlined",label:s.$t("value"),density:"compact",type:"number",min:"0",class:"pb-4 pl-2 w-50",rules:[P.required,P.positiveNumber]},null,8,["modelValue","label","rules"])]),m("div",de,[a(d,{modelValue:n.year,"onUpdate:modelValue":c[2]||(c[2]=h=>n.year=h),modelModifiers:{number:!0},variant:"outlined",label:s.$t("year"),density:"compact",type:"number",min:2e3,max:2100,class:"pb-4 pr-2 w-50",rules:[P.year]},null,8,["modelValue","label","rules"]),m("div",ue,[a(d,{modelValue:n.description,"onUpdate:modelValue":c[3]||(c[3]=h=>n.description=h),variant:"outlined",label:s.$t("description"),density:"compact",class:"pb-4",counter:500,rules:[P.maxLength]},null,8,["modelValue","label","rules"])])])]),_:1},512)]),_:1}),m("div",pe,[a(V,{class:"create-btn-gradient px-4",onClick:I},{default:i(()=>[a($,null,{default:i(()=>[...c[6]||(c[6]=[b("mdi-content-save",-1)])]),_:1}),b(" "+y(l.value),1)]),_:1})])]),_:2},1024)]),_:1},8,["modelValue"])])}}},me=q(fe,[["__scopeId","data-v-12aa32f0"]]),ge=["dir"],_e={class:"btn-search pt-12 pb-6"},ve={class:"text-field w-25"},be={class:"flex"},he={class:"table-section"},ye={class:"py-2 pl-4"},Pe={class:"py-2 pl-4"},Se={class:"font-weight-bold text-h6"},Be={class:"py-2 pl-4"},ke={__name:"BeneficiariesStats",setup(r){const{t:e,locale:t}=Y(),g=oe(),l=L(),x=T(()=>["fa","pa"].includes(t.value)?"rtl":"ltr");let n;const P=()=>{clearTimeout(n),n=setTimeout(()=>{l.fetchBeneficiariesStats({page:1,itemsPerPage:l.itemsPerPage})},500)},I=d=>{l.fetchBeneficiariesStats({page:d.page,itemsPerPage:d.itemsPerPage})},s=v([]),c=()=>{s.value.length>0&&(l.bulkDeleteBeneficiariesStats(s.value),s.value=[])},$=()=>{l.resetCurrentStat(),l.isEditMode=!1,l.createDialog=!0},V=d=>{l.isEditMode=!0,l.currentStat={...d},l.createDialog=!0},F=async d=>{await l.deleteBeneficiariesStat(d.id)},E=T(()=>[{title:"",key:"checkbox",align:"start",sortable:!1},{title:e("stat_type"),key:"stat_type",align:"center",sortable:!0},{title:e("value"),key:"value",align:"center",sortable:!0},{title:e("description"),key:"description",align:"start",sortable:!1},{title:e("year"),key:"year",align:"center",sortable:!0},{title:e("action"),key:"action",align:"center",sortable:!1}]),H=d=>({farmers:"green",women:"pink",youth:"blue",total:"primary"})[d]||"grey";return(d,p)=>{const R=o("v-divider"),U=o("v-text-field"),B=o("v-btn"),k=o("v-chip"),h=o("v-checkbox"),N=o("v-icon"),j=o("v-list-item-title"),z=o("v-list-item"),G=o("v-list"),J=o("v-menu"),K=o("v-data-table-server"),Q=o("v-col"),W=o("v-row"),X=o("v-main"),Z=o("v-app");return C(),A(ie,null,[u(l).createDialog?(C(),D(me,{key:0})):O("",!0),m("div",{dir:x.value},[a(re,{pageTitle:d.$t("beneficiaries_stats")},null,8,["pageTitle"]),a(R,{thickness:1,class:"border-opacity-100"}),m("div",_e,[m("div",ve,[a(U,{color:"primary",density:"compact",variant:"outlined",label:d.$t("search"),"append-inner-icon":"mdi-magnify","hide-details":"",modelValue:u(l).beneficiariesStatsSearch,"onUpdate:modelValue":p[0]||(p[0]=f=>u(l).beneficiariesStatsSearch=f),onInput:P},null,8,["label","modelValue"])]),m("div",be,[a(B,{class:"action-btn-success"},{default:i(()=>[b(y(u(e)("filter")),1)]),_:1}),p[3]||(p[3]=b(" Â  ",-1)),a(B,{onClick:$,class:"create-btn-gradient",text:d.$t("create")},null,8,["text"])])]),m("div",he,[a(Z,null,{default:i(()=>[a(X,{class:"main"},{default:i(()=>[a(W,null,{default:i(()=>[a(Q,null,{default:i(()=>[a(K,{dir:x.value,theme:"cursor-pointer","items-per-page":u(l).itemsPerPage,"onUpdate:itemsPerPage":p[2]||(p[2]=f=>u(l).itemsPerPage=f),headers:E.value,"items-length":u(l).totalItems,items:u(l).beneficiariesStats,loading:u(l).loading,"onUpdate:options":I,hover:"",class:"w-100 mx-auto"},{"item.stat_type":i(({item:f})=>[m("td",ye,[a(k,{color:H(f.stat_type),variant:"flat",size:"small"},{default:i(()=>[b(y(u(l).getStatTypeLabel(f.stat_type)),1)]),_:2},1032,["color"])])]),"item.value":i(({item:f})=>[m("td",Pe,[m("span",Se,y(u(l).formatNumber(f.value)),1)])]),"item.year":i(({item:f})=>[m("td",Be,[a(k,{color:"primary",variant:"outlined",size:"small"},{default:i(()=>[b(y(f.year),1)]),_:2},1024)])]),"item.checkbox":i(({item:f})=>[a(h,{value:f.id,modelValue:s.value,"onUpdate:modelValue":p[1]||(p[1]=w=>s.value=w),class:"w-6 d-flex"},null,8,["value","modelValue"])]),"item.action":i(({item:f})=>[a(J,null,{activator:i(({props:w})=>[a(B,ae({icon:"mdi-dots-vertical"},w,{variant:"text"}),null,16)]),default:i(()=>[a(G,null,{default:i(()=>[a(z,null,{default:i(()=>[u(g).permissions&&u(g).permissions.includes("editBeneficiariesStats")?(C(),D(j,{key:0,onClick:w=>V(f),class:"cursor-pointer d-flex gap-3 justify-left pb-3"},{default:i(()=>[a(N,{color:"primary"},{default:i(()=>[...p[4]||(p[4]=[b("mdi-square-edit-outline",-1)])]),_:1}),b(" "+y(d.$t("edit")),1)]),_:1},8,["onClick"])):O("",!0),u(g).permissions&&u(g).permissions.includes("deleteBeneficiariesStats")?(C(),D(j,{key:1,class:"cursor-pointer d-flex gap-3",onClick:w=>F(f)},{default:i(()=>[a(N,{color:"error"},{default:i(()=>[...p[5]||(p[5]=[b("mdi-delete-outline",-1)])]),_:1}),b(" "+y(d.$t("delete")),1)]),_:1},8,["onClick"])):O("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["dir","items-per-page","headers","items-length","items","loading"]),s.value.length>0?(C(),D(B,{key:0,class:"header-button",onClick:c,color:"#B71C1C",flat:"",inset:"",text:`Delete ${s.value.length} selected`},null,8,["text"])):O("",!0)]),_:1})]),_:1})]),_:1})]),_:1})])],8,ge)],64)}}},De=q(ke,[["__scopeId","data-v-335c227d"]]);export{De as default};
