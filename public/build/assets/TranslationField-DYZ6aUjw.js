import{N as it,c as T,q as U,r as k,o as dt,y as C,h as p,b as E,j as _,g as u,w as f,d as V,t as D,l as O,F as ut,e as ct,u as b,z as J,an as I,k as z,a7 as ft,f as mt,A as pt}from"./_plugin-vue_export-helper-P6s7mfAX.js";import{u as R}from"./admin-C1tUPR0Q.js";function yt(a=[]){const{t:y}=R(),t=it({farsi:{},pashto:{}}),i=()=>{a.forEach(e=>{e==="target_crops"||e==="partner_organizations"||e==="features"?(t.farsi[e]=[],t.pashto[e]=[]):(t.farsi[e]="",t.pashto[e]="")})},F=(e={})=>{const r=n=>n?Object.values(n).every(m=>typeof m=="string"?!m||m==="":Array.isArray(m)?m.length===0:!m):!0;r(t.farsi)&&r(t.pashto)&&i();const s=(n,m)=>{if((m==="target_crops"||m==="partner_organizations"||m==="features")&&typeof n=="string")try{const x=JSON.parse(n);if(Array.isArray(x))return x}catch{}return n||""};e.farsi_translations&&Object.keys(e.farsi_translations).forEach(n=>{t.farsi[n]!==void 0&&(t.farsi[n]=s(e.farsi_translations[n],n))}),e.pashto_translations&&Object.keys(e.pashto_translations).forEach(n=>{t.pashto[n]!==void 0&&(t.pashto[n]=s(e.pashto_translations[n],n))})},B=(e,r)=>{t[e]&&t[e][r]!==void 0&&(t[e][r]="")},S=e=>{t[e]&&Object.keys(t[e]).forEach(r=>{t[e][r]=""})},g=e=>{if(!t[e])return 0;const r=a.length,s=Object.values(t[e]).filter(n=>typeof n=="string"?n&&n.trim()!=="":Array.isArray(n)?n.length>0:!!n).length;return r>0?Math.round(s/r*100):0},c=T(()=>({farsi:g("farsi"),pashto:g("pashto")})),A=(e,r)=>{if(!t[e]||!t[e][r])return!1;const s=t[e][r];return typeof s=="string"?s.trim()!=="":Array.isArray(s)?s.length>0:!!s},v=e=>e===100?"success":e>=50?"warning":"error",w=()=>{const e={farsi:{},pashto:{}},r=s=>typeof s=="string"?s.trim()!=="":Array.isArray(s)?s.length>0:!!s;return Object.keys(t.farsi).forEach(s=>{r(t.farsi[s])&&(Array.isArray(t.farsi[s])?e.farsi[s]=JSON.stringify(t.farsi[s]):e.farsi[s]=t.farsi[s])}),Object.keys(t.pashto).forEach(s=>{r(t.pashto[s])&&(Array.isArray(t.pashto[s])?e.pashto[s]=JSON.stringify(t.pashto[s]):e.pashto[s]=t.pashto[s])}),e},L={farsi:y("dari"),pashto:y("pashto")},N=T(()=>[{key:"base",title:y("english"),icon:"mdi-translate"},{key:"farsi",title:y("dari"),icon:"mdi-flag",coverage:c.value.farsi},{key:"pashto",title:y("pashto"),icon:"mdi-flag",coverage:c.value.pashto}]);return{translations:t,initializeTranslations:i,loadTranslations:F,clearTranslation:B,clearLanguageTranslations:S,getTranslationCoverage:g,getTranslationCoverages:c,hasTranslation:A,getCoverageBadgeColor:v,prepareTranslationsForApi:w,languageLabels:L,translationTabs:N}}const gt=["dir"],ht={class:"font-weight-bold pl-4"},vt={class:"translation-tab"},bt={class:"translation-tab"},Tt={class:"d-flex flex-row-reverse mb-6 mx-6"},St={__name:"TranslatableForm",props:{modelValue:{type:Boolean,default:!1},formTitle:{type:String,required:!0},buttonText:{type:String,default:"Save"},buttonClass:{type:String,default:"action-btn action-btn-success px-4"},width:{type:String,default:"60rem"},transition:{type:String,default:"dialog-top-transition"},dialogClass:{type:String,default:"rtl-dialog"},translatableFields:{type:Array,required:!0},formData:{type:Object,required:!0},rules:{type:Object,default:()=>({})},saving:{type:Boolean,default:!1},dir:{type:String,default:null},isEditMode:{type:Boolean,default:!1}},emits:["update:modelValue","save","load-translations"],setup(a,{expose:y,emit:t}){const i=a,F=t,{t:B,locale:S}=R(),g=T(()=>i.dir!==null?i.dir:["fa","ps"].includes(S.value)?"rtl":"ltr"),{translations:c,initializeTranslations:A,loadTranslations:v,clearTranslation:w,clearLanguageTranslations:L,hasTranslation:N,prepareTranslationsForApi:e,translationTabs:r}=yt(i.translatableFields),s=k(null),n=k("base"),m=k(!1),x=k(!1),H=k(!1),j=T({get:()=>i.modelValue,set:l=>F("update:modelValue",l)}),G=()=>{const l=["title"];m.value=l.every(o=>i.formData[o]&&i.formData[o].toString().trim()!=="")},W=()=>{const l=Object.values(c.farsi).some(o=>o&&o.toString().trim()!=="");x.value=l},K=()=>{const l=Object.values(c.pashto).some(o=>o&&o.toString().trim()!=="");H.value=l},$=()=>{g.value==="rtl"&&ft(()=>{setTimeout(()=>{((s.value?.$el||document).querySelectorAll?.('.v-field__input, .v-text-field input, .v-textarea textarea, input[type="text"], input[type="number"], textarea')||[]).forEach(h=>{h&&h.tagName&&(h.style.setProperty("text-align","right","important"),h.style.setProperty("direction","rtl","important"))})},150)})};dt(()=>{!i.isEditMode&&!i.formData?.translationData&&A(),$()}),C(()=>i.formData,(l,o)=>{l?.translationData&&o?.translationData&&l.translationData.id===o.translationData.id||(l&&l.translations?v(l.translations):l&&l.translationData&&v(l.translationData),G())},{deep:!0,immediate:!0}),C(()=>c.farsi,()=>{W()},{deep:!0}),C(()=>c.pashto,()=>{K()},{deep:!0}),C(()=>g.value,()=>{$()},{immediate:!0}),C(()=>j.value,l=>{l&&$()});const Q=()=>X()&&i.isEditMode?"Update All Content":"Save All Content",X=()=>m.value&&(x.value||H.value),Y=async()=>{const{valid:l}=await s.value.validate();if(!l)return;const o={...i.formData,translations:e()};F("save",{data:o,type:"complete"})};return y({formRef:s,clearTranslation:w,clearLanguageTranslations:L,loadTranslations:v}),(l,o)=>{const h=p("v-icon"),M=p("v-btn"),Z=p("v-card-title"),tt=p("v-divider"),et=p("v-tab"),at=p("v-tabs"),q=p("v-window-item"),st=p("v-window"),nt=p("v-form"),lt=p("v-card-text"),ot=p("v-card"),rt=p("v-dialog");return _(),E("div",{dir:g.value},[u(rt,{transition:a.transition,width:a.width,modelValue:j.value,"onUpdate:modelValue":o[2]||(o[2]=P=>j.value=P),class:z(a.dialogClass)},{default:f(({isActive:P})=>[u(ot,{class:"px-3"},{default:f(()=>[u(Z,{class:"px-2 pt-4 d-flex justify-space-between"},{default:f(()=>[V("h2",ht,D(a.formTitle),1),u(M,{variant:"text",onClick:d=>P.value=!1},{default:f(()=>[u(h,null,{default:f(()=>[...o[3]||(o[3]=[O("mdi-close",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1024),u(tt,{class:"border-opacity-100 mx-6"}),u(lt,null,{default:f(()=>[u(nt,{ref_key:"formRef",ref:s,class:"pt-4"},{default:f(()=>[u(at,{modelValue:n.value,"onUpdate:modelValue":o[0]||(o[0]=d=>n.value=d),color:"primary",class:"mb-4","align-tabs":"start"},{default:f(()=>[(_(!0),E(ut,null,ct(b(r),d=>(_(),J(et,{key:d.key,value:d.key,class:"text-capitalize"},{default:f(()=>[u(h,{icon:d.icon,class:"me-2"},null,8,["icon"]),O(" "+D(d.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),u(st,{modelValue:n.value,"onUpdate:modelValue":o[1]||(o[1]=d=>n.value=d)},{default:f(()=>[u(q,{value:"base"},{default:f(()=>[I(l.$slots,"base-fields",{formData:a.formData,rules:a.rules},void 0,!0)]),_:3}),u(q,{value:"farsi"},{default:f(()=>[V("div",vt,[I(l.$slots,"farsi-fields",{translations:b(c).farsi,clearTranslation:d=>b(w)("farsi",d),hasTranslation:d=>b(N)("farsi",d)},void 0,!0)])]),_:3}),u(q,{value:"pashto"},{default:f(()=>[V("div",bt,[I(l.$slots,"pashto-fields",{translations:b(c).pashto,clearTranslation:d=>b(w)("pashto",d),hasTranslation:d=>b(N)("pashto",d)},void 0,!0)])]),_:3})]),_:3},8,["modelValue"])]),_:3},512)]),_:3}),V("div",Tt,[u(M,{class:z(a.buttonClass),loading:a.saving,disabled:a.saving,onClick:Y},{default:f(()=>[u(h,null,{default:f(()=>[...o[4]||(o[4]=[O("mdi-content-save",-1)])]),_:1}),O(" "+D(Q()),1)]),_:1},8,["class","loading","disabled"])])]),_:2},1024)]),_:3},8,["transition","width","modelValue","class"])],8,gt)}}},Ct=U(St,[["__scopeId","data-v-9bc9d9d0"]]),At={class:"translation-field mb-4"},xt={class:"d-flex justify-space-between align-center mb-2"},Vt={class:"text-subtitle-2 font-weight-medium"},_t={key:0,class:"text-caption text-grey mt-1"},Ft={__name:"TranslationField",props:{fieldName:{type:String,required:!0},fieldLabel:{type:String,required:!0},language:{type:String,required:!0},languageLabel:{type:String,required:!0},modelValue:{type:[String,Number,Array],default:""},fieldType:{type:String,default:"text",validator:a=>["text","textarea","select","multiselect","date","number"].includes(a)},variant:{type:String,default:"outlined"},density:{type:String,default:"compact"},placeholder:{type:String,default:""},rules:{type:Array,default:()=>[]},rows:{type:[String,Number],default:3},type:{type:String,default:"text"},items:{type:Array,default:()=>[]},itemTitle:{type:String,default:"title"},itemValue:{type:String,default:"value"},multiple:{type:Boolean,default:!1},chips:{type:Boolean,default:!1},closableChips:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},hint:{type:String,default:""},persistentHint:{type:Boolean,default:!1},fieldClass:{type:String,default:""}},emits:["update:modelValue","clear"],setup(a,{emit:y}){const t=a,i=y,{t:F}=R(),B=T(()=>{switch(t.fieldType){case"textarea":return"v-textarea";case"select":case"multiselect":return"v-select";case"date":return"v-text-field";case"number":return"v-text-field";default:return"v-text-field"}}),S=T({get:()=>t.modelValue,set:c=>i("update:modelValue",c)});T(()=>Array.isArray(t.modelValue)?t.modelValue.length>0:t.modelValue&&t.modelValue.toString().trim()!=="");const g=c=>{i("update:modelValue",c)};return(c,A)=>(_(),E("div",At,[V("div",xt,[V("label",Vt,D(a.fieldLabel),1)]),(_(),J(pt(B.value),{modelValue:S.value,"onUpdate:modelValue":[A[0]||(A[0]=v=>S.value=v),g],variant:a.variant,density:a.density,label:a.placeholder,rules:a.rules,rows:a.rows,type:a.type,items:a.items,"item-title":a.itemTitle,"item-value":a.itemValue,multiple:a.multiple,chips:a.chips,"closable-chips":a.closableChips,disabled:a.disabled,readonly:a.readonly,hint:a.hint,"persistent-hint":a.persistentHint,class:z(a.fieldClass)},null,8,["modelValue","variant","density","label","rules","rows","type","items","item-title","item-value","multiple","chips","closable-chips","disabled","readonly","hint","persistent-hint","class"])),a.hint&&!a.persistentHint?(_(),E("div",_t,D(a.hint),1)):mt("",!0)]))}},Dt=U(Ft,[["__scopeId","data-v-ae2bb894"]]);export{Dt as T,Ct as a};
