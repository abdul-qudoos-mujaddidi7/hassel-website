import{al as oe,i as w,N as q,r as b,G as re,q as Y,c as T,y as W,h as m,z as L,j as U,w as n,g as a,d as g,b as R,f as M,u as v,t as O,B as ie,D as ne,l as $,o as ue,a0 as ce,F as de}from"./_plugin-vue_export-helper-P6s7mfAX.js";import{H as pe}from"./Header-Dc2gjrUc.js";import{l as V,u as K,a as ge}from"./admin-C1tUPR0Q.js";import{T as x,a as me}from"./TranslationField-DYZ6aUjw.js";/* empty css                                                               *//* empty css              */let Q=oe("SuccessStoriesRepository",{state(){return{isEditMode:b(!1),router:re(),search:b(""),loadingTable:b(!0),loading:b(!0),totalItems:b(0),selectedItems:b([]),itemsPerPage:b(5),createDialog:b(!1),successStories:q([]),successStoriesSearch:b(""),currentSuccessStory:q({}),statusOptions:q([{value:"draft",label:"Draft"},{value:"published",label:"Published"},{value:"archived",label:"Archived"}])}},actions:{setEditMode(i){this.isEditMode=i},getTodaysDate(){const i=new Date,t=i.getFullYear(),s=String(i.getMonth()+1).padStart(2,"0"),l=String(i.getDate()).padStart(2,"0");return`${t}-${s}-${l}`},async fetchSuccessStories({page:i=1,itemsPerPage:t=5,status:s=""}){this.loading=!0;try{const l=new URLSearchParams({page:i,perPage:t,search:this.successStoriesSearch});s&&l.append("status",s);const k=await w.get(`success-stories?${l}`);k.data.success?(this.successStories=k.data.data||[],this.totalItems=k.data.meta?.total||0):(this.successStories=[],this.totalItems=0,V.error(k.data.message||"Failed to fetch data",{position:"top-right",autoClose:3e3})),this.loading=!1}catch(l){this.successStories=[],this.totalItems=0,this.loading=!1;const k=l.response?.data?.message||"Failed to fetch success stories";V.error(k,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async fetchSuccessStory(i){this.loading=!0;try{const t=await w.get(`success-stories/${i}`,{params:{include_translations:1}});this.currentSuccessStory=t.data.data,this.loading=!1}catch{this.loading=!1,V.error("Failed to fetch success story",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async createSuccessStory(i){try{const t=await w.post("success-stories",i);this.createDialog=!1,V.success("Success story created successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchSuccessStories({page:1,itemsPerPage:this.itemsPerPage})}catch(t){const s=t.response?.data?.message||"Failed to create success story. Please try again.";V.error(s,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async updateSuccessStory(i,t){try{const s=await w.post(`success-stories/${i}`,t,{headers:{_method:"PUT"}});return this.createDialog=!1,this.isEditMode=!1,V.success("Success story updated successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchSuccessStories({page:1,itemsPerPage:this.itemsPerPage}),s}catch(s){const l=s.response?.data?.message||"Failed to update success story. Please try again.";throw V.error(l,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),s}},async deleteSuccessStory(i){try{await w.delete(`success-stories/${i}`),V.success("Success story deleted successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchSuccessStories({page:1,itemsPerPage:this.itemsPerPage})}catch(t){const s=t.response?.data?.message||"Failed to delete success story. Please try again.";V.error(s,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async bulkDeleteSuccessStories(i){try{const t=i.map(s=>w.delete(`success-stories/${s}`));await Promise.all(t),V.success(`${i.length} success stories deleted successfully!`,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchSuccessStories({page:1,itemsPerPage:this.itemsPerPage})}catch{V.error("Failed to delete selected success stories. Please try again.",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async toggleStatus(i){try{const t=await w.post(`success-stories/${i}/toggle-status`);V.success("Success story status updated successfully!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),this.fetchSuccessStories({page:1,itemsPerPage:this.itemsPerPage})}catch(t){const s=t.response?.data?.message||"Failed to update success story status. Please try again.";V.error(s,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}},async getPublishedSuccessStories({page:i=1,itemsPerPage:t=10}){try{const s=new URLSearchParams({page:i,perPage:t,search:this.successStoriesSearch});return(await w.get(`success-stories/published?${s}`)).data}catch{return{success:!1,data:[],meta:{total:0}}}},getStatusLabel(i){const t=this.statusOptions.find(s=>s.value===i);return t?t.label:i},formatDate(i){return i?new Date(i).toLocaleDateString():""},resetCurrentSuccessStory(){this.currentSuccessStory={id:null,title:"",slug:"",content:"",featured_image:"",author_name:"",author_title:"",location:"",status:"draft",published_at:null}}}});const fe={class:"flex w-100"},he={class:"flex w-100"},_e={class:"w-100 mb-4"},ve={class:"image-upload-label mb-2 d-block"},be={class:"photo-upload-container"},ye=["src"],Se={class:"photo-overlay"},Pe={key:0,class:"w-100"},Ce={class:"w-100"},Ve={__name:"CreateSuccessStoryTranslatable",setup(i){const{t}=K(),s=Q(),l=T(()=>s.isEditMode?t("update"):t("create")),k=T(()=>s.isEditMode?t("update"):t("submit")),B=b(!1),D=["title","client_name","story"],o=q({id:null,title:"",slug:"",client_name:"",story:"",image:"",status:"draft",published_at:null}),y=b(null),f=b(null),E=b(null),I=T(()=>f.value||o.image||null),j=b(null);W(y,e=>{if(e&&e instanceof File){if(!["image/png","image/jpeg","image/jpg","image/webp"].includes(e.type)){alert(t("please_select_image")||"Please select a valid image file (PNG, JPEG, JPG, or WebP)"),y.value=null,f.value=null;return}if(e.size>3*1024*1024){alert(t("image_too_large")||"Image size must be less than 3MB"),y.value=null,f.value=null;return}o.image="";const u=new FileReader;u.onload=S=>{f.value=S.target.result},u.onerror=()=>{f.value=null},u.readAsDataURL(e)}else e||o.image||(f.value=null)}),W(()=>o.image,e=>{e&&!f.value&&!y.value&&(f.value=e)},{immediate:!0}),W(()=>s.currentSuccessStory,e=>{e&&Object.keys(e).length>0&&(o.id=e.id,o.title=e.title||"",o.slug=e.slug||"",o.client_name=e.client_name||"",o.story=e.story||"",o.image=e.image||"",o.status=e.status||"draft",o.published_at=e.published_at?new Date(e.published_at).toISOString().slice(0,16):null,y.value=null,f.value=o.image||null,j.value=o.image||null,o.translationData={...e,farsi_translations:e.farsi_translations||{},pashto_translations:e.pashto_translations||{}})},{deep:!0,immediate:!0});const N={required:e=>!!e||t("field_required")},A=()=>{o.title&&!o.slug&&(o.slug=o.title.toLowerCase().replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))},z=()=>{E.value?.click()},G=e=>{if(e&&e.target&&e.target.files&&e.target.files.length>0){const c=e.target.files[0];y.value=c}},h=()=>{y.value=null,f.value=null,o.image="",E.value&&(E.value.value="")},_=async e=>{B.value=!0;try{if(e.type==="complete"){const c=new FormData;if(Object.keys(e.data).forEach(u=>{if(u!=="image")if(u==="translations"){const S=e.data[u]||{};c.append(u,JSON.stringify(S))}else u==="story"?c.append("content",e.data[u]):u==="client_name"?c.append("author_name",e.data[u]):e.data[u]!==null&&e.data[u]!==void 0&&c.append(u,e.data[u])}),y.value?c.append("featured_image",y.value):s.isEditMode&&!f.value&&!y.value&&j.value?c.append("featured_image",""):o.image&&!o.image.startsWith("data:")&&!y.value?c.append("featured_image",o.image):s.isEditMode||c.append("featured_image",""),o.published_at?c.set("published_at",new Date(o.published_at).toISOString()):o.status==="published"&&c.set("published_at",new Date().toISOString()),s.isEditMode){const u=await s.updateSuccessStory(o.id,c),S=u?.data?.data?.image||u?.data?.image;y.value&&S&&(o.image=S,f.value=S,y.value=null,s.currentSuccessStory&&(s.currentSuccessStory.image=S))}else await s.createSuccessStory(c)}}catch{}finally{B.value=!1}};return(e,c)=>{const u=m("v-text-field"),S=m("v-select"),H=m("v-icon"),J=m("v-textarea");return U(),L(me,{modelValue:v(s).createDialog,"onUpdate:modelValue":c[0]||(c[0]=r=>v(s).createDialog=r),"form-title":l.value,"button-text":k.value,"translatable-fields":D,"form-data":o,rules:N,saving:B.value,"is-edit-mode":v(s).isEditMode,onSave:_},{"base-fields":n(({formData:r,rules:P})=>[g("div",fe,[a(u,{modelValue:r.title,"onUpdate:modelValue":p=>r.title=p,variant:"outlined",label:e.$t("title"),density:"compact",class:"pb-4 pr-2 w-75",rules:[P.required],onInput:A},null,8,["modelValue","onUpdate:modelValue","label","rules"]),a(S,{modelValue:r.status,"onUpdate:modelValue":p=>r.status=p,items:v(s).statusOptions,variant:"outlined",density:"compact","item-value":"value","item-title":"label","return-object":!1,label:e.$t("status"),class:"pb-4 pl-2 w-25",rules:[P.required]},null,8,["modelValue","onUpdate:modelValue","items","label","rules"])]),g("div",he,[a(u,{modelValue:r.slug,"onUpdate:modelValue":p=>r.slug=p,variant:"outlined",label:e.$t("slug"),density:"compact",class:"pb-4 pr-2 w-50",hint:e.$t("hint_url_friendly"),"persistent-hint":""},null,8,["modelValue","onUpdate:modelValue","label","hint"]),a(u,{modelValue:r.client_name,"onUpdate:modelValue":p=>r.client_name=p,variant:"outlined",label:e.$t("client_name"),density:"compact",class:"pb-4 pl-2 w-50"},null,8,["modelValue","onUpdate:modelValue","label"])]),g("div",_e,[g("label",ve,O(e.$t("featured_image")),1),g("div",be,[g("input",{ref_key:"fileInputRef",ref:E,type:"file",accept:"image/png, image/jpeg, image/jpg, image/webp",style:{display:"none"},onChange:G},null,544),ie(g("img",{src:I.value,class:"photo-preview"},null,8,ye),[[ne,I.value!==null]]),g("div",Se,[I.value?M("",!0):(U(),R("button",{key:0,type:"button",onClick:z,class:"overlay-button"},[a(H,{size:"x-large",color:"blue-grey-lighten-2"},{default:n(()=>[...c[1]||(c[1]=[$("mdi-camera",-1)])]),_:1})])),I.value?(U(),R("button",{key:1,type:"button",onClick:h,class:"close-button"},[a(H,{size:"lg",color:"red"},{default:n(()=>[...c[2]||(c[2]=[$("mdi-close",-1)])]),_:1})])):M("",!0),I.value?(U(),R("button",{key:2,type:"button",onClick:z,class:"edit-button"},[a(H,{size:"small"},{default:n(()=>[...c[3]||(c[3]=[$("mdi-pencil",-1)])]),_:1})])):M("",!0)])])]),r.status==="published"?(U(),R("div",Pe,[a(u,{modelValue:r.published_at,"onUpdate:modelValue":p=>r.published_at=p,variant:"outlined",label:e.$t("published_date"),density:"compact",type:"datetime-local",class:"pb-4"},null,8,["modelValue","onUpdate:modelValue","label"])])):M("",!0),g("div",Ce,[a(J,{modelValue:r.story,"onUpdate:modelValue":p=>r.story=p,variant:"outlined",label:e.$t("content"),density:"compact",class:"pb-4",rules:[P.required],rows:"8",hint:e.$t("hint_success_story_content"),"persistent-hint":""},null,8,["modelValue","onUpdate:modelValue","label","rules","hint"])])]),"farsi-fields":n(({translations:r,clearTranslation:P,hasTranslation:p})=>[a(x,{modelValue:r.title,"onUpdate:modelValue":C=>r.title=C,"field-name":"title","field-label":e.$t("title"),language:"farsi","language-label":e.$t("dari"),"has-translation":p("title"),onClear:P},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"]),a(x,{modelValue:r.client_name,"onUpdate:modelValue":C=>r.client_name=C,"field-name":"client_name","field-label":e.$t("client_name"),language:"farsi","language-label":e.$t("dari"),"has-translation":p("client_name"),onClear:P},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"]),a(x,{modelValue:r.story,"onUpdate:modelValue":C=>r.story=C,"field-name":"story","field-label":e.$t("content"),language:"farsi","language-label":e.$t("dari"),"field-type":"textarea",rows:8,"has-translation":p("story"),onClear:P},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"])]),"pashto-fields":n(({translations:r,clearTranslation:P,hasTranslation:p})=>[a(x,{modelValue:r.title,"onUpdate:modelValue":C=>r.title=C,"field-name":"title","field-label":e.$t("title"),language:"pashto","language-label":e.$t("pashto"),"has-translation":p("title"),onClear:P},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"]),a(x,{modelValue:r.client_name,"onUpdate:modelValue":C=>r.client_name=C,"field-name":"client_name","field-label":e.$t("client_name"),language:"pashto","language-label":e.$t("pashto"),"has-translation":p("client_name"),onClear:P},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"]),a(x,{modelValue:r.story,"onUpdate:modelValue":C=>r.story=C,"field-name":"story","field-label":e.$t("content"),language:"pashto","language-label":e.$t("pashto"),"field-type":"textarea",rows:8,"has-translation":p("story"),onClear:P},null,8,["modelValue","onUpdate:modelValue","field-label","language-label","has-translation","onClear"])]),_:1},8,["modelValue","form-title","button-text","form-data","saving","is-edit-mode"])}}},$e=Y(Ve,[["__scopeId","data-v-304d87e4"]]),ke=["dir"],Oe={class:"btn-search pt-12 pb-6"},Ue={class:"text-field w-25"},we={class:"btn flex"},Ie={class:"table-section"},Me={class:"py-2 pl-4"},Be={class:"d-flex align-center"},Ee={class:"font-weight-medium"},Fe={class:"text-caption text-grey"},xe={class:"py-2 pl-4"},He={class:"py-2 pl-4"},Re={__name:"SuccessStories",setup(i){const{t,locale:s}=K();ge();const l=Q(),k=T(()=>["fa","ps"].includes(s.value)?"rtl":"ltr"),B=b("");let D;const o=()=>{clearTimeout(D),D=setTimeout(()=>{l.fetchSuccessStories({page:1,itemsPerPage:l.itemsPerPage,status:B.value})},500)},y=h=>{l.fetchSuccessStories({page:h.page,itemsPerPage:h.itemsPerPage,status:B.value})},f=b([]),E=()=>{f.value.length>0&&(l.bulkDeleteSuccessStories(f.value),f.value=[])},I=()=>{l.resetCurrentSuccessStory(),l.isEditMode=!1,l.createDialog=!0},j=h=>{l.isEditMode=!0,l.currentSuccessStory={...h},l.createDialog=!0},N=async h=>{await l.deleteSuccessStory(h.id)},A=async h=>{await l.toggleStatus(h.id)},z=h=>{switch(h){case"published":return"success";case"draft":return"warning";case"archived":return"grey";default:return"primary"}},G=T(()=>[{title:"",key:"checkbox",align:"start",sortable:!1},{title:t("title"),key:"title",align:"start",sortable:!0},{title:t("status"),key:"status",align:"center",sortable:!0},{title:t("published_date"),key:"published_at",align:"center",sortable:!0},{title:t("created_at"),key:"created_at",align:"center",sortable:!0},{title:t("action"),key:"action",align:"center",sortable:!1}]);return ue(()=>{l.fetchSuccessStories({page:1,itemsPerPage:l.itemsPerPage})}),(h,_)=>{const e=m("v-divider"),c=m("v-text-field"),u=m("v-btn"),S=m("v-icon"),H=m("v-img"),J=m("v-avatar"),r=m("v-chip"),P=m("v-checkbox"),p=m("v-list-item-title"),C=m("v-list-item"),X=m("v-list"),Z=m("v-menu"),ee=m("v-data-table-server"),te=m("v-col"),se=m("v-row"),ae=m("v-main"),le=m("v-app");return U(),R(de,null,[v(l).createDialog?(U(),L($e,{key:0})):M("",!0),g("div",{dir:k.value},[a(pe,{pageTitle:h.$t("success_stories_management")},null,8,["pageTitle"]),a(e,{thickness:1,class:"border-opacity-100"}),g("div",Oe,[g("div",Ue,[a(c,{color:"primary",density:"compact",variant:"outlined",label:h.$t("search"),"append-inner-icon":"mdi-magnify","hide-details":"",modelValue:v(l).successStoriesSearch,"onUpdate:modelValue":_[0]||(_[0]=d=>v(l).successStoriesSearch=d),onInput:o},null,8,["label","modelValue"])]),g("div",we,[a(u,{variant:"outlined",color:"primary",class:"px-6"},{default:n(()=>[$(O(v(t)("filter")),1)]),_:1}),_[4]||(_[4]=$(" Â  ",-1)),a(u,{onClick:I,class:"create-btn-gradient px-6",text:h.$t("create")},{default:n(()=>[a(S,null,{default:n(()=>[..._[3]||(_[3]=[$("mdi-plus",-1)])]),_:1})]),_:1},8,["text"])])]),g("div",Ie,[a(le,null,{default:n(()=>[a(ae,{class:"main"},{default:n(()=>[a(se,null,{default:n(()=>[a(te,null,{default:n(()=>[a(ee,{dir:k.value,theme:"cursor-pointer","items-per-page":v(l).itemsPerPage,"onUpdate:itemsPerPage":_[2]||(_[2]=d=>v(l).itemsPerPage=d),headers:G.value,"items-length":v(l).totalItems,items:v(l).successStories,loading:v(l).loading,"onUpdate:options":y,hover:"",class:"w-100 mx-auto"},{"item.title":n(({item:d})=>[g("td",Me,[g("div",Be,[d.image||d.image_url?(U(),L(J,{key:0,size:"40",class:"mr-3"},{default:n(()=>[a(H,{src:d.image_url||d.image,alt:d.title,cover:""},null,8,["src","alt"])]),_:2},1024)):M("",!0),g("div",null,[g("div",Ee,O(d.title),1),g("div",Fe,O(d.client_name),1)])])])]),"item.status":n(({item:d})=>[g("td",xe,[a(r,{color:z(d.status),size:"small",variant:"flat"},{default:n(()=>[$(O(v(l).getStatusLabel(d.status)),1)]),_:2},1032,["color"])])]),"item.published_at":n(({item:d})=>[g("td",He,[g("span",null,O(v(l).formatDate(d.published_at)),1)])]),"item.checkbox":n(({item:d})=>[a(P,{value:d.id,modelValue:f.value,"onUpdate:modelValue":_[1]||(_[1]=F=>f.value=F),class:"w-6 d-flex"},null,8,["value","modelValue"])]),"item.action":n(({item:d})=>[a(Z,null,{activator:n(({props:F})=>[a(u,ce({icon:"mdi-dots-vertical"},F,{variant:"text"}),null,16)]),default:n(()=>[a(X,null,{default:n(()=>[a(C,null,{default:n(()=>[a(p,{onClick:F=>j(d),class:"cursor-pointer d-flex gap-3 justify-left pb-3"},{default:n(()=>[a(S,{color:"tealColor"},{default:n(()=>[..._[5]||(_[5]=[$("mdi-square-edit-outline",-1)])]),_:1}),$(" "+O(h.$t("edit")),1)]),_:1},8,["onClick"]),a(p,{onClick:F=>A(d),class:"cursor-pointer d-flex gap-3 pb-3"},{default:n(()=>[a(S,{color:d.status==="published"?"orange":"green"},{default:n(()=>[$(O(d.status==="published"?"mdi-eye-off":"mdi-eye"),1)]),_:2},1032,["color"]),$(" "+O(d.status==="published"?h.$t("unpublish"):h.$t("publish")),1)]),_:2},1032,["onClick"]),a(p,{class:"cursor-pointer d-flex gap-3",onClick:F=>N(d)},{default:n(()=>[a(S,{color:"error"},{default:n(()=>[..._[6]||(_[6]=[$("mdi-delete-outline",-1)])]),_:1}),$(" "+O(h.$t("delete")),1)]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["dir","items-per-page","headers","items-length","items","loading"]),f.value.length>0?(U(),L(u,{key:0,class:"header-button",onClick:E,color:"#B71C1C",flat:"",inset:"",text:v(t)("delete_selected",{count:f.value.length})},null,8,["text"])):M("",!0)]),_:1})]),_:1})]),_:1})]),_:1})])],8,ke)],64)}}},Ne=Y(Re,[["__scopeId","data-v-0a3f2eb3"]]);export{Ne as default};
